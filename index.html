<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°zleme Takip UygulamasÄ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-light: #f8fafc;
            --text-light: #1e293b;
            --card-light: #ffffff;
            --border-light: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        .dark-theme {
            --primary: #818cf8;
            --primary-dark: #6366f1;
            --secondary: #a78bfa;
            --bg-light: #0f172a;
            --text-light: #e2e8f0;
            --card-light: #1e293b;
            --border-light: #334155;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            transition: background 0.3s ease;
            color: var(--text-light);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .dark-theme .card {
            background: rgba(30, 41, 59, 0.95);
            border-color: rgba(51, 65, 85, 0.3);
            backdrop-filter: blur(10px);
        }

        .dark-theme body {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }

        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button.active {
            color: white;
            font-weight: 600;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background: white;
            border-radius: 3px;
        }

        .series-card,
        .movie-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-light);
        }

        .series-card:hover,
        .movie-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .progress-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background: #e5e7eb;
        }

        .dark-theme .progress-bar {
            background: #334155;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.4s ease;
        }

        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .status-badge.completed {
            background: linear-gradient(45deg, var(--success), #06d6a0);
            color: white;
        }

        .status-badge.watching {
            background: linear-gradient(45deg, var(--primary), #60a5fa);
            color: white;
        }

        .status-badge.planning {
            background: linear-gradient(45deg, var(--secondary), #a78bfa);
            color: white;
        }

        .status-badge.paused {
            background: linear-gradient(45deg, var(--warning), #fbbf24);
            color: white;
        }

        .filter-button {
            transition: all 0.3s ease;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-light);
        }

        .filter-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .filter-button.active {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .edit-icon,
        .delete-icon {
            opacity: 0;
            transition: all 0.2s ease;
        }

        .series-card:hover .edit-icon,
        .series-card:hover .delete-icon,
        .movie-card:hover .edit-icon,
        .movie-card:hover .delete-icon {
            opacity: 1;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--card-light);
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-light);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: var(--bg-light);
            color: var(--text-light);
        }

        .dark-theme .form-control {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-size: 16px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .dark-theme .btn-secondary {
            background: #475569;
            color: #e2e8f0;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .dark-theme .btn-secondary:hover {
            background: #64748b;
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--danger), #f87171);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .trailer-btn {
            background: linear-gradient(45deg, #ff0000, #ff4444);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trailer-btn:hover {
            background: linear-gradient(45deg, #cc0000, #ff3333);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(255, 0, 0, 0.3);
        }

        .watched-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .watched-indicator.watched {
            background-color: var(--success);
        }

        .watched-indicator.unwatched {
            background-color: #d1d5db;
        }

        .dark-theme .watched-indicator.unwatched {
            background-color: #475569;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .section-header {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 24px;
            align-items: center;
        }

        .search-container {
            flex: 1;
            min-width: 200px;
        }

        .filters-container {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .view-options {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        .view-button {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e5e7eb;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dark-theme .view-button {
            background: #475569;
            color: #e2e8f0;
        }

        .view-button.active {
            background: var(--primary);
            color: white;
        }

        .season-list {
            margin-top: 16px;
            border-top: 1px solid var(--border-light);
            padding-top: 16px;
        }

        .dark-theme .season-list {
            border-top-color: #334155;
        }

        .season-item {
            padding: 12px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            margin-bottom: 8px;
            background: #f9fafb;
        }

        .dark-theme .season-item {
            background: #334155;
            border-color: #475569;
        }

        .season-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .season-content {
            margin-top: 12px;
            padding: 12px;
            background: var(--bg-light);
            border-radius: 8px;
            border: 1px solid var(--border-light);
            display: none;
        }

        .dark-theme .season-content {
            background: #475569;
            border-color: #64748b;
        }

        .season-content.show {
            display: block;
        }

        .season-toggle {
            transition: transform 0.3s ease;
            display: inline-block;
        }

        .season-toggle.rotate {
            transform: rotate(180deg);
        }

        .season-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0;
        }

        .season-content.show {
            max-height: 500px;
            padding: 1rem 0 0 0;
        }

        .grid-1-col {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        .grid-2-col {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .grid-3-col {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }

        @media (max-width: 1024px) {
            .grid-3-col {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 640px) {
            .grid-3-col,
            .grid-2-col {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.3);
        }

        .dark-theme .theme-toggle {
            background: rgba(30, 41, 59, 0.3);
        }

        .dark-theme .theme-toggle:hover {
            background: rgba(30, 41, 59, 0.4);
        }

        /* Yeni eklenen stiller */
        .category-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            color: white;
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            background-color: #e5e7eb;
            color: #4b5563;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .dark-theme .tag {
            background-color: #475569;
            color: #e2e8f0;
        }

        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.5rem;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            min-height: 42px;
        }

        .tag-input {
            flex: 1;
            min-width: 60px;
            border: none;
            outline: none;
            background: transparent;
        }

        .category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .category-option {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            cursor: pointer;
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 0.5rem;
            margin-right: 0.5rem;
            font-weight: 500;
            letter-spacing: 0.01em;
        }

        .category-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .category-option.selected {
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
            position: relative;
            overflow: hidden;
        }

        .category-option.selected::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: inherit;
            z-index: 0;
        }

        .category-option.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 0 20px 0 8px;
            padding: 0 6px;
            font-size: 0.7rem;
            z-index: 1;
        }

        .category-option span {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            padding: 0.1rem 0.5rem;
            margin-left: 0.5rem;
            font-weight: 600;
            font-size: 0.75rem;
            min-width: 24px;
            height: 20px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
        }

        .category-option>* {
            position: relative;
            z-index: 2;
        }

        .category-manager {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        .dark-theme .category-manager {
            border-top-color: #334155;
        }

        .custom-checkbox {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .custom-checkbox input {
            margin-right: 0.5rem;
        }

        .color-picker {
            width: 30px;
            height: 30px;
            padding: 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        /* Sezon Form Stilleri */
        .season-form-item {
            padding: 1rem;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            background: #f9fafb;
            position: relative;
        }

        .dark-theme .season-form-item {
            background: #334155;
            border-color: #475569;
        }

        .season-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .season-form-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .remove-season-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .remove-season-btn:hover {
            background: #dc2626;
        }

        .season-form-fields {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .season-form-fields {
                grid-template-columns: 1fr;
            }
        }

        .dark-theme .tag-cloud {
            background: rgba(30, 41, 59, 0.3);
        }

        @media (max-width: 768px) {
            .section-header {
                flex-direction: column;
                align-items: stretch;
            }

            .search-container {
                order: 2;
            }

            .filters-container {
                order: 1;
                justify-content: center;
            }

            .view-options {
                order: 3;
                margin: 16px 0 0 0;
                justify-content: center;
            }
        }

        /* Fragman Modal Stilleri */
        .trailer-modal {
            z-index: 10000;
        }

        .trailer-modal-content {
            max-width: 90vw;
            max-height: 90vh;
            width: 800px;
            padding: 0;
            border-radius: 12px;
            overflow: hidden;
            background: var(--card-light);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transform: none;
        }

        .trailer-modal .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0;
        }

        .trailer-modal .modal-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-trailer-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .close-trailer-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .trailer-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: #000;
        }

        .trailer-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Fragman butonu stilleri */
        .trailer-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 8px;
        }

        .trailer-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .trailer-btn i {
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .trailer-modal-content {
                width: 95vw;
                max-width: 95vw;
            }
            
            .trailer-modal .modal-header h3 {
                font-size: 1rem;
            }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 min-h-screen">
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon text-white text-xl"></i>
    </div>

    <div class="app-container">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-4 drop-shadow-lg">ðŸŽ¬ Ä°zleme Takip</h1>
            <p class="text-xl text-purple-100 opacity-90">Dizilerinizi ve filmlerinizi akÄ±llÄ±ca takip edin</p>
        </div>

        <!-- Backup & Restore Section -->
        <div class="card p-6 mb-8 bg-white/10 backdrop-blur-sm">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center">
                    <h3 class="text-white font-semibold mb-2">Yedek Al</h3>
                    <p class="text-purple-100 text-sm mb-3">Verilerinizi gÃ¼venli bir dosyaya kaydedin</p>
                    <button id="exportData" class="btn btn-primary w-full">
                        <i class="fas fa-download mr-2"></i> Yedek Al
                    </button>
                </div>
                <div class="text-center border-l border-r border-white/20 px-4">
                    <h3 class="text-white font-semibold mb-2">Geri YÃ¼kle</h3>
                    <p class="text-purple-100 text-sm mb-3">KayÄ±p verilerinizi kurtarÄ±n</p>
                    <div class="relative">
                        <input type="file" id="importData" class="hidden" accept=".json">
                        <label for="importData" class="btn btn-primary w-full cursor-pointer">
                            <i class="fas fa-upload mr-2"></i> Dosya YÃ¼kle
                        </label>
                    </div>
                </div>
                <div class="text-center">
                    <h3 class="text-white font-semibold mb-3">Ä°statistikler</h3>
                    <div class="grid grid-cols-2 gap-4 mb-2">
                        <div class="text-center">
                            <div class="text-xl font-bold text-white mb-1" id="seriesStats">0</div>
                            <p class="text-purple-100 text-xs">Dizi</p>
                        </div>
                        <div class="text-center">
                            <div class="text-xl font-bold text-white mb-1" id="moviesStats">0</div>
                            <p class="text-purple-100 text-xs">Film</p>
                        </div>
                    </div>
                    <div class="border-t border-white/20 pt-2">
                        <div class="text-2xl font-bold text-white mb-1" id="totalStats">0</div>
                        <p class="text-purple-100 text-sm">Toplam Ä°Ã§erik</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex bg-white/10 backdrop-blur-sm rounded-xl p-2 mb-8 justify-center">
            <button id="seriesTab" class="tab-button px-6 py-3 font-medium text-white border-none active">
                <i class="fas fa-tv mr-2"></i> Diziler
            </button>
            <button id="moviesTab" class="tab-button px-6 py-3 font-medium text-white border-none">
                <i class="fas fa-film mr-2"></i> Filmler
            </button>
            <button id="categoriesTab" class="tab-button px-6 py-3 font-medium text-white border-none">
                <i class="fas fa-tags mr-2"></i> Kategoriler
            </button>
            <button id="tagsTab" class="tab-button px-6 py-3 font-medium text-white border-none">
                <i class="fas fa-tag mr-2"></i> Etiketler
            </button>
        </div>

        <!-- Series Tab Content -->
        <div id="seriesContent" class="tab-content">
            <div class="card p-6 mb-6">
                <div class="grid grid-cols-1 gap-4">
                    <div class="flex justify-between items-center">
                        <div class="search-container flex-grow mr-4">
                            <div class="relative">
                                <input type="text" id="searchSeries" class="form-control pl-10"
                                    placeholder="Dizi ara...">
                                <i
                                    class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="view-options flex mr-2">
                                <button class="view-button active" id="view1Col" data-view="1">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button class="view-button" id="view2Col" data-view="2">
                                    <i class="fas fa-th-large"></i>
                                </button>
                                <button class="view-button" id="view3Col" data-view="3">
                                    <i class="fas fa-th"></i>
                                </button>
                            </div>
                            <button id="addSeriesBtn" class="btn btn-primary">
                                <i class="fas fa-plus mr-2"></i> Yeni Dizi
                            </button>
                        </div>
                    </div>

                    <div class="filters-container bg-white/5 p-3 rounded-lg">
                        <div class="flex flex-wrap gap-2 mb-3 items-center">
                            <div class="flex flex-wrap gap-2">
                                <button class="filter-button btn btn-secondary btn-sm active" data-filter="all">
                                    <i class="fas fa-layer-group mr-1"></i> TÃ¼mÃ¼
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="completed">
                                    <i class="fas fa-check-circle mr-1"></i> Tamamlanan
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="watching">
                                    <i class="fas fa-play-circle mr-1"></i> Ä°zleniyor
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="planning">
                                    <i class="fas fa-clock mr-1"></i> Planlanan
                                </button>
                            </div>
                            
                            <div class="flex items-center gap-2 ml-auto">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-300">SÄ±ralama:</span>
                                <select id="seriesSortSelect" class="form-control text-sm py-1 px-2 min-w-[140px]">
                                    <option value="newest">En Yeni</option>
                                    <option value="oldest">En Eski</option>
                                    <option value="alphabetical">A-Z</option>
                                    <option value="alphabetical-desc">Z-A</option>
                                    <option value="rating-desc">IMDB PuanÄ± (YÃ¼ksek)</option>
                                    <option value="rating-asc">IMDB PuanÄ± (DÃ¼ÅŸÃ¼k)</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <div class="flex items-center mb-2">
                                <span
                                    class="text-sm font-medium text-gray-600 dark:text-gray-300 mr-2">Kategoriler:</span>
                                <div id="seriesCategoryFilters" class="flex flex-wrap items-center gap-2"></div>
                            </div>

                            <!-- Etiket bulutu -->
                            <div id="seriesTagCloud" class="tag-cloud mt-2">
                                <!-- Etiketler buraya dinamik olarak eklenecek -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-1-col gap-6" id="seriesList">
                <!-- Series cards will be added here dynamically -->
            </div>

            <!-- Empty State -->
            <div id="seriesEmpty" class="text-center py-16">
                <div class="text-white/70 text-6xl mb-4"><i class="fas fa-tv"></i></div>
                <h3 class="text-2xl font-semibold text-white mb-2">HenÃ¼z dizi eklemediniz</h3>
                <p class="text-purple-100 mb-4">Yeni dizi eklemek iÃ§in "Yeni Dizi" butonuna tÄ±klayÄ±n</p>
                <button id="addSeriesBtnEmpty" class="btn btn-primary">
                    <i class="fas fa-plus mr-2"></i> Ä°lk Dizini Ekle
                </button>
            </div>
        </div>

        <!-- Movies Tab Content -->
        <div id="moviesContent" class="tab-content hidden">
            <div class="card p-6 mb-6">
                <div class="grid grid-cols-1 gap-4">
                    <div class="flex justify-between items-center">
                        <div class="search-container flex-grow mr-4">
                            <div class="relative">
                                <input type="text" id="searchMovies" class="form-control pl-10"
                                    placeholder="Film ara...">
                                <i
                                    class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="view-options flex mr-2">
                                <button class="view-button active" id="view1ColMovies" data-view="1">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button class="view-button" id="view2ColMovies" data-view="2">
                                    <i class="fas fa-th-large"></i>
                                </button>
                                <button class="view-button" id="view3ColMovies" data-view="3">
                                    <i class="fas fa-th"></i>
                                </button>
                            </div>
                            <button id="addMovieBtn" class="btn btn-primary">
                                <i class="fas fa-plus mr-2"></i> Yeni Film
                            </button>
                        </div>
                    </div>

                    <div class="filters-container bg-white/5 p-3 rounded-lg">
                        <div class="flex flex-wrap gap-2 mb-3 items-center">
                            <div class="flex flex-wrap gap-2">
                                <button class="filter-button btn btn-secondary btn-sm active" data-filter="all">
                                    <i class="fas fa-layer-group mr-1"></i> TÃ¼mÃ¼
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="watched">
                                    <i class="fas fa-eye mr-1"></i> Ä°zlendi
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="not-watched">
                                    <i class="fas fa-eye-slash mr-1"></i> Ä°zlenmedi
                                </button>
                            </div>
                            
                            <div class="flex items-center gap-2 ml-auto">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-300">SÄ±ralama:</span>
                                <select id="moviesSortSelect" class="form-control text-sm py-1 px-2 min-w-[140px]">
                                    <option value="newest">En Yeni</option>
                                    <option value="oldest">En Eski</option>
                                    <option value="alphabetical">A-Z</option>
                                    <option value="alphabetical-desc">Z-A</option>
                                    <option value="rating-desc">IMDB PuanÄ± (YÃ¼ksek)</option>
                                    <option value="rating-asc">IMDB PuanÄ± (DÃ¼ÅŸÃ¼k)</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <div class="flex items-center mb-2">
                                <span
                                    class="text-sm font-medium text-gray-600 dark:text-gray-300 mr-2">Kategoriler:</span>
                                <div id="moviesCategoryFilters" class="flex flex-wrap items-center gap-2"></div>
                            </div>

                            <!-- Etiket bulutu -->
                            <div id="moviesTagCloud" class="tag-cloud mt-2">
                                <!-- Etiketler buraya dinamik olarak eklenecek -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-1-col gap-6" id="moviesList">
                <!-- Movie cards will be added here dynamically -->
            </div>

            <!-- Empty State -->
            <div id="moviesEmpty" class="text-center py-16">
                <div class="text-white/70 text-6xl mb-4"><i class="fas fa-film"></i></div>
                <h3 class="text-2xl font-semibold text-white mb-2">HenÃ¼z film eklemediniz</h3>
                <p class="text-purple-100 mb-4">Yeni film eklemek iÃ§in "Yeni Film" butonuna tÄ±klayÄ±n</p>
                <button id="addMovieBtnEmpty" class="btn btn-primary">
                    <i class="fas fa-plus mr-2"></i> Ä°lk Filmi Ekle
                </button>
            </div>
        </div>

        <!-- Categories Tab Content -->
        <div id="categoriesContent" class="tab-content hidden">
            <div class="card p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6">Kategori YÃ¶netimi</h2>

                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-4">Yeni Kategori Ekle</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="form-group">
                            <label for="newCategoryName">Kategori AdÄ±</label>
                            <input type="text" id="newCategoryName" class="form-control" placeholder="Kategori adÄ±">
                        </div>
                        <div class="form-group">
                            <label for="newCategoryColor">Renk</label>
                            <input type="color" id="newCategoryColor" class="form-control color-picker" value="#6366f1">
                        </div>
                        <div class="form-group flex items-end">
                            <button id="addCategoryBtn" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i> Kategori Ekle
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-semibold mb-4">Mevcut Kategoriler</h3>
                    <div id="categoriesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Kategoriler buraya dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Tags Management Tab Content -->
        <div id="tagsContent" class="tab-content hidden">
            <div class="card p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6">Etiket YÃ¶netimi</h2>

                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-4">Yeni Etiket Ekle</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="form-group">
                            <label for="newTagName">Etiket AdÄ±</label>
                            <input type="text" id="newTagName" class="form-control" placeholder="Etiket adÄ±">
                        </div>
                        <div class="form-group flex items-end">
                            <button id="addTagBtn" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i> Etiket Ekle
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-semibold mb-4">Mevcut Etiketler</h3>
                    <div id="tagsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Etiketler buraya dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Series Edit Modal -->
    <div id="seriesModal" class="modal">
        <div class="modal-content">
            <h2 id="seriesModalTitle" class="text-2xl font-bold mb-6">Dizi Ekle</h2>
            <form id="seriesForm">
                <input type="hidden" id="seriesId">

                <div class="form-group">
                    <label for="seriesName">Dizi AdÄ± *</label>
                    <input type="text" id="seriesName" name="seriesName" class="form-control" required>
                </div>

                <!-- Sezon SeÃ§imi -->
                <div class="form-group">
                    <label for="seasonSelector">DÃ¼zenlenecek Sezon</label>
                    <div class="flex gap-2">
                        <select id="seasonSelector" class="form-control flex-1">
                            <option value="">Sezon seÃ§in...</option>
                        </select>
                        <button type="button" id="addNewSeasonBtn" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus mr-1"></i> Yeni Sezon
                        </button>
                    </div>
                </div>

                <!-- SeÃ§ilen Sezon Bilgileri -->
                <div id="selectedSeasonInfo" class="form-group" style="display: none;">
                    <div class="season-form-item">
                        <div class="season-form-header">
                            <h4 class="season-form-title">Sezon Bilgileri</h4>
                            <button type="button" id="deleteSeasonBtn" class="remove-season-btn" style="display: none;">
                                <i class="fas fa-trash mr-1"></i> Sezonu Sil
                            </button>
                        </div>
                        <div class="season-form-fields">
                            <div>
                                <label>Sezon NumarasÄ±</label>
                                <input type="number" name="seasonNumber" class="form-control season-number" min="1">
                            </div>
                            <div>
                                <label>Toplam BÃ¶lÃ¼m</label>
                                <input type="number" name="totalEpisodes" class="form-control total-episodes" min="1">
                            </div>
                            <div>
                                <label>Ä°zlenen BÃ¶lÃ¼m</label>
                                <input type="number" name="watchedEpisodes" class="form-control watched-episodes"
                                    min="0">
                            </div>
                        </div>
                        <div class="season-form-actions" style="margin-top: 15px;">
                            <button type="button" id="saveNewSeasonBtn" class="btn btn-success" style="display: none;">
                                <i class="fas fa-plus mr-1"></i> Yeni Sezonu Kaydet
                            </button>
                        </div>
                    </div>
                </div>


                <div class="form-group">
                    <label for="seriesPlatform">Platform</label>
                    <select id="seriesPlatform" name="seriesPlatform" class="form-control">
                        <option value="Netflix">Netflix</option>
                        <option value="Disney+">Disney+</option>
                        <option value="Amazon Prime">Amazon Prime</option>
                        <option value="HBO Max">HBO Max</option>
                        <option value="Gain">Gain</option>
                        <option value="Exxen">Exxen</option>
                        <option value="DiÄŸer">DiÄŸer</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="seriesTrailerUrl">YouTube Fragman Linki</label>
                    <input type="url" id="seriesTrailerUrl" name="seriesTrailerUrl" class="form-control" 
                           placeholder="https://www.youtube.com/watch?v=...">
                    <small class="text-gray-400 mt-1">YouTube video linkini buraya yapÄ±ÅŸtÄ±rÄ±n (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- IMDB PuanÄ± -->
                <div class="form-group">
                    <label for="seriesImdbRating">IMDB PuanÄ±</label>
                    <input type="number" id="seriesImdbRating" name="seriesImdbRating" class="form-control" 
                           min="0" max="10" step="0.1" placeholder="7.5">
                    <small class="text-gray-400 mt-1">0-10 arasÄ± puan girebilirsiniz (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- AÃ§Ä±klama -->
                <div class="form-group">
                    <label for="seriesDescription">AÃ§Ä±klama</label>
                    <textarea id="seriesDescription" name="seriesDescription" class="form-control" 
                              rows="3" placeholder="Dizi hakkÄ±nda kÄ±sa aÃ§Ä±klama..."></textarea>
                    <small class="text-gray-400 mt-1">Dizi hakkÄ±nda kÄ±sa bir aÃ§Ä±klama yazabilirsiniz (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- Resim Linki -->
                <div class="form-group">
                    <label for="seriesImageUrl">Resim Linki</label>
                    <input type="url" id="seriesImageUrl" name="seriesImageUrl" class="form-control" 
                           placeholder="https://example.com/image.jpg">
                    <small class="text-gray-400 mt-1">Dizi posteri veya kapak resmi linki (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- Kategori seÃ§imi -->
                <div class="form-group">
                    <label>Kategoriler</label>
                    <div id="seriesCategorySelector" class="category-selector">
                        <!-- Kategoriler buraya dinamik olarak eklenecek -->
                    </div>
                </div>

                <!-- Etiketler -->
                <div class="form-group">
                    <label for="seriesTags">Etiketler</label>
                    <div class="tag-input-container" id="seriesTagsContainer">
                        <input type="text" id="seriesTagsInput" class="tag-input"
                            placeholder="Etiket ekle ve Enter'a bas">
                    </div>
                    <div id="seriesTagOptions" class="tag-cloud mt-2"></div>
                </div>

                <!-- Sezonlar iÃ§in container -->
                <div id="seasonsContainer" class="flex flex-col gap-4"></div>

                <div class="action-buttons">
                    <button type="button" id="cancelSeries" class="btn btn-secondary flex-1">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary flex-1">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Movie Edit Modal -->
    <div id="movieModal" class="modal">
        <div class="modal-content">
            <h2 id="movieModalTitle" class="text-2xl font-bold mb-6">Film Ekle</h2>
            <form id="movieForm">
                <input type="hidden" id="movieId">
                <div class="form-group">
                    <label for="movieName">Film AdÄ± *</label>
                    <input type="text" id="movieName" class="form-control" required>
                </div>

                <!-- Kategori seÃ§imi -->
                <div class="form-group">
                    <label>Kategoriler</label>
                    <div id="movieCategorySelector" class="category-selector">
                        <!-- Kategoriler buraya dinamik olarak eklenecek -->
                    </div>
                </div>

                <!-- Etiketler -->
                <div class="form-group">
                    <label for="movieTags">Etiketler</label>
                    <div class="tag-input-container" id="movieTagsContainer">
                        <input type="text" id="movieTagsInput" class="tag-input"
                            placeholder="Etiket ekle ve Enter'a bas">
                    </div>
                    <div id="movieTagOptions" class="tag-cloud mt-2"></div>
                </div>

                <div class="form-group">
                    <label for="movieTrailerUrl">YouTube Fragman Linki</label>
                    <input type="url" id="movieTrailerUrl" name="movieTrailerUrl" class="form-control" 
                           placeholder="https://www.youtube.com/watch?v=...">
                    <small class="text-gray-400 mt-1">YouTube video linkini buraya yapÄ±ÅŸtÄ±rÄ±n (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- IMDB PuanÄ± -->
                <div class="form-group">
                    <label for="movieImdbRating">IMDB PuanÄ±</label>
                    <input type="number" id="movieImdbRating" name="movieImdbRating" class="form-control" 
                           min="0" max="10" step="0.1" placeholder="7.5">
                    <small class="text-gray-400 mt-1">0-10 arasÄ± puan girebilirsiniz (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- AÃ§Ä±klama -->
                <div class="form-group">
                    <label for="movieDescription">AÃ§Ä±klama</label>
                    <textarea id="movieDescription" name="movieDescription" class="form-control" 
                              rows="3" placeholder="Film hakkÄ±nda kÄ±sa aÃ§Ä±klama..."></textarea>
                    <small class="text-gray-400 mt-1">Film hakkÄ±nda kÄ±sa bir aÃ§Ä±klama yazabilirsiniz (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- Resim Linki -->
                <div class="form-group">
                    <label for="movieImageUrl">Resim Linki</label>
                    <input type="url" id="movieImageUrl" name="movieImageUrl" class="form-control" 
                           placeholder="https://example.com/image.jpg">
                    <small class="text-gray-400 mt-1">Film posteri veya kapak resmi linki (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <div class="form-group">
                    <label class="flex items-center">
                        <input type="checkbox" id="movieWatched" class="mr-2">
                        <span>Ä°zlendi</span>
                    </label>
                </div>
                <div class="action-buttons">
                    <button type="button" id="cancelMovie" class="btn btn-secondary flex-1">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary flex-1">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data storage
        let seriesData = JSON.parse(localStorage.getItem('seriesData')) || [];
        let moviesData = JSON.parse(localStorage.getItem('moviesData')) || [];
        let categoriesData = JSON.parse(localStorage.getItem('categoriesData')) || [
            { id: 1, name: 'Aksiyon', color: '#ef4444' },
            { id: 2, name: 'Komedi', color: '#f59e0b' },
            { id: 3, name: 'Dram', color: '#10b981' },
            { id: 4, name: 'Bilim Kurgu', color: '#6366f1' },
            { id: 5, name: 'Fantastik', color: '#8b5cf6' }
        ];
        let tagsData = JSON.parse(localStorage.getItem('tagsData')) || [];
        let filteredSeriesData = [...seriesData];
        let filteredMoviesData = [...moviesData];
        let currentSeriesFilter = 'all';
        let currentMoviesFilter = 'all';
        let currentSeriesCategory = null;
        let currentMoviesCategory = null;
        let seriesView = '3';
        let moviesView = '3';

        // Image loading error handling
        function handleImageError(img) {
            img.style.display = 'none';
            const placeholder = img.parentElement;
            if (placeholder) {
                placeholder.innerHTML = `
                    <div class="w-full h-48 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                        <i class="fas fa-image text-gray-400 text-4xl"></i>
                    </div>
                `;
            }
        }

        function setupImageErrorHandling() {
            // Setup error handling for all images
            document.querySelectorAll('img').forEach(img => {
                if (!img.hasAttribute('data-error-handled')) {
                    img.setAttribute('data-error-handled', 'true');
                    img.addEventListener('error', function() {
                        handleImageError(this);
                    });
                }
            });
        }

        // Check for saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-theme');
            document.querySelector('#themeToggle i').className = 'fas fa-sun text-white text-xl';
        }

        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', function () {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');

            const icon = this.querySelector('i');
            icon.className = isDark ? 'fas fa-sun text-white text-xl' : 'fas fa-moon text-white text-xl';
        });

        // DOM Elements
        const seriesTab = document.getElementById('seriesTab');
        const moviesTab = document.getElementById('moviesTab');
        const categoriesTab = document.getElementById('categoriesTab');
        const tagsTab = document.getElementById('tagsTab');
        const seriesContent = document.getElementById('seriesContent');
        const moviesContent = document.getElementById('moviesContent');
        const categoriesContent = document.getElementById('categoriesContent');
        const tagsContent = document.getElementById('tagsContent');
        const seriesList = document.getElementById('seriesList');
        const moviesList = document.getElementById('moviesList');
        const categoriesList = document.getElementById('categoriesList');
        const seriesEmpty = document.getElementById('seriesEmpty');
        const moviesEmpty = document.getElementById('moviesEmpty');
        const totalStats = document.getElementById('totalStats');
        const seriesStats = document.getElementById('seriesStats');
        const moviesStats = document.getElementById('moviesStats');
        const addSeriesBtn = document.getElementById('addSeriesBtn');
        const addSeriesBtnEmpty = document.getElementById('addSeriesBtnEmpty');
        const addMovieBtn = document.getElementById('addMovieBtn');
        const addMovieBtnEmpty = document.getElementById('addMovieBtnEmpty');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const seriesModal = document.getElementById('seriesModal');
        const movieModal = document.getElementById('movieModal');
        const searchSeries = document.getElementById('searchSeries');
        const searchMovies = document.getElementById('searchMovies');
        const seriesTagCloud = document.getElementById('seriesTagCloud');
        const moviesTagCloud = document.getElementById('moviesTagCloud');

        // Initialize the app
        function initApp() {
            updateTotalStats();
            renderSeriesList();
            renderMoviesList();
            renderCategoriesList();
            renderCategoryFilters();
            renderTagsList();
            updateSeriesCategorySelector();
            updateMovieCategorySelector();
            updateSeriesTagCloud();
            updateMoviesTagCloud();

            // Initialize tag inputs
            initTagInput('seriesTagsInput', 'seriesTagsContainer');
            initTagInput('movieTagsInput', 'movieTagsContainer');

            // Event delegation for edit and delete buttons
            setupEventDelegation();
        }

        // Event delegation setup
        function setupEventDelegation() {
            // Series edit and delete buttons
            document.addEventListener('click', function(e) {
                // Series edit button
                if (e.target.closest('.edit-icon') && e.target.closest('.series-card')) {
                    const editBtn = e.target.closest('.edit-icon');
                    const name = editBtn.getAttribute('data-name');
                    const seriesInfo = seriesData.find(s => s.name === name);
                    if (seriesInfo) {
                        editSeries(seriesInfo.id);
                    }
                }
                
                // Series delete button
                if (e.target.closest('.delete-icon') && e.target.closest('.series-card')) {
                    const deleteBtn = e.target.closest('.delete-icon');
                    const name = deleteBtn.getAttribute('data-name');
                    if (confirm(`"${name}" dizisinin tÃ¼m sezonlarÄ±nÄ± silmek istediÄŸinize emin misiniz?`)) {
                        seriesData = seriesData.filter(s => s.name !== name);
                        localStorage.setItem('seriesData', JSON.stringify(seriesData));
                        filteredSeriesData = [...seriesData];
                        renderSeriesList();
                        renderCategoryFilters();
                        updateTotalStats();
                        updateSeriesTagCloud();
                    }
                }

                // Movie edit button
                if (e.target.closest('.edit-icon') && e.target.closest('.movie-card')) {
                    const editBtn = e.target.closest('.edit-icon');
                    const id = editBtn.getAttribute('data-id');
                    editMovie(id);
                }

                // Movie delete button
                if (e.target.closest('.delete-icon') && e.target.closest('.movie-card')) {
                    const deleteBtn = e.target.closest('.delete-icon');
                    const id = deleteBtn.getAttribute('data-id');
                    if (confirm('Bu filmi silmek istediÄŸinize emin misiniz?')) {
                        moviesData = moviesData.filter(m => m.id != id);
                        localStorage.setItem('moviesData', JSON.stringify(moviesData));
                        filteredMoviesData = [...moviesData];
                        renderMoviesList();
                        renderCategoryFilters();
                        updateTotalStats();
                        updateMoviesTagCloud();
                    }
                }
            });
        }

        // Render category chips with counts for series and movies
        function renderCategoryFilters() {
            const seriesContainer = document.getElementById('seriesCategoryFilters');
            const moviesContainer = document.getElementById('moviesCategoryFilters');
            if (!seriesContainer || !moviesContainer) return;

            seriesContainer.innerHTML = '';
            moviesContainer.innerHTML = '';

            categoriesData.forEach(cat => {
                const seriesCount = seriesData.filter(s => s.categories && s.categories.includes(cat.id)).length;
                const movieCount = moviesData.filter(m => m.categories && m.categories.includes(cat.id)).length;

                const sChip = document.createElement('button');
                sChip.className = 'category-option';
                sChip.style.backgroundColor = cat.color;
                sChip.style.color = 'white';
                sChip.setAttribute('data-id', cat.id);
                sChip.innerHTML = `${cat.name} <span>(${seriesCount})</span>`;
                sChip.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const id = parseInt(this.getAttribute('data-id'));
                    if (currentSeriesCategory === id) currentSeriesCategory = null; else currentSeriesCategory = id;
                    // visually mark selected
                    document.querySelectorAll('#seriesCategoryFilters .category-option').forEach(b => b.classList.remove('selected'));
                    if (currentSeriesCategory) {
                        const el = document.querySelector(`#seriesCategoryFilters .category-option[data-id=\"${currentSeriesCategory}\"]`);
                        if (el) el.classList.add('selected');
                    }
                    filterSeries();
                });

                const mChip = document.createElement('button');
                mChip.className = 'category-option';
                mChip.style.backgroundColor = cat.color;
                mChip.style.color = 'white';
                mChip.setAttribute('data-id', cat.id);
                mChip.innerHTML = `${cat.name} <span>(${movieCount})</span>`;
                mChip.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const id = parseInt(this.getAttribute('data-id'));
                    if (currentMoviesCategory === id) currentMoviesCategory = null; else currentMoviesCategory = id;
                    document.querySelectorAll('#moviesCategoryFilters .category-option').forEach(b => b.classList.remove('selected'));
                    if (currentMoviesCategory) {
                        const el = document.querySelector(`#moviesCategoryFilters .category-option[data-id=\"${currentMoviesCategory}\"]`);
                        if (el) el.classList.add('selected');
                    }
                    filterMovies();
                });

                seriesContainer.appendChild(sChip);
                moviesContainer.appendChild(mChip);
            });
        }

        // Update total stats
        function updateTotalStats() {
            const seriesCount = seriesData.length;
            const moviesCount = moviesData.length;
            const total = seriesCount + moviesCount;
            
            seriesStats.textContent = seriesCount;
            moviesStats.textContent = moviesCount;
            totalStats.textContent = total;
        }

        // Render series list
        // Group series by name
        function groupSeriesByName(series) {
            const grouped = {};
            series.forEach(s => {
                if (!grouped[s.name]) {
                    grouped[s.name] = {
                        name: s.name,
                        platform: s.platform,
                        categories: s.categories,
                        tags: s.tags,
                        trailerUrl: s.trailerUrl,
                        imdbRating: s.imdbRating,
                        description: s.description,
                        imageUrl: s.imageUrl,
                        seasons: []
                    };
                }
                grouped[s.name].seasons.push({
                    id: s.id,
                    season: s.season,
                    totalEpisodes: s.totalEpisodes,
                    watchedEpisodes: s.watchedEpisodes,
                    updatedAt: s.updatedAt
                });
                // Sort seasons
                grouped[s.name].seasons.sort((a, b) => a.season - b.season);
            });
            return Object.values(grouped);
        }

        function renderSeriesList() {
            if (filteredSeriesData.length === 0) {
                seriesList.innerHTML = '';
                seriesEmpty.classList.remove('hidden');
                return;
            }

            seriesEmpty.classList.add('hidden');

            // Group series by name
            const groupedSeries = groupSeriesByName(filteredSeriesData);

            // Update grid view
            seriesList.className = `grid gap-6 grid-${seriesView}-col`;

            seriesList.innerHTML = groupedSeries.map(series => {
                // Get overall status based on all seasons
                const allSeasons = series.seasons;
                const totalEpisodes = allSeasons.reduce((sum, s) => sum + s.totalEpisodes, 0);
                const watchedEpisodes = allSeasons.reduce((sum, s) => sum + s.watchedEpisodes, 0);
                const progress = totalEpisodes > 0 ? (watchedEpisodes / totalEpisodes) * 100 : 0;
                const status = totalEpisodes > 0 && watchedEpisodes === totalEpisodes ? 'completed'
                    : watchedEpisodes > 0 ? 'watching'
                        : 'planning';

                // Kategori badge'leri
                const categoryBadges = series.categories && series.categories.length > 0
                    ? series.categories.map(catId => {
                        const category = categoriesData.find(c => c.id === catId);
                        if (category) {
                            return `<span class="category-badge" style="background-color: ${category.color}">${category.name}</span>`;
                        }
                        return '';
                    }).join('')
                    : '';

                // Etiketler
                const tags = series.tags && series.tags.length > 0
                    ? series.tags.map(tag => `<span class="tag">${tag}</span>`).join('')
                    : '';

                // Sezonlar
                const seasonsHtml = series.seasons.map(season => {
                    const seasonProgress = season.totalEpisodes > 0 ? (season.watchedEpisodes / season.totalEpisodes) * 100 : 0;
                    const seasonStatus = season.totalEpisodes > 0 && season.watchedEpisodes === season.totalEpisodes ? 'completed'
                        : season.watchedEpisodes > 0 ? 'watching'
                            : 'planning';

                    return `
                        <div class="season-item p-4 mb-2 bg-gray-50 dark:bg-gray-800 rounded-lg">
                            <div class="flex justify-between items-center cursor-pointer season-header" data-season="${season.season}">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-chevron-down season-toggle"></i>
                                    <span class="font-medium">Sezon ${season.season}</span>
                                    <span class="status-badge ${seasonStatus}">${getStatusText(seasonStatus)}</span>
                                </div>
                                <span>${season.watchedEpisodes}/${season.totalEpisodes}</span>
                            </div>
                            <div class="season-content">
                                <div class="content-inner">
                                    <div class="mb-2">
                                        <div class="flex justify-between text-sm mb-1">
                                            <span>Ä°zlenen BÃ¶lÃ¼m</span>
                                            <span>${Math.round(seasonProgress)}%</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill bg-gradient-to-r from-blue-500 to-purple-500" 
                                                 style="width: ${seasonProgress}%"></div>
                                        </div>
                                    </div>
                                    <div class="flex justify-end space-x-2 mt-4">
                                        <button class="btn btn-secondary btn-sm decrease-episode" data-id="${season.id}">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <button class="btn btn-primary btn-sm increase-episode" data-id="${season.id}">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="series-card card p-6 relative">
                        ${series.imageUrl ? `<div class="mb-4"><img src="${series.imageUrl}" alt="${series.name}" class="w-full h-48 object-cover rounded-lg" onerror="handleImageError(this)"></div>` : ''}
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold mb-1">${series.name}</h3>
                                <div class="text-gray-600 dark:text-gray-300 mb-2">
                                    <span class="status-badge ${status}">${getStatusText(status)}</span>
                                    <span class="ml-2">${series.platform}</span>
                                    ${series.imdbRating ? `<span class="ml-2 text-yellow-500"><i class="fas fa-star"></i> ${series.imdbRating}</span>` : ''}
                                </div>
                                ${series.description ? `<p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${series.description}</p>` : ''}
                            </div>
                            <div class="flex space-x-1">
                                ${series.trailerUrl ? `<button class="trailer-btn" data-trailer-url="${series.trailerUrl}" data-title="${series.name}">
                                    <i class="fab fa-youtube"></i> Fragman
                                </button>` : ''}
                                <button class="edit-icon text-blue-500 hover:text-blue-700" data-name="${series.name}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-icon text-red-500 hover:text-red-700" data-name="${series.name}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        ${categoryBadges ? `<div class="mb-3">${categoryBadges}</div>` : ''}
                        ${tags ? `<div class="mb-3">${tags}</div>` : ''}

                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span>Toplam BÃ¶lÃ¼m: ${watchedEpisodes}/${totalEpisodes}</span>
                                <span>${Math.round(progress)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-gradient-to-r from-blue-500 to-purple-500" style="width: ${progress}%"></div>
                            </div>
                        </div>

                        <div class="seasons-container">
                            ${seasonsHtml}
                        </div>
                    </div>
                `;
            }).join('');

            // Add event listeners
            // Add click event for season headers to toggle content
            document.querySelectorAll('.season-header').forEach(header => {
                header.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const content = this.closest('.season-item').querySelector('.season-content');
                    const toggle = this.querySelector('.season-toggle');

                    // Toggle the content
                    if (content.classList.contains('show')) {
                        content.classList.remove('show');
                        toggle.classList.remove('rotate');
                    } else {
                        content.classList.add('show');
                        toggle.classList.add('rotate');
                    }
                });
            });

            // Edit series event listener - Event delegation kullanarak
            // Bu event listener'lar sadece bir kez eklenir ve dinamik iÃ§erik iÃ§in Ã§alÄ±ÅŸÄ±r

            // Delete icon event listener da event delegation ile eklenecek

            document.querySelectorAll('.increase-episode').forEach(btn => {
                btn.addEventListener('click', function (event) {
                    event.stopPropagation();
                    const id = this.getAttribute('data-id');
                    const seasonItemData = seriesData.find(s => s.id == id);
                    if (seasonItemData && seasonItemData.watchedEpisodes < seasonItemData.totalEpisodes) {
                        seasonItemData.watchedEpisodes++;
                        seasonItemData.updatedAt = new Date().toISOString();
                        localStorage.setItem('seriesData', JSON.stringify(seriesData));

                        // Update the DOM in-place so open sections/modal are not affected
                        const seasonItem = this.closest('.season-item');
                        if (seasonItem) {
                            // Update header count (the second direct span child of .season-header)
                            const headerCount = seasonItem.querySelector('.season-header > span');
                            if (headerCount) headerCount.textContent = `${seasonItemData.watchedEpisodes}/${seasonItemData.totalEpisodes}`;

                            // Update season percentage text inside content
                            const percentText = seasonItem.querySelector('.content-inner .flex.justify-between span:last-child');
                            const pct = seasonItemData.totalEpisodes > 0 ? Math.round((seasonItemData.watchedEpisodes / seasonItemData.totalEpisodes) * 100) : 0;
                            if (percentText) percentText.textContent = `${pct}%`;

                            // Update progress bar fill for this season
                            const progressFill = seasonItem.querySelector('.progress-fill');
                            if (progressFill) progressFill.style.width = `${pct}%`;

                            // Update season status badge
                            const seasonStatus = seasonItemData.totalEpisodes > 0 && seasonItemData.watchedEpisodes === seasonItemData.totalEpisodes ? 'completed'
                                : seasonItemData.watchedEpisodes > 0 ? 'watching'
                                    : 'planning';
                            const statusBadge = seasonItem.querySelector('.status-badge');
                            if (statusBadge) {
                                statusBadge.className = `status-badge ${seasonStatus}`;
                                statusBadge.textContent = getStatusText(seasonStatus);
                            }
                        }

                        // Update overall series card totals and progress without full re-render
                        const card = this.closest('.series-card');
                        if (card) {
                            const seriesNameEl = card.querySelector('h3');
                            const seriesName = seriesNameEl ? seriesNameEl.textContent : null;
                            if (seriesName) {
                                const allSeasons = seriesData.filter(s => s.name === seriesName);
                                const totalEpisodes = allSeasons.reduce((sum, s) => sum + s.totalEpisodes, 0);
                                const watchedEpisodes = allSeasons.reduce((sum, s) => sum + s.watchedEpisodes, 0);
                                const overallPct = totalEpisodes > 0 ? Math.round((watchedEpisodes / totalEpisodes) * 100) : 0;

                                const totalSpan = card.querySelector('.mb-4 .flex.justify-between span');
                                if (totalSpan) totalSpan.textContent = `Toplam BÃ¶lÃ¼m: ${watchedEpisodes}/${totalEpisodes}`;

                                const overallPctSpan = card.querySelector('.mb-4 .flex.justify-between span:last-child');
                                if (overallPctSpan) overallPctSpan.textContent = `${overallPct}%`;

                                const overallFill = card.querySelector('.progress-bar .progress-fill');
                                if (overallFill) overallFill.style.width = `${overallPct}%`;
                            }
                        }
                    }
                });
            });
            document.querySelectorAll('.decrease-episode').forEach(btn => {
                btn.addEventListener('click', function (event) {
                    event.stopPropagation();
                    const id = this.getAttribute('data-id');
                    const seasonItemData = seriesData.find(s => s.id == id);
                    if (seasonItemData && seasonItemData.watchedEpisodes > 0) {
                        seasonItemData.watchedEpisodes--;
                        seasonItemData.updatedAt = new Date().toISOString();
                        localStorage.setItem('seriesData', JSON.stringify(seriesData));

                        // Update DOM in-place
                        const seasonItem = this.closest('.season-item');
                        if (seasonItem) {
                            const headerCount = seasonItem.querySelector('.season-header > span');
                            if (headerCount) headerCount.textContent = `${seasonItemData.watchedEpisodes}/${seasonItemData.totalEpisodes}`;

                            const pct = seasonItemData.totalEpisodes > 0 ? Math.round((seasonItemData.watchedEpisodes / seasonItemData.totalEpisodes) * 100) : 0;
                            const percentText = seasonItem.querySelector('.content-inner .flex.justify-between span:last-child');
                            if (percentText) percentText.textContent = `${pct}%`;

                            const progressFill = seasonItem.querySelector('.progress-fill');
                            if (progressFill) progressFill.style.width = `${pct}%`;

                            // Update season status badge
                            const seasonStatus = seasonItemData.totalEpisodes > 0 && seasonItemData.watchedEpisodes === seasonItemData.totalEpisodes ? 'completed'
                                : seasonItemData.watchedEpisodes > 0 ? 'watching'
                                    : 'planning';
                            const statusBadge = seasonItem.querySelector('.status-badge');
                            if (statusBadge) {
                                statusBadge.className = `status-badge ${seasonStatus}`;
                                statusBadge.textContent = getStatusText(seasonStatus);
                            }
                        }

                        // Update overall series card totals and progress
                        const card = this.closest('.series-card');
                        if (card) {
                            const seriesNameEl = card.querySelector('h3');
                            const seriesName = seriesNameEl ? seriesNameEl.textContent : null;
                            if (seriesName) {
                                const allSeasons = seriesData.filter(s => s.name === seriesName);
                                const totalEpisodes = allSeasons.reduce((sum, s) => sum + s.totalEpisodes, 0);
                                const watchedEpisodes = allSeasons.reduce((sum, s) => sum + s.watchedEpisodes, 0);
                                const overallPct = totalEpisodes > 0 ? Math.round((watchedEpisodes / totalEpisodes) * 100) : 0;

                                const totalSpan = card.querySelector('.mb-4 .flex.justify-between span');
                                if (totalSpan) totalSpan.textContent = `Toplam BÃ¶lÃ¼m: ${watchedEpisodes}/${totalEpisodes}`;

                                const overallPctSpan = card.querySelector('.mb-4 .flex.justify-between span:last-child');
                                if (overallPctSpan) overallPctSpan.textContent = `${overallPct}%`;

                                const overallFill = card.querySelector('.progress-bar .progress-fill');
                                if (overallFill) overallFill.style.width = `${overallPct}%`;
                            }
                        }
                    }
                });
            });

            // Setup image error handling after DOM update
            setTimeout(setupImageErrorHandling, 100);
        }

        // Render movies list
        function renderMoviesList() {
            if (filteredMoviesData.length === 0) {
                moviesList.innerHTML = '';
                moviesEmpty.classList.remove('hidden');
                return;
            }

            moviesEmpty.classList.add('hidden');

            // Update grid view
            moviesList.className = `grid gap-6 grid-${moviesView}-col`;

            moviesList.innerHTML = filteredMoviesData.map(movie => {
                // Kategori badge'leri
                const categoryBadges = movie.categories && movie.categories.length > 0
                    ? movie.categories.map(catId => {
                        const category = categoriesData.find(c => c.id === catId);
                        if (category) {
                            return `<span class="category-badge" style="background-color: ${category.color}">${category.name}</span>`;
                        }
                        return '';
                    }).join('')
                    : '';

                // Etiketler
                const tags = movie.tags && movie.tags.length > 0
                    ? movie.tags.map(tag => `<span class="tag">${tag}</span>`).join('')
                    : '';

                return `
                    <div class="movie-card card p-6 relative">
                        ${movie.imageUrl ? `<div class="mb-4"><img src="${movie.imageUrl}" alt="${movie.name}" class="w-full h-48 object-cover rounded-lg" onerror="handleImageError(this)"></div>` : ''}
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold mb-1">${movie.name}</h3>
                                <div class="text-gray-600 dark:text-gray-300 mb-2">
                                    <span class="status-badge ${movie.watched ? 'completed' : 'planning'}">${movie.watched ? 'Ä°zlendi' : 'Ä°zlenecek'}</span>
                                    ${movie.imdbRating ? `<span class="ml-2 text-yellow-500"><i class="fas fa-star"></i> ${movie.imdbRating}</span>` : ''}
                                </div>
                                ${movie.description ? `<p class="text-sm text-gray-600 dark:text-gray-400 mb-2">${movie.description}</p>` : ''}
                            </div>
                            <div class="flex space-x-2">
                                ${movie.trailerUrl ? `<button class="trailer-btn" data-trailer-url="${movie.trailerUrl}" data-title="${movie.name}">
                                    <i class="fab fa-youtube"></i> Fragman
                                </button>` : ''}
                                <button class="edit-icon text-blue-500 hover:text-blue-700" data-id="${movie.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-icon text-red-500 hover:text-red-700" data-id="${movie.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        
                        ${categoryBadges ? `<div class="mb-3">${categoryBadges}</div>` : ''}
                        ${tags ? `<div class="mb-3">${tags}</div>` : ''}
                        
                        <div class="flex items-center mb-4">
                            <span class="watched-indicator ${movie.watched ? 'watched' : 'unwatched'}"></span>
                            <span class="text-sm">${movie.watched ? 'Ä°zlendi' : 'HenÃ¼z izlenmedi'}</span>
                        </div>
                        
                        <div class="text-sm text-gray-600 dark:text-gray-300">
                            <i class="fas fa-clock mr-1"></i> ${formatDate(movie.updatedAt)}
                        </div>
                    </div>
                `;
            }).join('');

            // Event listeners artÄ±k event delegation ile yÃ¶netiliyor
            
            // Setup image error handling after DOM update
            setTimeout(setupImageErrorHandling, 100);
        }

        // Render categories list
        function renderCategoriesList() {
            categoriesList.innerHTML = categoriesData.map(category => `
                <div class="card p-4 flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="w-4 h-4 rounded-full mr-3" style="background-color: ${category.color}"></span>
                        <span class="font-medium">${category.name}</span>
                    </div>
                    <button class="text-red-500 hover:text-red-700 delete-category" data-id="${category.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');

            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-category').forEach(btn => {
                btn.addEventListener('click', function () {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteCategory(id);
                });
            });
        }

        // Render tags list
        function renderTagsList() {
            const tagsList = document.getElementById('tagsList');
            tagsList.innerHTML = tagsData.map(tag => `
                <div class="card p-4 flex items-center justify-between">
                    <span class="font-medium">${tag.name}</span>
                    <button class="text-red-500 hover:text-red-700 delete-tag" data-id="${tag.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');

            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-tag').forEach(btn => {
                btn.addEventListener('click', function () {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteTag(id);
                });
            });
        }

        // Update series category selector
        function updateSeriesCategorySelector() {
            const selector = document.getElementById('seriesCategorySelector');
            selector.innerHTML = categoriesData.map(category => `
                <div class="category-option" data-id="${category.id}" style="background-color: ${category.color}; color: white;">
                    ${category.name}
                </div>
            `).join('');

            // Add event listeners
            document.querySelectorAll('#seriesCategorySelector .category-option').forEach(option => {
                option.addEventListener('click', function () {
                    this.classList.toggle('selected');
                });
            });
        }

        // Update movie category selector
        function updateMovieCategorySelector() {
            const selector = document.getElementById('movieCategorySelector');
            selector.innerHTML = categoriesData.map(category => `
                <div class="category-option" data-id="${category.id}" style="background-color: ${category.color}; color: white;">
                    ${category.name}
                </div>
            `).join('');

            // Add event listeners
            document.querySelectorAll('#movieCategorySelector .category-option').forEach(option => {
                option.addEventListener('click', function () {
                    this.classList.toggle('selected');
                });
            });
        }

        // Update series tag cloud
        function updateSeriesTagCloud() {
            const allTags = new Set();
            seriesData.forEach(series => {
                if (series.tags && series.tags.length > 0) {
                    series.tags.forEach(tag => allTags.add(tag));
                }
            });

            if (allTags.size > 0) {
                seriesTagCloud.classList.remove('hidden'); // Ensure visibility
                seriesTagCloud.style.display = 'flex'; // Explicitly set display
                seriesTagCloud.innerHTML = Array.from(allTags).map(tag =>
                    `<span class="tag" data-tag="${tag}">${tag}</span>`
                ).join('');

                // Add event listeners
                document.querySelectorAll('#seriesTagCloud .tag').forEach(tagEl => {
                    tagEl.addEventListener('click', function () {
                        const tag = this.getAttribute('data-tag');
                        searchSeries.value = tag;
                        filterSeries();
                    });
                });
            } else {
                seriesTagCloud.classList.add('hidden');
                seriesTagCloud.style.display = 'none'; // Ensure hidden state
            }
        }

        // Update movies tag cloud
        function updateMoviesTagCloud() {
            const allTags = new Set();
            moviesData.forEach(movie => {
                if (movie.tags && movie.tags.length > 0) {
                    movie.tags.forEach(tag => allTags.add(tag));
                }
            });

            if (allTags.size > 0) {
                moviesTagCloud.classList.remove('hidden'); // Ensure visibility
                moviesTagCloud.style.display = 'flex'; // Explicitly set display
                moviesTagCloud.innerHTML = Array.from(allTags).map(tag =>
                    `<span class="tag" data-tag="${tag}">${tag}</span>`
                ).join('');

                // Add event listeners
                document.querySelectorAll('#moviesTagCloud .tag').forEach(tagEl => {
                    tagEl.addEventListener('click', function () {
                        const tag = this.getAttribute('data-tag');
                        searchMovies.value = tag;
                        filterMovies();
                    });
                });
            } else {
                moviesTagCloud.classList.add('hidden');
                moviesTagCloud.style.display = 'none'; // Ensure hidden state
            }
        }

        // Get series status
        function getSeriesStatus(series) {
            if (series.totalEpisodes > 0 && series.watchedEpisodes === series.totalEpisodes) {
                return 'completed';
            } else if (series.watchedEpisodes > 0) {
                return 'watching';
            } else {
                return 'planning';
            }
        }

        // Get status text
        function getStatusText(status) {
            switch (status) {
                case 'completed': return 'TamamlandÄ±';
                case 'watching': return 'Ä°zleniyor';
                case 'planning': return 'PlanlanÄ±yor';
                case 'paused': return 'DuraklatÄ±ldÄ±';
                default: return '';
            }
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // YouTube video ID Ã§Ä±karma fonksiyonu
        function extractYouTubeVideoId(url) {
            if (!url) return null;
            
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        }

        // YouTube URL'den video ID'sini Ã§Ä±kar
        function extractYouTubeVideoId(url) {
            if (!url) return null;
            
            // EÄŸer sadece video ID ise direkt dÃ¶ndÃ¼r
            if (url.length === 11 && /^[a-zA-Z0-9_-]+$/.test(url)) {
                return url;
            }
            
            // YouTube URL formatlarÄ±nÄ± kontrol et
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/,
                /youtube\.com\/watch\?.*v=([a-zA-Z0-9_-]{11})/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) {
                    return match[1];
                }
            }
            
            return null;
        }

        // YouTube fragman modal'Ä±nÄ± gÃ¶ster
        function showTrailerModal(videoUrl, title) {
            console.log('showTrailerModal Ã§aÄŸrÄ±ldÄ±:', videoUrl, title);
            
            const videoId = extractYouTubeVideoId(videoUrl);
            console.log('Ã‡Ä±karÄ±lan video ID:', videoId);
            
            if (!videoId) {
                console.log('GeÃ§erli video ID bulunamadÄ±, fonksiyon sonlandÄ±rÄ±lÄ±yor');
                alert('GeÃ§erli bir YouTube URL\'si veya video ID\'si giriniz.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal trailer-modal active';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="trailer-modal-content">
                    <div class="modal-header">
                        <h3>${title} - Fragman</h3>
                        <button class="close-trailer-btn">&times;</button>
                    </div>
                    <div class="trailer-container">
                        <iframe 
                            width="100%" 
                            height="100%"
                            src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&showinfo=0&modestbranding=1" 
                            frameborder="0" 
                            allowfullscreen
                            allow="autoplay; encrypted-media; fullscreen">
                        </iframe>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Modal'Ä± kapatma
            const closeBtn = modal.querySelector('.close-trailer-btn');
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        // Filter series
        function filterSeries() {
            const searchTerm = searchSeries.value.toLowerCase();

            filteredSeriesData = seriesData.filter(series => {
                // Arama terimi ile filtreleme
                const matchesSearch = series.name.toLowerCase().includes(searchTerm) ||
                    (series.tags && series.tags.some(tag => tag.toLowerCase().includes(searchTerm)));

                // Durum ile filtreleme
                let matchesFilter = true;
                if (currentSeriesFilter !== 'all') {
                    const status = getSeriesStatus(series);
                    matchesFilter = status === currentSeriesFilter;
                }
                // Category filter
                if (currentSeriesCategory) {
                    matchesFilter = matchesFilter && (series.categories && series.categories.includes(currentSeriesCategory));
                }

                return matchesSearch && matchesFilter;
            });

            renderSeriesList();
        }

        // Filter movies
        function filterMovies() {
            const searchTerm = searchMovies.value.toLowerCase();

            filteredMoviesData = moviesData.filter(movie => {
                // Arama terimi ile filtreleme
                const matchesSearch = movie.name.toLowerCase().includes(searchTerm) ||
                    (movie.tags && movie.tags.some(tag => tag.toLowerCase().includes(searchTerm)));

                // Durum ile filtreleme
                let matchesFilter = true;
                if (currentMoviesFilter !== 'all') {
                    if (currentMoviesFilter === 'watched') {
                        matchesFilter = movie.watched;
                    } else if (currentMoviesFilter === 'not-watched') {
                        matchesFilter = !movie.watched;
                    }
                }
                // Category filter for movies
                if (currentMoviesCategory) {
                    matchesFilter = matchesFilter && (movie.categories && movie.categories.includes(currentMoviesCategory));
                }

                return matchesSearch && matchesFilter;
            });

            renderMoviesList();
        }

        // Add new series
        function addSeries() {
            document.getElementById('seriesModalTitle').textContent = 'Dizi Ekle';
            document.getElementById('seriesId').value = '';
            document.getElementById('seriesName').value = '';
            document.getElementById('seriesPlatform').value = 'Netflix';

            // Reset kategori seÃ§imi
            document.querySelectorAll('#seriesCategorySelector .category-option').forEach(option => {
                option.classList.remove('selected');
            });

            // Reset etiketler
            document.getElementById('seriesTagsContainer').innerHTML = '<input type="text" id="seriesTagsInput" class="tag-input" placeholder="Etiket ekle ve Enter\'a bas">';
            initTagInput('seriesTagsInput', 'seriesTagsContainer');
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');

            // Sezon formunu temizle ve ilk sezonu ekle
            document.getElementById('seasonsContainer').innerHTML = '';
            seasonCounter = 0;
            addSeasonForm();

            seriesModal.classList.add('active');
        }

        // Edit series
        function editSeries(id) {
            const series = seriesData.find(s => s.id == id);
            if (!series) return;

            // AynÄ± isimli tÃ¼m sezonlarÄ± bul
            const allSeasons = seriesData.filter(s => s.name === series.name);

            document.getElementById('seriesModalTitle').textContent = 'Diziyi DÃ¼zenle';
            document.getElementById('seriesId').value = series.id;
            document.getElementById('seriesName').value = series.name;
            document.getElementById('seriesPlatform').value = series.platform;
            document.getElementById('seriesTrailerUrl').value = series.trailerUrl || '';
            document.getElementById('seriesImdbRating').value = series.imdbRating || '';
            document.getElementById('seriesDescription').value = series.description || '';
            document.getElementById('seriesImageUrl').value = series.imageUrl || '';

            // Kategori seÃ§imini ayarla
            document.querySelectorAll('#seriesCategorySelector .category-option').forEach(option => {
                const catId = parseInt(option.getAttribute('data-id'));
                if (series.categories && series.categories.includes(catId)) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });

            // Etiketleri ayarla
            const tagsContainer = document.getElementById('seriesTagsContainer');
            tagsContainer.innerHTML = '';
            if (series.tags && series.tags.length > 0) {
                series.tags.forEach(tag => {
                    const tagEl = createTagElement(tag, tagsContainer, false);
                    tagsContainer.appendChild(tagEl);
                });
            }
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'seriesTagsInput';
            input.className = 'tag-input';
            input.placeholder = 'Etiket ekle ve Enter\'a bas';
            tagsContainer.appendChild(input);
            initTagInput('seriesTagsInput', 'seriesTagsContainer');
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');

            // Sezon seÃ§icisini doldur
            loadSeasonsToSelector(allSeasons, series.id);

            seriesModal.classList.add('active');
        }

        // Delete series
        function deleteSeries(id) {
            if (confirm('Bu diziyi silmek istediÄŸinize emin misiniz?')) {
                seriesData = seriesData.filter(s => s.id != id);
                localStorage.setItem('seriesData', JSON.stringify(seriesData));
                filterSeries();
                renderCategoryFilters();
                updateTotalStats();
                updateSeriesTagCloud();
            }
        }

        // Increase episode
        function increaseEpisode(id) {
            const series = seriesData.find(s => s.id == id);
            if (series && series.watchedEpisodes < series.totalEpisodes) {
                series.watchedEpisodes++;
                series.updatedAt = new Date().toISOString();
                localStorage.setItem('seriesData', JSON.stringify(seriesData));
                filterSeries();
            }
        }

        // Decrease episode
        function decreaseEpisode(id) {
            const series = seriesData.find(s => s.id == id);
            if (series && series.watchedEpisodes > 0) {
                series.watchedEpisodes--;
                series.updatedAt = new Date().toISOString();
                localStorage.setItem('seriesData', JSON.stringify(seriesData));
                filterSeries();
            }
        }

        // Add new movie
        function addMovie() {
            document.getElementById('movieModalTitle').textContent = 'Film Ekle';
            document.getElementById('movieId').value = '';
            document.getElementById('movieName').value = '';
            document.getElementById('movieWatched').checked = false;

            // Reset kategori seÃ§imi
            document.querySelectorAll('#movieCategorySelector .category-option').forEach(option => {
                option.classList.remove('selected');
            });

            // Reset etiketler
            document.getElementById('movieTagsContainer').innerHTML = '<input type="text" id="movieTagsInput" class="tag-input" placeholder="Etiket ekle ve Enter\'a bas">';
            initTagInput('movieTagsInput', 'movieTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');

            movieModal.classList.add('active');
        }

        // Edit movie
        function editMovie(id) {
            const movie = moviesData.find(m => m.id == id);
            if (!movie) return;

            document.getElementById('movieModalTitle').textContent = 'Filmi DÃ¼zenle';
            document.getElementById('movieId').value = movie.id;
            document.getElementById('movieName').value = movie.name;
            document.getElementById('movieWatched').checked = movie.watched;
            document.getElementById('movieTrailerUrl').value = movie.trailerUrl || '';
            document.getElementById('movieImdbRating').value = movie.imdbRating || '';
            document.getElementById('movieDescription').value = movie.description || '';
            document.getElementById('movieImageUrl').value = movie.imageUrl || '';

            // Kategori seÃ§imini ayarla
            document.querySelectorAll('#movieCategorySelector .category-option').forEach(option => {
                const catId = parseInt(option.getAttribute('data-id'));
                if (movie.categories && movie.categories.includes(catId)) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });

            // Etiketleri ayarla
            const tagsContainer = document.getElementById('movieTagsContainer');
            tagsContainer.innerHTML = '';
            if (movie.tags && movie.tags.length > 0) {
                movie.tags.forEach(tag => {
                    const tagEl = createTagElement(tag, tagsContainer, false);
                    tagsContainer.appendChild(tagEl);
                });
            }
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'movieTagsInput';
            input.className = 'tag-input';
            input.placeholder = 'Etiket ekle ve Enter\'a bas';
            tagsContainer.appendChild(input);
            initTagInput('movieTagsInput', 'movieTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');

            movieModal.classList.add('active');
        }

        // Delete movie
        function deleteMovie(id) {
            if (confirm('Bu filmi silmek istediÄŸinize emin misiniz?')) {
                moviesData = moviesData.filter(m => m.id != id);
                localStorage.setItem('moviesData', JSON.stringify(moviesData));
                filterMovies();
                renderCategoryFilters();
                updateTotalStats();
                updateMoviesTagCloud();
            }
        }

        // Add new category
        function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            const color = document.getElementById('newCategoryColor').value;

            if (!name) {
                alert('LÃ¼tfen bir kategori adÄ± girin.');
                return;
            }

            const newId = categoriesData.length > 0 ? Math.max(...categoriesData.map(c => c.id)) + 1 : 1;
            categoriesData.push({
                id: newId,
                name: name,
                color: color
            });

            localStorage.setItem('categoriesData', JSON.stringify(categoriesData));

            // Reset form
            document.getElementById('newCategoryName').value = '';
            document.getElementById('newCategoryColor').value = '#6366f1';

            // Update UI
            renderCategoriesList();
            updateSeriesCategorySelector();
            updateMovieCategorySelector();
            renderCategoryFilters();
        }

        // Delete category
        function deleteCategory(id) {
            if (confirm('Bu kategoriyi silmek istediÄŸinize emin misiniz? Bu kategoriye sahip tÃ¼m iÃ§eriklerden bu kategori kaldÄ±rÄ±lacak.')) {
                // Kategoriyi iÃ§eriklerden kaldÄ±r
                seriesData.forEach(series => {
                    if (series.categories) {
                        series.categories = series.categories.filter(catId => catId !== id);
                    }
                });

                moviesData.forEach(movie => {
                    if (movie.categories) {
                        movie.categories = movie.categories.filter(catId => catId !== id);
                    }
                });

                // Kategoriyi sil
                categoriesData = categoriesData.filter(c => c.id !== id);

                // LocalStorage'Ä± gÃ¼ncelle
                localStorage.setItem('seriesData', JSON.stringify(seriesData));
                localStorage.setItem('moviesData', JSON.stringify(moviesData));
                localStorage.setItem('categoriesData', JSON.stringify(categoriesData));

                // UI'Ä± gÃ¼ncelle
                renderSeriesList();
                renderMoviesList();
                renderCategoriesList();
                updateSeriesCategorySelector();
                updateMovieCategorySelector();
                renderCategoryFilters();
            }
        }

        // Add new tag
        function addTag() {
            const name = document.getElementById('newTagName').value.trim();

            if (!name) {
                alert('LÃ¼tfen bir etiket adÄ± girin.');
                return;
            }

            const newId = tagsData.length > 0 ? Math.max(...tagsData.map(t => t.id)) + 1 : 1;
            tagsData.push({
                id: newId,
                name: name
            });

            localStorage.setItem('tagsData', JSON.stringify(tagsData));

            // Reset form
            document.getElementById('newTagName').value = '';

            // Update UI
            renderTagsList();
            // Refresh suggestion chips in modals
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');
        }

        // Delete tag
        function deleteTag(id) {
            if (confirm('Bu etiketi silmek istediÄŸinize emin misiniz?')) {
                tagsData = tagsData.filter(t => t.id !== id);
                localStorage.setItem('tagsData', JSON.stringify(tagsData));
                renderTagsList();
                renderTagOptions('seriesTagOptions', 'seriesTagsContainer');
                renderTagOptions('movieTagOptions', 'movieTagsContainer');
            }
        }

        // Initialize tag input
        function initTagInput(inputId, containerId) {
            const input = document.getElementById(inputId);
            const container = document.getElementById(containerId);

            input.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' && this.value.trim() !== '') {
                    e.preventDefault();

                    const tag = this.value.trim();
                    const tagEl = createTagElement(tag, container, false);
                    container.insertBefore(tagEl, this);
                    this.value = '';
                }
            });

            // Existing tags don't need delete buttons automatically added

            // If there are global tags, render suggestion chips (for series/movie modals)
            const suggestionsId = inputId === 'seriesTagsInput' ? 'seriesTagOptions' : (inputId === 'movieTagsInput' ? 'movieTagOptions' : null);
            if (suggestionsId) renderTagOptions(suggestionsId, containerId);
        }

        // Render selectable tag options under modal inputs
        function renderTagOptions(optionsContainerId, targetContainerId) {
            const optionsEl = document.getElementById(optionsContainerId);
            if (!optionsEl) return;

            // Clear existing
            optionsEl.innerHTML = '';

            tagsData.forEach(tag => {
                const chip = document.createElement('span');
                chip.className = 'tag';
                chip.textContent = tag.name;
                chip.setAttribute('data-tag', tag.name);

                chip.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const container = document.getElementById(targetContainerId);
                    // If already selected (there's a .tag with same text), remove it
                    const exists = Array.from(container.querySelectorAll('.tag')).some(t => t.firstChild && t.firstChild.textContent === tag.name);
                    if (exists) {
                        // remove first matching tag element (ignore delete button text)
                        const toRemove = Array.from(container.querySelectorAll('.tag')).find(t => t.firstChild && t.firstChild.textContent === tag.name);
                        if (toRemove) container.removeChild(toRemove);
                    } else {
                        const tagEl = createTagElement(tag.name, container, false);
                        // Insert before input if present
                        const input = container.querySelector('.tag-input');
                        if (input) container.insertBefore(tagEl, input);
                        else container.appendChild(tagEl);
                    }
                });

                optionsEl.appendChild(chip);
            });
        }

        // Create tag element with optional delete functionality
        function createTagElement(tag, container, showDeleteButton = true) {
            const tagEl = document.createElement('span');
            tagEl.className = 'tag';
            tagEl.textContent = tag;

            if (showDeleteButton) {
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-tag';
                deleteBtn.innerHTML = '&times;';
                deleteBtn.addEventListener('click', function () {
                    container.removeChild(tagEl);
                });
                tagEl.appendChild(deleteBtn);
            }

            return tagEl;
        }

        // Sezon yÃ¶netim fonksiyonlarÄ±
        let seasonCounter = 0;

        function addSeasonForm() {
            seasonCounter++;
            const container = document.getElementById('seasonsContainer');

            const seasonDiv = document.createElement('div');
            seasonDiv.className = 'season-form-item';
            seasonDiv.setAttribute('data-season-id', seasonCounter);

            seasonDiv.innerHTML = `
                <div class="season-form-header">
                    <span class="season-form-title">Sezon ${seasonCounter}</span>
                    <button type="button" class="remove-season-btn" onclick="removeSeasonForm(${seasonCounter})">
                        <i class="fas fa-times"></i> KaldÄ±r
                    </button>
                </div>
                <div class="season-form-fields">
                    <div class="form-group">
                        <label>Sezon NumarasÄ±</label>
                        <input type="number" class="form-control season-number" min="1" value="${seasonCounter}" required>
                    </div>
                    <div class="form-group">
                        <label>Toplam BÃ¶lÃ¼m</label>
                        <input type="number" class="form-control season-total-episodes" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Ä°zlenen BÃ¶lÃ¼m</label>
                        <input type="number" class="form-control season-watched-episodes" min="0" value="0">
                    </div>
                </div>
            `;

            container.appendChild(seasonDiv);
        }

        function removeSeasonForm(seasonId) {
            const seasonDiv = document.querySelector(`[data-season-id="${seasonId}"]`);
            if (seasonDiv) {
                seasonDiv.remove();
            }
        }

        function getSeasonsFromForm() {
            const seasons = [];
            document.querySelectorAll('.season-form-item').forEach(item => {
                const seasonNumberEl = item.querySelector('.season-number');
                const totalEpisodesEl = item.querySelector('.season-total-episodes');
                const watchedEpisodesEl = item.querySelector('.season-watched-episodes');

                if (!seasonNumberEl || !totalEpisodesEl || !watchedEpisodesEl) return;

                const seasonNumber = parseInt(seasonNumberEl.value) || 0;
                const totalEpisodes = parseInt(totalEpisodesEl.value) || 0;
                const watchedEpisodes = parseInt(watchedEpisodesEl.value) || 0;

                seasons.push({
                    season: seasonNumber,
                    totalEpisodes: totalEpisodes,
                    watchedEpisodes: watchedEpisodes,
                    updatedAt: new Date().toISOString()
                });
            });
            return seasons;
        }

        function loadSeasonsToSelector(seasons, selectedSeasonId) {
            const selector = document.getElementById('seasonSelector');
            selector.innerHTML = '<option value="">Sezon seÃ§in...</option>';

            if (seasons && seasons.length > 0) {
                seasons.forEach(season => {
                    const option = document.createElement('option');
                    option.value = season.id;
                    option.textContent = `Sezon ${season.season} (${season.watchedEpisodes}/${season.totalEpisodes} bÃ¶lÃ¼m)`;
                    if (season.id == selectedSeasonId) {
                        option.selected = true;
                    }
                    selector.appendChild(option);
                });
            }

            // SeÃ§ili sezon varsa bilgilerini gÃ¶ster
            if (selectedSeasonId) {
                loadSelectedSeasonInfo(selectedSeasonId);
            }
        }

        function loadSelectedSeasonInfo(seasonId) {
            const season = seriesData.find(s => s.id == seasonId);
            if (!season) return;

            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

            if (seasonNumberInput) seasonNumberInput.value = season.season;
            if (totalEpisodesInput) totalEpisodesInput.value = season.totalEpisodes;
            if (watchedEpisodesInput) watchedEpisodesInput.value = season.watchedEpisodes;

            document.getElementById('selectedSeasonInfo').style.display = 'block';
            document.getElementById('deleteSeasonBtn').style.display = 'inline-block';
        }

        function clearSelectedSeasonInfo() {
            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

            if (seasonNumberInput) seasonNumberInput.value = '';
            if (totalEpisodesInput) totalEpisodesInput.value = '';
            if (watchedEpisodesInput) watchedEpisodesInput.value = '';

            document.getElementById('selectedSeasonInfo').style.display = 'none';
            document.getElementById('deleteSeasonBtn').style.display = 'none';
        }

        function showNewSeasonForm() {
            const seriesName = document.getElementById('seriesName').value;
            if (!seriesName) {
                alert('Ã–nce dizi adÄ±nÄ± girin.');
                return;
            }

            // Mevcut sezonlarÄ± kontrol et
            const existingSeasons = seriesData.filter(s => s.name === seriesName);
            const nextSeasonNumber = existingSeasons.length > 0 ? Math.max(...existingSeasons.map(s => s.season)) + 1 : 1;

            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

            if (seasonNumberInput) seasonNumberInput.value = nextSeasonNumber;
            if (totalEpisodesInput) totalEpisodesInput.value = '';
            if (watchedEpisodesInput) watchedEpisodesInput.value = 0;

            document.getElementById('selectedSeasonInfo').style.display = 'block';
            document.getElementById('deleteSeasonBtn').style.display = 'none';

            // Selector'Ä± temizle ve yeni sezon modunu iÅŸaretle
            document.getElementById('seasonSelector').value = '';
            document.getElementById('seasonSelector').setAttribute('data-new-season', 'true');

            // ButonlarÄ± gÃ¼ncelle
            document.querySelector('#seriesForm button[type="submit"]').style.display = 'none';
            document.getElementById('saveNewSeasonBtn').style.display = 'block';
        }

        // Get selected categories from selector
        function getSelectedCategories(selectorId) {
            const selected = [];
            document.querySelectorAll(`#${selectorId} .category-option.selected`).forEach(option => {
                selected.push(parseInt(option.getAttribute('data-id')));
            });
            return selected;
        }

        // Get tags from container
        function getTagsFromContainer(containerId) {
            const tags = [];
            document.querySelectorAll(`#${containerId} .tag`).forEach(tagEl => {
                tags.push(tagEl.textContent);
            });
            return tags;
        }

        // Export data
        document.getElementById('exportData').addEventListener('click', function () {
            const data = {
                series: seriesData,
                movies: moviesData,
                categories: categoriesData
            };

            const dataStr = JSON.stringify(data);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

            const exportFileDefaultName = 'izleme-takip-yedek.json';

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        });

        // Import data
        document.getElementById('importData').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);

                    if (data.series) seriesData = data.series;
                    if (data.movies) moviesData = data.movies;
                    if (data.categories) categoriesData = data.categories;

                    localStorage.setItem('seriesData', JSON.stringify(seriesData));
                    localStorage.setItem('moviesData', JSON.stringify(moviesData));
                    localStorage.setItem('categoriesData', JSON.stringify(categoriesData));

                    initApp();
                    alert('Veriler baÅŸarÄ±yla yÃ¼klendi!');
                } catch (err) {
                    alert('Dosya yÃ¼klenirken bir hata oluÅŸtu: ' + err.message);
                }
            };
            reader.readAsText(file);

            // Reset input
            this.value = '';
        });

        // Event listeners
        seriesTab.addEventListener('click', function () {
            seriesTab.classList.add('active');
            moviesTab.classList.remove('active');
            categoriesTab.classList.remove('active');
            tagsTab.classList.remove('active');
            seriesContent.classList.remove('hidden');
            moviesContent.classList.add('hidden');
            categoriesContent.classList.add('hidden');
            tagsContent.classList.add('hidden');
        });

        moviesTab.addEventListener('click', function () {
            moviesTab.classList.add('active');
            seriesTab.classList.remove('active');
            categoriesTab.classList.remove('active');
            tagsTab.classList.remove('active');
            moviesContent.classList.remove('hidden');
            seriesContent.classList.add('hidden');
            categoriesContent.classList.add('hidden');
            tagsContent.classList.add('hidden');
        });

        categoriesTab.addEventListener('click', function () {
            categoriesTab.classList.add('active');
            seriesTab.classList.remove('active');
            moviesTab.classList.remove('active');
            tagsTab.classList.remove('active');
            categoriesContent.classList.remove('hidden');
            seriesContent.classList.add('hidden');
            moviesContent.classList.add('hidden');
            tagsContent.classList.add('hidden');
        });

        tagsTab.addEventListener('click', function () {
            tagsTab.classList.add('active');
            seriesTab.classList.remove('active');
            moviesTab.classList.remove('active');
            categoriesTab.classList.remove('active');
            tagsContent.classList.remove('hidden');
            seriesContent.classList.add('hidden');
            moviesContent.classList.add('hidden');
            categoriesContent.classList.add('hidden');
        });

        addSeriesBtn.addEventListener('click', addSeries);
        addSeriesBtnEmpty.addEventListener('click', addSeries);
        addMovieBtn.addEventListener('click', addMovie);
        addMovieBtnEmpty.addEventListener('click', addMovie);
        addCategoryBtn.addEventListener('click', addCategory);
        document.getElementById('addTagBtn').addEventListener('click', addTag);
        
        // Fragman butonlarÄ± iÃ§in event listener (event delegation kullanarak)
        document.addEventListener('click', function(e) {
            if (e.target.closest('.trailer-btn')) {
                const btn = e.target.closest('.trailer-btn');
                const trailerUrl = btn.getAttribute('data-trailer-url');
                const title = btn.getAttribute('data-title');
                console.log('Fragman butonu tÄ±klandÄ±:', trailerUrl, title);
                showTrailerModal(trailerUrl, title);
            }
        });
        // Sezon seÃ§imi event listener'larÄ±
        document.getElementById('seasonSelector').addEventListener('change', function () {
            const selectedSeasonId = this.value;
            // Yeni sezon modunu temizle
            this.removeAttribute('data-new-season');

            // ButonlarÄ± eski haline getir
            document.querySelector('#seriesForm button[type="submit"]').style.display = 'block';
            document.getElementById('saveNewSeasonBtn').style.display = 'none';

            if (selectedSeasonId) {
                loadSelectedSeasonInfo(selectedSeasonId);
            } else {
                clearSelectedSeasonInfo();
            }
        });

        document.getElementById('addNewSeasonBtn').addEventListener('click', showNewSeasonForm);

        document.getElementById('saveNewSeasonBtn').addEventListener('click', function () {
            const seriesName = document.getElementById('seriesName').value;
            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

            const seasonNumber = parseInt(seasonNumberInput?.value);
            const totalEpisodes = parseInt(totalEpisodesInput?.value);
            const watchedEpisodes = parseInt(watchedEpisodesInput?.value) || 0;
            const platform = document.getElementById('seriesPlatform').value;
            const categories = getSelectedCategories('seriesCategorySelector');
            const tags = getTagsFromContainer('seriesTagsContainer');

            if (!seriesName || !seasonNumber || !totalEpisodes) {
                alert('Dizi adÄ±, sezon numarasÄ± ve toplam bÃ¶lÃ¼m sayÄ±sÄ± gereklidir!');
                return;
            }

            // Yeni sezon ekle
            const newSeason = {
                id: Date.now(),
                name: seriesName,
                season: seasonNumber,
                totalEpisodes: totalEpisodes,
                platform,
                watchedEpisodes: watchedEpisodes,
                categories,
                tags,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            seriesData.push(newSeason);
            localStorage.setItem('seriesData', JSON.stringify(seriesData));

            // Sezon selector'Ä±nÄ± gÃ¼ncelle ve yeni sezonu seÃ§
            const allSeasons = seriesData.filter(s => s.name === seriesName);
            loadSeasonsToSelector(allSeasons, newSeason.id);
            loadSelectedSeasonInfo(newSeason.id);

            // ButonlarÄ± eski haline getir
            document.querySelector('#seriesForm button[type="submit"]').style.display = 'block';
            document.getElementById('saveNewSeasonBtn').style.display = 'none';
            document.getElementById('seasonSelector').removeAttribute('data-new-season');

            // Listeyi gÃ¼ncelle
            filterSeries();
            updateTotalStats();
            updateSeriesTagCloud();
        });

        document.getElementById('deleteSeasonBtn').addEventListener('click', function () {
            const seasonId = document.getElementById('seasonSelector').value;
            if (seasonId && confirm('Bu sezonu silmek istediÄŸinize emin misiniz?')) {
                // Sezonu sil
                seriesData = seriesData.filter(s => s.id != seasonId);
                localStorage.setItem('seriesData', JSON.stringify(seriesData));

                // Selector'Ä± gÃ¼ncelle
                const seriesName = document.getElementById('seriesName').value;
                const remainingSeasons = seriesData.filter(s => s.name === seriesName);
                loadSeasonsToSelector(remainingSeasons, null);
                clearSelectedSeasonInfo();

                // Listeyi gÃ¼ncelle
                renderSeriesList();
                updateTotalStats();
            }
        });

        document.getElementById('cancelSeries').addEventListener('click', function () {
            seriesModal.classList.remove('active');
        });

        document.getElementById('cancelMovie').addEventListener('click', function () {
            movieModal.classList.remove('active');
        });

        // Series form submit
        document.getElementById('seriesForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const id = document.getElementById('seriesId').value;
            const name = document.getElementById('seriesName').value;
            const platform = document.getElementById('seriesPlatform').value;
            const categories = getSelectedCategories('seriesCategorySelector');
            const tags = getTagsFromContainer('seriesTagsContainer');
            const trailerUrl = document.getElementById('seriesTrailerUrl').value;
            const imdbRating = document.getElementById('seriesImdbRating').value;
            const description = document.getElementById('seriesDescription').value;
            const imageUrl = document.getElementById('seriesImageUrl').value;

            if (id) {
                // DÃ¼zenleme modu
                const selectedSeasonId = document.getElementById('seasonSelector').value;
                const isNewSeason = document.getElementById('seasonSelector').getAttribute('data-new-season') === 'true';

                if (!selectedSeasonId) {
                    // Sezon seÃ§ilmemiÅŸ - Dizinin genel Ã¶zelliklerini gÃ¼ncelle
                    const seriesSeasons = seriesData.filter(s => s.name === name);
                    seriesSeasons.forEach(season => {
                        const seasonIndex = seriesData.findIndex(s => s.id === season.id);
                        if (seasonIndex !== -1) {
                            seriesData[seasonIndex] = {
                            ...seriesData[seasonIndex],
                            name,
                            platform,
                            categories,
                            tags,
                            trailerUrl,
                            imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                            description,
                            imageUrl,
                            updatedAt: new Date().toISOString()
                        };
                        }
                    });
                } else {
                    // Sezon seÃ§ilmiÅŸ - Sezon bilgilerini kontrol et
                    const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
                    const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
                    const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

                    const seasonNumber = parseInt(seasonNumberInput?.value);
                    const totalEpisodes = parseInt(totalEpisodesInput?.value);
                    const watchedEpisodes = parseInt(watchedEpisodesInput?.value) || 0;

                    if (!seasonNumber || !totalEpisodes) {
                        alert('Sezon numarasÄ± ve toplam bÃ¶lÃ¼m sayÄ±sÄ± gereklidir!');
                        return;
                    }

                    if (isNewSeason) {
                        // Yeni sezon ekle
                        const newSeasonId = seriesData.length > 0 ? Math.max(...seriesData.map(s => s.id)) + 1 : 1;
                        seriesData.push({
                            id: newSeasonId,
                            name,
                            platform,
                            season: seasonNumber,
                            totalEpisodes,
                            watchedEpisodes,
                            categories,
                            tags,
                            trailerUrl,
                            imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                            description,
                            imageUrl,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        });
                    } else {
                        // Mevcut sezonu gÃ¼ncelle
                        const seasonIndex = seriesData.findIndex(s => s.id == selectedSeasonId);
                        if (seasonIndex !== -1) {
                            seriesData[seasonIndex] = {
                                ...seriesData[seasonIndex],
                                name,
                                platform,
                                season: seasonNumber,
                                totalEpisodes,
                                watchedEpisodes,
                                categories,
                                tags,
                                trailerUrl,
                                imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                                description,
                                imageUrl,
                                updatedAt: new Date().toISOString()
                            };
                        }
                    }
                }
            } else {
                // Yeni dizi ekleme modu
                const seasons = getSeasonsFromForm();

                // Sezon kontrolÃ¼
                if (seasons.length === 0) {
                    alert('En az bir sezon eklemelisiniz!');
                    return;
                }

                // Yeni dizi ekle - her sezon iÃ§in ayrÄ± kayÄ±t
                seasons.forEach(seasonData => {
                    const newId = seriesData.length > 0 ? Math.max(...seriesData.map(s => s.id)) + 1 : 1;
                    seriesData.push({
                        id: newId,
                        name,
                        season: seasonData.season,
                        totalEpisodes: seasonData.totalEpisodes,
                        platform,
                        watchedEpisodes: seasonData.watchedEpisodes,
                        categories,
                        tags,
                        trailerUrl,
                        imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                        description,
                        imageUrl,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                });
            }

            localStorage.setItem('seriesData', JSON.stringify(seriesData));
            seriesModal.classList.remove('active');
            filterSeries();
            updateTotalStats();
            updateSeriesTagCloud();
        });

        // Movie form submit
        document.getElementById('movieForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const id = document.getElementById('movieId').value;
            const name = document.getElementById('movieName').value;
            const watched = document.getElementById('movieWatched').checked;
            const categories = getSelectedCategories('movieCategorySelector');
            const tags = getTagsFromContainer('movieTagsContainer');
            const trailerUrl = document.getElementById('movieTrailerUrl').value;
            const imdbRating = document.getElementById('movieImdbRating').value;
            const description = document.getElementById('movieDescription').value;
            const imageUrl = document.getElementById('movieImageUrl').value;

            if (id) {
                // Edit existing movie
                const index = moviesData.findIndex(m => m.id == id);
                if (index !== -1) {
                    moviesData[index] = {
                        ...moviesData[index],
                        name,
                        watched,
                        categories,
                        tags,
                        trailerUrl,
                        imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                        description,
                        imageUrl,
                        updatedAt: new Date().toISOString()
                    };
                }
            } else {
                // Add new movie
                const newId = moviesData.length > 0 ? Math.max(...moviesData.map(m => m.id)) + 1 : 1;
                moviesData.push({
                    id: newId,
                    name,
                    watched,
                    categories,
                    tags,
                    trailerUrl,
                    imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                    description,
                    imageUrl,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
            }

            localStorage.setItem('moviesData', JSON.stringify(moviesData));
            movieModal.classList.remove('active');
            filterMovies();
            updateTotalStats();
            updateMoviesTagCloud();
        });

        // Search and filter events
        searchSeries.addEventListener('input', filterSeries);
        searchMovies.addEventListener('input', filterMovies);

        // Filter buttons
        document.querySelectorAll('.filter-button').forEach(btn => {
            btn.addEventListener('click', function () {
                const filter = this.getAttribute('data-filter');

                if (this.closest('#seriesContent')) {
                    currentSeriesFilter = filter;
                    document.querySelectorAll('#seriesContent .filter-button').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    filterSeries();
                } else {
                    currentMoviesFilter = filter;
                    document.querySelectorAll('#moviesContent .filter-button').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    filterMovies();
                }
            });
        });

        // View options
        document.querySelectorAll('.view-button').forEach(btn => {
            btn.addEventListener('click', function () {
                const view = this.getAttribute('data-view');

                if (this.closest('#seriesContent')) {
                    seriesView = view;
                    document.querySelectorAll('#seriesContent .view-button').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    renderSeriesList();
                } else {
                    moviesView = view;
                    document.querySelectorAll('#moviesContent .view-button').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    renderMoviesList();
                }
            });
        });

        // Sorting functions
        function sortSeries(sortType) {
            switch (sortType) {
                case 'newest':
                    filteredSeriesData.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
                    break;
                case 'oldest':
                    filteredSeriesData.sort((a, b) => new Date(a.createdAt || 0) - new Date(b.createdAt || 0));
                    break;
                case 'alphabetical':
                    filteredSeriesData.sort((a, b) => a.name.localeCompare(b.name, 'tr'));
                    break;
                case 'alphabetical-desc':
                    filteredSeriesData.sort((a, b) => b.name.localeCompare(a.name, 'tr'));
                    break;
                case 'rating-desc':
                    filteredSeriesData.sort((a, b) => (b.imdbRating || 0) - (a.imdbRating || 0));
                    break;
                case 'rating-asc':
                    filteredSeriesData.sort((a, b) => (a.imdbRating || 0) - (b.imdbRating || 0));
                    break;
            }
            renderSeriesList();
        }

        function sortMovies(sortType) {
            switch (sortType) {
                case 'newest':
                    filteredMoviesData.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
                    break;
                case 'oldest':
                    filteredMoviesData.sort((a, b) => new Date(a.createdAt || 0) - new Date(b.createdAt || 0));
                    break;
                case 'alphabetical':
                    filteredMoviesData.sort((a, b) => a.name.localeCompare(b.name, 'tr'));
                    break;
                case 'alphabetical-desc':
                    filteredMoviesData.sort((a, b) => b.name.localeCompare(a.name, 'tr'));
                    break;
                case 'rating-desc':
                    filteredMoviesData.sort((a, b) => (b.imdbRating || 0) - (a.imdbRating || 0));
                    break;
                case 'rating-asc':
                    filteredMoviesData.sort((a, b) => (a.imdbRating || 0) - (b.imdbRating || 0));
                    break;
            }
            renderMoviesList();
        }

        // Sort event listeners
        document.getElementById('seriesSortSelect').addEventListener('change', function() {
            sortSeries(this.value);
        });

        document.getElementById('moviesSortSelect').addEventListener('change', function() {
            sortMovies(this.value);
        });

        // Sezon ekleme butonuna basÄ±nca required ekle
        document.getElementById("addNewSeasonBtn").addEventListener("click", () => {
            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            
            if (seasonNumberInput) seasonNumberInput.setAttribute("required", "true");
            if (totalEpisodesInput) totalEpisodesInput.setAttribute("required", "true");
        });

        // Modal kapatÄ±lÄ±nca required kaldÄ±r
        document.getElementById("cancelSeries").addEventListener("click", () => {
            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            
            if (seasonNumberInput) seasonNumberInput.removeAttribute("required");
            if (totalEpisodesInput) totalEpisodesInput.removeAttribute("required");
        });


        // Initialize the app
        initApp();
    </script>
</body>

</html>