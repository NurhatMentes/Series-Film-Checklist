<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°zleme Takip UygulamasÄ±</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --bg-light: #f8fafc;
            --text-light: #1e293b;
            --card-light: #ffffff;
            --border-light: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        .dark-theme {
            --primary: #818cf8;
            --primary-dark: #6366f1;
            --secondary: #a78bfa;
            --bg-light: #0f172a;
            --text-light: #e2e8f0;
            --card-light: #1e293b;
            --border-light: #334155;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            transition: background 0.3s ease;
            color: var(--text-light);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .dark-theme .card {
            background: rgba(30, 41, 59, 0.95);
            border-color: rgba(51, 65, 85, 0.3);
            backdrop-filter: blur(10px);
        }

        .dark-theme body {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }

        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button.active {
            color: white;
            font-weight: 600;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background: white;
            border-radius: 3px;
        }

        /* YerleÅŸim toggle butonlarÄ± */
        .layout-toggle {
            display: inline-flex;
            gap: 8px;
        }

        .layout-toggle-btn {
            padding: 6px 10px;
            border-radius: 20px;
            border: 1px solid var(--border-light);
            background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
            color: #334155;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dark-theme .layout-toggle-btn {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            border-color: #334155;
        }

        .layout-toggle-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .layout-toggle-btn.active {
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.25);
        }

        /* Kart baÅŸlÄ±klarÄ± iÃ§in tipografi ve kÄ±saltma */
        .card-title {
            font-weight: 700;
            letter-spacing: 0.2px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .series-card,
        .movie-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-light);
        }

        .series-card:hover,
        .movie-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .progress-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background: #e5e7eb;
        }

        .dark-theme .progress-bar {
            background: #334155;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.4s ease;
        }

        /* Poster konteyneri iÃ§in gÃ¶rsel iyileÅŸtirme */
        .poster-wrapper {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .poster-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.35), rgba(0,0,0,0.0) 40%);
            pointer-events: none;
        }

        /* Poster Ã¼zerinde bilgi ÅŸeridi */
        .poster-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 8px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #fff;
            background: linear-gradient(to top, rgba(0,0,0,0.6), rgba(0,0,0,0));
            font-size: 0.875rem;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.4);
            pointer-events: none;
        }

        .poster-info .title {
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            max-width: 75%;
        }

        .poster-info .meta {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-weight: 700;
        }

        .poster-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 2;
        }

        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .status-badge.completed {
            background: linear-gradient(45deg, var(--success), #06d6a0);
            color: white;
        }

        .status-badge.watching {
            background: linear-gradient(45deg, var(--primary), #60a5fa);
            color: white;
        }

        .status-badge.planning {
            background: linear-gradient(45deg, var(--secondary), #a78bfa);
            color: white;
        }

        .status-badge.paused {
            background: linear-gradient(45deg, var(--warning), #fbbf24);
            color: white;
        }

        /* Kategori rozetleri ve etiketler iÃ§in gÃ¶rsel iyileÅŸtirme */
        .category-badge {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            border-radius: 9999px;
            color: #fff;
            font-weight: 600;
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.15);
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            border-radius: 9999px;
            background: rgba(99, 102, 241, 0.12);
            border: 1px solid var(--border-light);
            color: var(--text-light);
            font-weight: 500;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .tag:hover {
            background: rgba(99, 102, 241, 0.18);
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
        }

        .dark-theme .tag {
            background: rgba(148, 163, 184, 0.15);
            color: #e2e8f0;
            border-color: #334155;
        }

        .filter-button {
            transition: all 0.3s ease;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-light);
        }

        .filter-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .filter-button.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            font-weight: 600;
            border-color: transparent;
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.35);
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        }

        .edit-icon,
        .delete-icon {
            opacity: 0;
            transition: all 0.2s ease;
        }

        .series-card:hover .edit-icon,
        .series-card:hover .delete-icon,
        .movie-card:hover .edit-icon,
        .movie-card:hover .delete-icon {
            opacity: 1;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--card-light);
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-light);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: var(--bg-light);
            color: var(--text-light);
        }

        .dark-theme .form-control {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-size: 16px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .dark-theme .btn-secondary {
            background: #475569;
            color: #e2e8f0;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .dark-theme .btn-secondary:hover {
            background: #64748b;
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--danger), #f87171);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .trailer-btn {
            background: linear-gradient(45deg, #ff0000, #ff4444);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .trailer-btn:hover {
            background: linear-gradient(45deg, #cc0000, #ff3333);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(255, 0, 0, 0.3);
        }

        .watched-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .watched-indicator.watched {
            background-color: var(--success);
        }

        .watched-indicator.unwatched {
            background-color: #d1d5db;
        }

        .dark-theme .watched-indicator.unwatched {
            background-color: #475569;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .section-header {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 24px;
            align-items: center;
        }

        .search-container {
            flex: 1;
            min-width: 200px;
        }

        .filters-container {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .view-options {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        .view-button {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e5e7eb;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dark-theme .view-button {
            background: #475569;
            color: #e2e8f0;
        }

        .view-button.active {
            background: var(--primary);
            color: white;
        }

        .season-list {
            margin-top: 16px;
            border-top: 1px solid var(--border-light);
            padding-top: 16px;
        }

        .dark-theme .season-list {
            border-top-color: #334155;
        }

        .season-item {
            padding: 12px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            margin-bottom: 8px;
            background: #f9fafb;
        }

        .dark-theme .season-item {
            background: #334155;
            border-color: #475569;
        }

        .season-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .season-content {
            margin-top: 12px;
            padding: 12px;
            background: var(--bg-light);
            border-radius: 8px;
            border: 1px solid var(--border-light);
            display: none;
        }

        .dark-theme .season-content {
            background: #475569;
            border-color: #64748b;
        }

        .season-content.show {
            display: block;
        }

        .season-toggle {
            transition: transform 0.3s ease;
            display: inline-block;
        }

        .season-toggle.rotate {
            transform: rotate(180deg);
        }

        .season-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0;
        }

        .season-content.show {
            max-height: 500px;
            padding: 1rem 0 0 0;
        }

        .grid-1-col {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        .grid-2-col {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .grid-3-col {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }

        /* Kart gridlerinde eÅŸit yÃ¼kseklik yerine iÃ§eriÄŸe gÃ¶re yÃ¼kseklik */
        #seriesList,
        #moviesList {
            align-items: start;
        }

        @media (max-width: 1024px) {
            .grid-3-col {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 640px) {
            .grid-3-col,
            .grid-2-col {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
        }

        /* Masonry layout: dikey boÅŸluklarÄ± iÃ§eriÄŸe gÃ¶re azaltÄ±r */
        .masonry {
            column-gap: 1rem; /* daha sÄ±kÄ± yatay boÅŸluk */
        }
        .masonry-1-col { column-count: 1; }
        .masonry-2-col { column-count: 2; }
        .masonry-3-col { column-count: 3; }
        .masonry-item { break-inside: avoid; margin-bottom: 1rem; }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.3);
        }

        .dark-theme .theme-toggle {
            background: rgba(30, 41, 59, 0.3);
        }

        .dark-theme .theme-toggle:hover {
            background: rgba(30, 41, 59, 0.4);
        }

        /* Tabs container wraps on small screens */
        .tabs-container { flex-wrap: wrap; gap: 8px; }
        @media (max-width: 640px) {
            .tab-button { padding: 0.5rem 0.75rem; font-size: 0.9rem; }
        }

        /* Sort row alignment on mobile */
        @media (max-width: 768px) {
            .sort-row { margin-left: 0 !important; width: 100%; justify-content: flex-start; }
            .section-header .search-container { width: 100%; margin-right: 0; }
        }

        /* Modal padding tweak on mobile */
        @media (max-width: 640px) {
            .modal-content { padding: 16px; }
            .app-container { padding: 12px; }
        }

        /* Yeni eklenen stiller */
        .category-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            color: white;
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            background-color: #e5e7eb;
            color: #4b5563;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .dark-theme .tag {
            background-color: #475569;
            color: #e2e8f0;
        }

        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.5rem;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            min-height: 42px;
        }

        .tag-input {
            flex: 1;
            min-width: 60px;
            border: none;
            outline: none;
            background: transparent;
        }

        .category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .category-option {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            cursor: pointer;
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 0.5rem;
            margin-right: 0.5rem;
            font-weight: 500;
            letter-spacing: 0.01em;
        }

        .category-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .category-option.selected {
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
            position: relative;
            overflow: hidden;
        }

        .category-option.selected::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: inherit;
            z-index: 0;
        }

        .category-option.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 0 20px 0 8px;
            padding: 0 6px;
            font-size: 0.7rem;
            z-index: 1;
        }

        .category-option span {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            padding: 0.1rem 0.5rem;
            margin-left: 0.5rem;
            font-weight: 600;
            font-size: 0.75rem;
            min-width: 24px;
            height: 20px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
        }

        .category-option>* {
            position: relative;
            z-index: 2;
        }

        .category-manager {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-light);
        }

        .dark-theme .category-manager {
            border-top-color: #334155;
        }

        .custom-checkbox {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .custom-checkbox input {
            margin-right: 0.5rem;
        }

        .color-picker {
            width: 30px;
            height: 30px;
            padding: 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        /* Sezon Form Stilleri */
        .season-form-item {
            padding: 1rem;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            background: #f9fafb;
            position: relative;
        }

        .dark-theme .season-form-item {
            background: #334155;
            border-color: #475569;
        }

        .season-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .season-form-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .remove-season-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .remove-season-btn:hover {
            background: #dc2626;
        }

        .season-form-fields {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .season-form-fields {
                grid-template-columns: 1fr;
            }
        }

        .dark-theme .tag-cloud {
            background: rgba(30, 41, 59, 0.3);
        }

        @media (max-width: 768px) {
            .section-header {
                flex-direction: column;
                align-items: stretch;
            }

            .search-container {
                order: 2;
            }

            .filters-container {
                order: 1;
                justify-content: center;
            }

            .view-options {
                order: 3;
                margin: 16px 0 0 0;
                justify-content: center;
            }
        }

        /* Fragman Modal Stilleri */
        .trailer-modal {
            z-index: 10000;
        }

        .trailer-modal-content {
            max-width: 90vw;
            max-height: 90vh;
            width: 800px;
            padding: 0;
            border-radius: 12px;
            overflow: hidden;
            background: var(--card-light);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transform: none;
        }

        .trailer-modal .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0;
        }

        .trailer-modal .modal-header h3 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-trailer-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .close-trailer-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .trailer-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: #000;
        }

        .trailer-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .trailer-info {
            padding: 12px 16px;
            font-size: 0.875rem;
            color: #4b5563;
        }

        .dark-theme .trailer-info {
            color: #e5e7eb;
        }

        /* Fragman butonu stilleri */
        .trailer-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 8px;
        }

        .trailer-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .trailer-btn i {
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .trailer-modal-content {
                width: 95vw;
                max-width: 95vw;
            }
            
            .trailer-modal .modal-header h3 {
                font-size: 1rem;
            }
        }

        /* Senkronizasyon butonu */
        .sync-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(22, 163, 74, 0.35);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            z-index: 1000;
        }
        .sync-btn:hover { transform: translateY(-1px); }

        .sync-modal .modal-header { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
        .sync-modal-content { width: 720px; max-width: 92vw; }
        .sync-form .form-group { margin-bottom: 12px; }
        .sync-form textarea { min-height: 140px; resize: vertical; }

        /* Uzun aÃ§Ä±klamalar iÃ§in line-clamp ile kÄ±saltma (scroll yerine) */
        .description-text {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 min-h-screen">
    <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon text-white text-xl"></i>
    </div>

    <div class="app-container">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold text-white mb-4 drop-shadow-lg">ðŸŽ¬ Ä°zleme Takip</h1>
            <p class="text-xl text-purple-100 opacity-90">Dizilerinizi ve filmlerinizi akÄ±llÄ±ca takip edin</p>
        </div>

        <!-- Backup & Restore Section -->
        <div class="card p-6 mb-8 bg-white/10 backdrop-blur-sm">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center">
                    <h3 class="text-white font-semibold mb-2">Yedek Al</h3>
                    <p class="text-purple-100 text-sm mb-3">Verilerinizi gÃ¼venli bir dosyaya kaydedin</p>
                    <button id="exportData" class="btn btn-primary w-full">
                        <i class="fas fa-download mr-2"></i> Yedek Al
                    </button>
                </div>
                <div class="text-center border-l border-r border-white/20 px-4">
                    <h3 class="text-white font-semibold mb-2">Geri YÃ¼kle</h3>
                    <p class="text-purple-100 text-sm mb-3">KayÄ±p verilerinizi kurtarÄ±n</p>
                    <div class="relative">
                        <input type="file" id="importData" class="hidden" accept=".json">
                        <label for="importData" class="btn btn-primary w-full cursor-pointer">
                            <i class="fas fa-upload mr-2"></i> Dosya YÃ¼kle
                        </label>
                    </div>
                </div>
                <div class="text-center">
                    <h3 class="text-white font-semibold mb-3">Ä°statistikler</h3>
                    <div class="grid grid-cols-2 gap-4 mb-2">
                        <div class="text-center">
                            <div class="text-xl font-bold text-white mb-1" id="seriesStats">0</div>
                            <p class="text-purple-100 text-xs">Dizi</p>
                        </div>
                        <div class="text-center">
                            <div class="text-xl font-bold text-white mb-1" id="moviesStats">0</div>
                            <p class="text-purple-100 text-xs">Film</p>
                        </div>
                    </div>
                    <!-- Sade Ã¶zet satÄ±rlarÄ± -->
                    <div class="space-y-1 mb-2">
                        <p class="text-purple-100 text-xs">
                            <span class="text-white font-semibold">Filmler:</span>
                            <span id="moviesStatusSummary">Ä°zlenen 0 / Ä°zlenmeyen 0</span>
                        </p>
                        <p class="text-purple-100 text-xs">
                            <span class="text-white font-semibold">Diziler:</span>
                            <span id="seriesStatusSummary">Tamamlanan 0 / Ä°zlenen 0 / Planlanan 0</span>
                        </p>
                    </div>
                    <div class="border-t border-white/20 pt-2">
                        <div class="text-2xl font-bold text-white mb-1" id="totalStats">0</div>
                        <p class="text-purple-100 text-sm">Toplam Ä°Ã§erik</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container flex bg-white/10 backdrop-blur-sm rounded-xl p-2 mb-8 justify-center">
            <button id="seriesTab" class="tab-button px-6 py-3 font-medium text-white border-none active">
                <i class="fas fa-tv mr-2"></i> Diziler
            </button>
            <button id="moviesTab" class="tab-button px-6 py-3 font-medium text-white border-none">
                <i class="fas fa-film mr-2"></i> Filmler
            </button>
            <button id="upcomingTab" class="tab-button px-6 py-3 font-medium text-white border-none">
                <i class="fas fa-calendar-alt mr-2"></i> YakÄ±nda Ã‡Ä±kacaklar
            </button>
            <button id="categoriesTab" class="tab-button px-6 py-3 font-medium text-white border-none">
                <i class="fas fa-tags mr-2"></i> Kategoriler
            </button>
            <button id="tagsTab" class="tab-button px-6 py-3 font-medium text-white border-none">
                <i class="fas fa-tag mr-2"></i> Etiketler
            </button>
            <button id="trailersTab" class="tab-button px-6 py-3 font-medium text-white border-none">
                <i class="fas fa-play mr-2"></i> Fragmanlar
            </button>
        </div>

        <!-- Series Tab Content -->
        <div id="seriesContent" class="tab-content">
            <div class="card p-6 mb-6">
                <div class="grid grid-cols-1 gap-4">
                    <div class="section-header flex justify-between items-center">
                        <div class="search-container flex-grow mr-4">
                            <div class="relative">
                                <input type="text" id="searchSeries" class="form-control pl-10"
                                    placeholder="Dizi ara...">
                                <i
                                    class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="view-options flex mr-2">
                                <button class="view-button active" id="view1Col" data-view="1">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button class="view-button" id="view2Col" data-view="2">
                                    <i class="fas fa-th-large"></i>
                                </button>
                                <button class="view-button" id="view3Col" data-view="3">
                                    <i class="fas fa-th"></i>
                                </button>
                            </div>
                            <div class="flex items-center gap-2 mr-2">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-300">GÃ¶rsel oranÄ±:</span>
                                <select id="posterAspectSelectSeries" class="form-control text-sm py-1 px-2 min-w-[140px]">
                                    <option value="aspect-[2/3]">Dikey 2:3</option>
                                    <option value="aspect-video">Yatay 16:9</option>
                                    <option value="aspect-square">Kare 1:1</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2 mr-2">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-300">YerleÅŸim:</span>
                                <select id="layoutModeSelectSeries" class="form-control text-sm py-1 px-2 min-w-[140px]">
                                    <option value="grid">Grid</option>
                                    <option value="masonry">Masonry</option>
                                </select>
                                <div class="layout-toggle ml-2">
                                    <button id="layoutToggleGridSeries" class="layout-toggle-btn" data-mode="grid"><i class="fas fa-th mr-1"></i> Grid</button>
                                    <button id="layoutToggleMasonrySeries" class="layout-toggle-btn" data-mode="masonry"><i class="fas fa-grip-vertical mr-1"></i> Masonry</button>
                                </div>
                            </div>
                            <button id="addSeriesBtn" class="btn btn-primary">
                                <i class="fas fa-plus mr-2"></i> Yeni Dizi
                            </button>
                        </div>
                    </div>

                    <div class="filters-container bg-white/5 p-3 rounded-lg">
                        <div class="flex flex-wrap gap-2 mb-3 items-center">
                            <div class="flex flex-wrap gap-2">
                                <button class="filter-button btn btn-secondary btn-sm active" data-filter="all">
                                    <i class="fas fa-layer-group mr-1"></i> TÃ¼mÃ¼
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="completed">
                                    <i class="fas fa-check-circle mr-1"></i> Tamamlanan
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="watching">
                                    <i class="fas fa-play-circle mr-1"></i> Ä°zleniyor
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="planning">
                                    <i class="fas fa-clock mr-1"></i> Planlanan
                                </button>
                            </div>
                            
                            <div class="sort-row flex items-center gap-2 ml-auto">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-300">SÄ±ralama:</span>
                                <select id="seriesSortSelect" class="form-control text-sm py-1 px-2 min-w-[140px]">
                                    <option value="newest">En Yeni</option>
                                    <option value="oldest">En Eski</option>
                                    <option value="alphabetical">A-Z</option>
                                    <option value="alphabetical-desc">Z-A</option>
                                    <option value="rating-desc">IMDB PuanÄ± (YÃ¼ksek)</option>
                                    <option value="rating-asc">IMDB PuanÄ± (DÃ¼ÅŸÃ¼k)</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <div class="flex items-center mb-2">
                                <span
                                    class="text-sm font-medium text-gray-600 dark:text-gray-300 mr-2">Kategoriler:</span>
                                <div id="seriesCategoryFilters" class="flex flex-wrap items-center gap-2"></div>
                            </div>

                            <!-- Etiket bulutu -->
                            <div id="seriesTagCloud" class="tag-cloud mt-2">
                                <!-- Etiketler buraya dinamik olarak eklenecek -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-1-col gap-6" id="seriesList">
                <!-- Series cards will be added here dynamically -->
            </div>

            <!-- Empty State -->
            <div id="seriesEmpty" class="text-center py-16">
                <div class="text-white/70 text-6xl mb-4"><i class="fas fa-tv"></i></div>
                <h3 class="text-2xl font-semibold text-white mb-2">HenÃ¼z dizi eklemediniz</h3>
                <p class="text-purple-100 mb-4">Yeni dizi eklemek iÃ§in "Yeni Dizi" butonuna tÄ±klayÄ±n</p>
                <button id="addSeriesBtnEmpty" class="btn btn-primary">
                    <i class="fas fa-plus mr-2"></i> Ä°lk Dizini Ekle
                </button>
            </div>
        </div>

        <!-- Movies Tab Content -->
        <div id="moviesContent" class="tab-content hidden">
            <div class="card p-6 mb-6">
                <div class="grid grid-cols-1 gap-4">
                    <div class="section-header flex justify-between items-center">
                        <div class="search-container flex-grow mr-4">
                            <div class="relative">
                                <input type="text" id="searchMovies" class="form-control pl-10"
                                    placeholder="Film ara...">
                                <i
                                    class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="view-options flex mr-2">
                                <button class="view-button active" id="view1ColMovies" data-view="1">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button class="view-button" id="view2ColMovies" data-view="2">
                                    <i class="fas fa-th-large"></i>
                                </button>
                                <button class="view-button" id="view3ColMovies" data-view="3">
                                    <i class="fas fa-th"></i>
                                </button>
                            </div>
                            <div class="flex items-center gap-2 mr-2">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-300">GÃ¶rsel oranÄ±:</span>
                                <select id="posterAspectSelectMovies" class="form-control text-sm py-1 px-2 min-w-[140px]">
                                    <option value="aspect-[2/3]">Dikey 2:3</option>
                                    <option value="aspect-video">Yatay 16:9</option>
                                    <option value="aspect-square">Kare 1:1</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2 mr-2">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-300">YerleÅŸim:</span>
                                <select id="layoutModeSelectMovies" class="form-control text-sm py-1 px-2 min-w-[140px]">
                                    <option value="grid">Grid</option>
                                    <option value="masonry">Masonry</option>
                                </select>
                                <div class="layout-toggle ml-2">
                                    <button id="layoutToggleGridMovies" class="layout-toggle-btn" data-mode="grid"><i class="fas fa-th mr-1"></i> Grid</button>
                                    <button id="layoutToggleMasonryMovies" class="layout-toggle-btn" data-mode="masonry"><i class="fas fa-grip-vertical mr-1"></i> Masonry</button>
                                </div>
                            </div>
                            <button id="addMovieBtn" class="btn btn-primary">
                                <i class="fas fa-plus mr-2"></i> Yeni Film
                            </button>
                        </div>
                    </div>

                    <div class="filters-container bg-white/5 p-3 rounded-lg">
                        <div class="flex flex-wrap gap-2 mb-3 items-center">
                            <div class="flex flex-wrap gap-2">
                                <button class="filter-button btn btn-secondary btn-sm active" data-filter="all">
                                    <i class="fas fa-layer-group mr-1"></i> TÃ¼mÃ¼
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="watched">
                                    <i class="fas fa-eye mr-1"></i> Ä°zlendi
                                </button>
                                <button class="filter-button btn btn-secondary btn-sm" data-filter="not-watched">
                                    <i class="fas fa-eye-slash mr-1"></i> Ä°zlenmedi
                                </button>
                            </div>
                            
                            <div class="sort-row flex items-center gap-2 ml-auto">
                                <span class="text-sm font-medium text-gray-600 dark:text-gray-300">SÄ±ralama:</span>
                                <select id="moviesSortSelect" class="form-control text-sm py-1 px-2 min-w-[140px]">
                                    <option value="newest">En Yeni</option>
                                    <option value="oldest">En Eski</option>
                                    <option value="alphabetical">A-Z</option>
                                    <option value="alphabetical-desc">Z-A</option>
                                    <option value="rating-desc">IMDB PuanÄ± (YÃ¼ksek)</option>
                                    <option value="rating-asc">IMDB PuanÄ± (DÃ¼ÅŸÃ¼k)</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex flex-col">
                            <div class="flex items-center mb-2">
                                <span
                                    class="text-sm font-medium text-gray-600 dark:text-gray-300 mr-2">Kategoriler:</span>
                                <div id="moviesCategoryFilters" class="flex flex-wrap items-center gap-2"></div>
                            </div>

                            <!-- Etiket bulutu -->
                            <div id="moviesTagCloud" class="tag-cloud mt-2">
                                <!-- Etiketler buraya dinamik olarak eklenecek -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-1-col gap-6" id="moviesList">
                <!-- Movie cards will be added here dynamically -->
            </div>

            <!-- Empty State -->
            <div id="moviesEmpty" class="text-center py-16">
                <div class="text-white/70 text-6xl mb-4"><i class="fas fa-film"></i></div>
                <h3 class="text-2xl font-semibold text-white mb-2">HenÃ¼z film eklemediniz</h3>
                <p class="text-purple-100 mb-4">Yeni film eklemek iÃ§in "Yeni Film" butonuna tÄ±klayÄ±n</p>
                <button id="addMovieBtnEmpty" class="btn btn-primary">
                    <i class="fas fa-plus mr-2"></i> Ä°lk Filmi Ekle
                </button>
            </div>
        </div>

        <!-- Upcoming Releases Tab Content -->
        <div id="upcomingContent" class="tab-content hidden">
            <div class="card p-6 mb-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-calendar-alt mr-3 text-purple-400"></i>
                        YakÄ±nda Ã‡Ä±kacaklar
                    </h2>
                    <div class="flex items-center space-x-4">
                        <div class="text-sm text-gray-600 dark:text-gray-300">
                            <i class="fas fa-clock mr-1"></i>
                            <span id="upcomingCount">0</span> iÃ§erik
                        </div>
                        <div class="flex space-x-2">
                            <button id="upcomingFilterAll" class="filter-btn active" data-filter="all">
                                <i class="fas fa-list mr-1"></i> TÃ¼mÃ¼
                            </button>
                            <button id="upcomingFilterSeries" class="filter-btn" data-filter="series">
                                <i class="fas fa-tv mr-1"></i> Diziler
                            </button>
                            <button id="upcomingFilterMovies" class="filter-btn" data-filter="movies">
                                <i class="fas fa-film mr-1"></i> Filmler
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Timeline -->
                <div class="mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-lg p-4 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-semibold">Bu Hafta</h3>
                                    <p class="text-red-100 text-sm">0-7 gÃ¼n iÃ§inde</p>
                                </div>
                                <div class="text-2xl font-bold" id="thisWeekCount">0</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-4 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-semibold">Bu Ay</h3>
                                    <p class="text-orange-100 text-sm">8-30 gÃ¼n iÃ§inde</p>
                                </div>
                                <div class="text-2xl font-bold" id="thisMonthCount">0</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 text-white">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="text-lg font-semibold">Gelecek</h3>
                                    <p class="text-blue-100 text-sm">30+ gÃ¼n sonra</p>
                                </div>
                                <div class="text-2xl font-bold" id="futureCount">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Content List -->
                <div id="upcomingList" class="grid grid-3-col gap-6">
                    <!-- Upcoming items will be added here dynamically -->
                </div>

                <!-- Empty State -->
                <div id="upcomingEmpty" class="text-center py-16 hidden">
                    <div class="text-white/70 text-6xl mb-4"><i class="fas fa-calendar-times"></i></div>
                    <h3 class="text-2xl font-semibold text-white mb-2">YakÄ±nda Ã§Ä±kacak iÃ§erik bulunamadÄ±</h3>
                    <p class="text-purple-100 mb-4">YayÄ±n tarihi olan dizi ve filmler burada gÃ¶rÃ¼necek</p>
                    <div class="flex justify-center space-x-4">
                        <button id="addSeriesFromUpcoming" class="btn btn-primary">
                            <i class="fas fa-tv mr-2"></i> Dizi Ekle
                        </button>
                        <button id="addMovieFromUpcoming" class="btn btn-secondary">
                            <i class="fas fa-film mr-2"></i> Film Ekle
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Categories Tab Content -->
        <div id="categoriesContent" class="tab-content hidden">
            <div class="card p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6">Kategori YÃ¶netimi</h2>

                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-4">Yeni Kategori Ekle</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="form-group">
                            <label for="newCategoryName">Kategori AdÄ±</label>
                            <input type="text" id="newCategoryName" class="form-control" placeholder="Kategori adÄ±">
                        </div>
                        <div class="form-group">
                            <label for="newCategoryColor">Renk</label>
                            <input type="color" id="newCategoryColor" class="form-control color-picker" value="#6366f1">
                        </div>
                        <div class="form-group flex items-end">
                            <button id="addCategoryBtn" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i> Kategori Ekle
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-semibold mb-4">Mevcut Kategoriler</h3>
                    <div id="categoriesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Kategoriler buraya dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Tags Management Tab Content -->
        <div id="tagsContent" class="tab-content hidden">
            <div class="card p-6 mb-6">
                <h2 class="text-2xl font-bold mb-6">Etiket YÃ¶netimi</h2>

                <div class="mb-6">
                    <h3 class="text-xl font-semibold mb-4">Yeni Etiket Ekle</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="form-group">
                            <label for="newTagName">Etiket AdÄ±</label>
                            <input type="text" id="newTagName" class="form-control" placeholder="Etiket adÄ±">
                        </div>
                        <div class="form-group flex items-end">
                            <button id="addTagBtn" class="btn btn-primary w-full">
                                <i class="fas fa-plus mr-2"></i> Etiket Ekle
                            </button>
                        </div>
                        <div class="form-group flex items-end">
                            <button id="promoteAllTagsBtn" class="btn btn-secondary w-full">
                                <i class="fas fa-arrow-up mr-2"></i> TÃ¼mÃ¼nÃ¼ Global Yap
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-semibold mb-4">Mevcut Etiketler</h3>
                    <div id="tagsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Etiketler buraya dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>
        </div>

        <div id="trailersContent" class="tab-content hidden">
            <div class="card p-6 mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-5">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-play mr-3 text-purple-400"></i>
                        Fragmanlar
                    </h2>
                    <div class="text-sm text-gray-600 dark:text-gray-300">
                        <i class="fas fa-video mr-1"></i>
                        <span id="trailersCount">0</span> fragman
                    </div>
                </div>

                <div class="bg-white/5 rounded-xl p-4 mb-6">
                    <div class="flex flex-col lg:flex-row lg:items-center gap-3">
                        <div class="flex-1">
                            <div class="relative">
                                <input type="text" id="trailersSearch" class="form-control pl-10" placeholder="Fragman ara...">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>

                        <div class="flex flex-wrap items-center gap-2">
                            <button id="trailersFilterAll" class="filter-button btn btn-secondary btn-sm active" data-filter="all">
                                <i class="fas fa-layer-group mr-1"></i> TÃ¼mÃ¼
                            </button>
                            <button id="trailersFilterSeries" class="filter-button btn btn-secondary btn-sm" data-filter="series">
                                <i class="fas fa-tv mr-1"></i> Diziler
                            </button>
                            <button id="trailersFilterMovies" class="filter-button btn btn-secondary btn-sm" data-filter="movies">
                                <i class="fas fa-film mr-1"></i> Filmler
                            </button>
                        </div>

                        <div class="flex items-center gap-2">
                            <span class="text-sm font-medium text-gray-600 dark:text-gray-300">SÄ±ralama:</span>
                            <select id="trailersSortSelect" class="form-control text-sm py-1 px-2 min-w-[160px]">
                                <option value="alphabetical">A-Z</option>
                                <option value="alphabetical-desc">Z-A</option>
                                <option value="type-series-first">Ã–nce Diziler</option>
                                <option value="type-movies-first">Ã–nce Filmler</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-1 lg:sticky lg:top-6 self-start">
                        <div class="bg-white/5 rounded-xl p-4">
                            <div class="aspect-video w-full rounded-lg overflow-hidden bg-black/30">
                                <div id="trailersPreviewPlayer" class="w-full h-full"></div>
                            </div>
                            <div class="mt-3 text-sm text-gray-600 dark:text-gray-300" id="trailersPreviewInfo">
                                Liste Ã¼stÃ¼nde imleÃ§ (cursor) ile bir fragmanÄ±n Ã¼stÃ¼ne gelince Ã¶nizleme (preview) oynar. Ãœzerine tÄ±klayÄ±nca tam aÃ§Ä±lÄ±r.
                            </div>
                        </div>
                    </div>

                    <div class="lg:col-span-2">
                        <div class="bg-white/5 rounded-xl p-4">
                            <div id="trailersList" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4"></div>
                            <div id="trailersEmpty" class="text-center py-10 hidden">
                                <div class="text-white/70 text-5xl mb-3"><i class="fab fa-youtube"></i></div>
                                <h3 class="text-xl font-semibold text-white mb-1">HenÃ¼z fragman eklemediniz</h3>
                                <p class="text-purple-100">Dizi/film eklerken "YouTube Fragman Linki" alanÄ±nÄ± doldurun</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Series Edit Modal -->
    <div id="seriesModal" class="modal">
        <div class="modal-content">
            <h2 id="seriesModalTitle" class="text-2xl font-bold mb-6">Dizi Ekle</h2>
            <form id="seriesForm">
                <input type="hidden" id="seriesId">

                <div class="form-group">
                    <label for="seriesName">Dizi AdÄ± *</label>
                    <input type="text" id="seriesName" name="seriesName" class="form-control" required>
                </div>

                <!-- Sezon SeÃ§imi -->
                <div class="form-group">
                    <label for="seasonSelector">DÃ¼zenlenecek Sezon</label>
                    <div class="flex gap-2">
                        <select id="seasonSelector" class="form-control flex-1">
                            <option value="">Sezon seÃ§in...</option>
                        </select>
                        <button type="button" id="addNewSeasonBtn" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus mr-1"></i> Yeni Sezon
                        </button>
                    </div>
                </div>

                <!-- SeÃ§ilen Sezon Bilgileri -->
                <div id="selectedSeasonInfo" class="form-group" style="display: none;">
                    <div class="season-form-item">
                        <div class="season-form-header">
                            <h4 class="season-form-title">Sezon Bilgileri</h4>
                            <button type="button" id="deleteSeasonBtn" class="remove-season-btn" style="display: none;">
                                <i class="fas fa-trash mr-1"></i> Sezonu Sil
                            </button>
                        </div>
                        <div class="season-form-fields">
                            <div>
                                <label>Sezon NumarasÄ±</label>
                                <input type="number" name="seasonNumber" class="form-control season-number" min="1">
                            </div>
                            <div>
                                <label>Toplam BÃ¶lÃ¼m</label>
                                <input type="number" name="totalEpisodes" class="form-control total-episodes" min="1">
                            </div>
                            <div>
                                <label>Ä°zlenen BÃ¶lÃ¼m</label>
                                <input type="number" name="watchedEpisodes" class="form-control watched-episodes"
                                    min="0">
                            </div>
                        </div>
                        <div class="season-form-actions" style="margin-top: 15px;">
                            <button type="button" id="saveNewSeasonBtn" class="btn btn-success" style="display: none;">
                                <i class="fas fa-plus mr-1"></i> Yeni Sezonu Kaydet
                            </button>
                        </div>
                    </div>
                </div>


                <div class="form-group">
                    <label for="seriesPlatform">Platform</label>
                    <select id="seriesPlatform" name="seriesPlatform" class="form-control">
                        <option value="Netflix">Netflix</option>
                        <option value="Disney+">Disney+</option>
                        <option value="Amazon Prime">Amazon Prime</option>
                        <option value="HBO Max">HBO Max</option>
                        <option value="Gain">Gain</option>
                        <option value="Exxen">Exxen</option>
                        <option value="DiÄŸer">DiÄŸer</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="seriesTrailerUrl">YouTube Fragman Linki</label>
                    <input type="url" id="seriesTrailerUrl" name="seriesTrailerUrl" class="form-control" 
                           placeholder="https://www.youtube.com/watch?v=...">
                    <small class="text-gray-400 mt-1">YouTube video linkini buraya yapÄ±ÅŸtÄ±rÄ±n (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- IMDB PuanÄ± -->
                <div class="form-group">
                    <label for="seriesImdbRating">IMDB PuanÄ±</label>
                    <input type="number" id="seriesImdbRating" name="seriesImdbRating" class="form-control" 
                           min="0" max="10" step="0.1" placeholder="7.5">
                    <small class="text-gray-400 mt-1">0-10 arasÄ± puan girebilirsiniz (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- AÃ§Ä±klama -->
                <div class="form-group">
                    <label for="seriesDescription">AÃ§Ä±klama</label>
                    <textarea id="seriesDescription" name="seriesDescription" class="form-control" 
                              rows="3" placeholder="Dizi hakkÄ±nda kÄ±sa aÃ§Ä±klama..."></textarea>
                    <small class="text-gray-400 mt-1">Dizi hakkÄ±nda kÄ±sa bir aÃ§Ä±klama yazabilirsiniz (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- Resim Linki -->
                <div class="form-group">
                    <label for="seriesImageUrl">Resim Linki</label>
                    <input type="url" id="seriesImageUrl" name="seriesImageUrl" class="form-control" 
                           placeholder="https://example.com/image.jpg">
                    <small class="text-gray-400 mt-1">Dizi posteri veya kapak resmi linki (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- Ã‡Ä±kÄ±ÅŸ Tarihi -->
                <div class="form-group">
                    <label for="seriesReleaseDate">Ã‡Ä±kÄ±ÅŸ Tarihi</label>
                    <input type="date" id="seriesReleaseDate" name="seriesReleaseDate" class="form-control">
                    <small class="text-gray-400 mt-1">Dizinin Ã§Ä±kÄ±ÅŸ tarihi (yakÄ±nda Ã§Ä±kacak diziler iÃ§in isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- Kategori seÃ§imi -->
                <div class="form-group">
                    <label>Kategoriler</label>
                    <div id="seriesCategorySelector" class="category-selector">
                        <!-- Kategoriler buraya dinamik olarak eklenecek -->
                    </div>
                </div>

                <!-- Etiketler -->
                <div class="form-group">
                    <label for="seriesTags">Etiketler</label>
                    <div class="tag-input-container" id="seriesTagsContainer">
                        <input type="text" id="seriesTagsInput" class="tag-input"
                            placeholder="Etiket ekle ve Enter'a bas">
                    </div>
                    <div id="seriesTagOptions" class="tag-cloud mt-2"></div>
                </div>

                <!-- Sezonlar iÃ§in container -->
                <div id="seasonsContainer" class="flex flex-col gap-4"></div>

                <div class="action-buttons">
                    <button type="button" id="cancelSeries" class="btn btn-secondary flex-1">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary flex-1">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Movie Edit Modal -->
    <div id="movieModal" class="modal">
        <div class="modal-content">
            <h2 id="movieModalTitle" class="text-2xl font-bold mb-6">Film Ekle</h2>
            <form id="movieForm">
                <input type="hidden" id="movieId">
                <div class="form-group">
                    <label for="movieName">Film AdÄ± *</label>
                    <input type="text" id="movieName" class="form-control" required>
                </div>

                <!-- Kategori seÃ§imi -->
                <div class="form-group">
                    <label>Kategoriler</label>
                    <div id="movieCategorySelector" class="category-selector">
                        <!-- Kategoriler buraya dinamik olarak eklenecek -->
                    </div>
                </div>

                <!-- Etiketler -->
                <div class="form-group">
                    <label for="movieTags">Etiketler</label>
                    <div class="tag-input-container" id="movieTagsContainer">
                        <input type="text" id="movieTagsInput" class="tag-input"
                            placeholder="Etiket ekle ve Enter'a bas">
                    </div>
                    <div id="movieTagOptions" class="tag-cloud mt-2"></div>
                </div>

                <div class="form-group">
                    <label for="movieTrailerUrl">YouTube Fragman Linki</label>
                    <input type="url" id="movieTrailerUrl" name="movieTrailerUrl" class="form-control" 
                           placeholder="https://www.youtube.com/watch?v=...">
                    <small class="text-gray-400 mt-1">YouTube video linkini buraya yapÄ±ÅŸtÄ±rÄ±n (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- IMDB PuanÄ± -->
                <div class="form-group">
                    <label for="movieImdbRating">IMDB PuanÄ±</label>
                    <input type="number" id="movieImdbRating" name="movieImdbRating" class="form-control" 
                           min="0" max="10" step="0.1" placeholder="7.5">
                    <small class="text-gray-400 mt-1">0-10 arasÄ± puan girebilirsiniz (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- AÃ§Ä±klama -->
                <div class="form-group">
                    <label for="movieDescription">AÃ§Ä±klama</label>
                    <textarea id="movieDescription" name="movieDescription" class="form-control" 
                              rows="3" placeholder="Film hakkÄ±nda kÄ±sa aÃ§Ä±klama..."></textarea>
                    <small class="text-gray-400 mt-1">Film hakkÄ±nda kÄ±sa bir aÃ§Ä±klama yazabilirsiniz (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- Resim Linki -->
                <div class="form-group">
                    <label for="movieImageUrl">Resim Linki</label>
                    <input type="url" id="movieImageUrl" name="movieImageUrl" class="form-control" 
                           placeholder="https://example.com/image.jpg">
                    <small class="text-gray-400 mt-1">Film posteri veya kapak resmi linki (isteÄŸe baÄŸlÄ±)</small>
                </div>

                <!-- Ã‡Ä±kÄ±ÅŸ Tarihi -->
                <div class="form-group">
                    <label for="movieReleaseDate">Ã‡Ä±kÄ±ÅŸ Tarihi</label>
                    <input type="date" id="movieReleaseDate" name="movieReleaseDate" class="form-control">
                    <small class="text-gray-400 mt-1">Filmin Ã§Ä±kÄ±ÅŸ tarihi (yakÄ±nda Ã§Ä±kacak filmler iÃ§in isteÄŸe baÄŸlÄ±)</small>
                </div>

                <div class="form-group">
                    <label class="flex items-center">
                        <input type="checkbox" id="movieWatched" class="mr-2">
                        <span>Ä°zlendi</span>
                    </label>
                </div>
                <div class="action-buttons">
                    <button type="button" id="cancelMovie" class="btn btn-secondary flex-1">Ä°ptal</button>
                    <button type="submit" class="btn btn-primary flex-1">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <button id="openSyncModal" class="sync-btn"><i class="fas fa-sync-alt"></i> Senkronizasyon</button>

    <!-- Senkronizasyon Modal -->
    <div id="syncModal" class="modal">
        <div class="modal-content sync-modal-content">
            <div class="modal-header">
                <h3>Senkronizasyon AyarlarÄ±</h3>
                <button id="closeSyncModal" class="close-trailer-btn">&times;</button>
            </div>
            <div class="p-6 sync-form">
                <div class="form-group">
                    <label for="syncKeyInput">Senkronizasyon AnahtarÄ±</label>
                    <input type="text" id="syncKeyInput" class="form-control" placeholder="Ã¶r: benim-listem">
                    <small class="text-gray-400 mt-1">AynÄ± anahtar ile diÄŸer cihazlarda baÄŸlanÄ±n.</small>
                </div>
                <!-- Firebase bÃ¶lÃ¼mÃ¼ kaldÄ±rÄ±ldÄ±; sadece WebRTC ile eÅŸleÅŸtirme kullanÄ±lacak -->
                <div class="mt-6 border-t border-gray-600 pt-4">
                    <h4 class="text-lg font-semibold mb-2">Cihaz EÅŸleÅŸtirme</h4>
                    <p class="text-gray-400 text-sm mb-3">Ä°ki cihaz arasÄ±nda doÄŸrudan baÄŸlantÄ± kurun. Sunucu gerekmez.</p>
                    
                    <div class="form-group">
                        <label class="block text-sm mb-1" id="codeLabel">EÅŸleÅŸtirme Kodu</label>
                        <textarea id="pairingCode" class="form-control" rows="4" placeholder="Kod buraya gÃ¶rÃ¼necek veya yapÄ±ÅŸtÄ±rÄ±n"></textarea>
                        <div class="flex gap-2 mt-2 items-center flex-wrap">
                            <button id="generateCodeBtn" class="btn btn-primary"><i class="fas fa-key mr-1"></i> Kod Ãœret</button>
                            <button id="showQrBtn" class="btn btn-secondary"><i class="fas fa-qrcode mr-1"></i> QR GÃ¶ster</button>
                            <button id="scanQrBtn" class="btn btn-secondary"><i class="fas fa-camera mr-1"></i> QR Tara</button>
                            <button id="connectBtn" class="btn btn-success"><i class="fas fa-link mr-1"></i> BaÄŸlan</button>
                            <button id="resetPairingBtn" class="btn btn-warning"><i class="fas fa-redo mr-1"></i> SÄ±fÄ±rla</button>
                        </div>
                        <div id="qrContainer" class="mt-2"></div>
                    </div>

                    <div class="form-group mt-4">
                        <label for="connectTimeoutInput">BaÄŸlantÄ± zaman aÅŸÄ±mÄ± (saniye)</label>
                        <input type="number" id="connectTimeoutInput" class="form-control" min="5" max="60" step="1">
                        <small class="text-gray-400 mt-1">BaÄŸlantÄ± kurulmasÄ± iÃ§in beklenecek sÃ¼re.</small>
                    </div>

                    <div class="form-group mt-4">
                        <label for="trailerTimeoutInput">Fragman baÅŸlangÄ±Ã§ zaman aÅŸÄ±mÄ± (saniye)</label>
                        <input type="number" id="trailerTimeoutInput" class="form-control" min="1" max="30" step="1">
                        <small class="text-gray-400 mt-1">FragmanÄ±n baÅŸlamasÄ± iÃ§in beklenecek sÃ¼re.</small>
                    </div>

                    <!-- Durum ve yÃ¶nergeler -->
                    <div class="mt-4 p-3 bg-gray-800 rounded">
                        <p id="pairingStatus" class="text-gray-300 mb-2">Durum: BaÄŸlantÄ± bekleniyor</p>
                        <div id="pairingInstructions" class="text-sm text-gray-400">
                            <p><strong>AdÄ±m 1:</strong> "Kod Ãœret" butonuna basÄ±n</p>
                            <p><strong>AdÄ±m 2:</strong> Kodu diÄŸer cihaza paylaÅŸÄ±n (QR ile veya kopyala-yapÄ±ÅŸtÄ±r)</p>
                            <p><strong>AdÄ±m 3:</strong> DiÄŸer cihazdan gelen cevap kodunu buraya yapÄ±ÅŸtÄ±rÄ±n</p>
                            <p><strong>AdÄ±m 4:</strong> "BaÄŸlan" butonuna basÄ±n</p>
                        </div>
                    </div>

                    <!-- QR tarayÄ±cÄ± konteyneri -->
                    <div class="mt-3">
                        <div id="qrScannerContainer" class="border border-gray-600 rounded p-2 hidden"></div>
                        <button id="stopQrScanBtn" class="btn btn-secondary mt-2 hidden"><i class="fas fa-stop mr-1"></i> TarayÄ±cÄ±yÄ± Durdur</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.9/html5-qrcode.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <style>
        /* Release Date Badge Styles */
        .release-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.375rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            cursor: help;
            margin-top: 0.5rem;
        }

        .release-badge-live {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            animation: pulse 2s infinite;
        }

        .release-badge-today {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            animation: glow 1.5s ease-in-out infinite alternate;
        }

        .release-badge-soon {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .release-badge-upcoming {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
        }

        .release-badge-far {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
        }

        .dark-theme .release-badge {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.8;
            }
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 5px rgba(245, 158, 11, 0.5);
            }
            to {
                box-shadow: 0 0 20px rgba(245, 158, 11, 0.8), 0 0 30px rgba(245, 158, 11, 0.6);
            }
        }

        .release-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .dark-theme .release-badge:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        /* Responsive adjustments for release badge */
        @media (max-width: 768px) {
            .release-badge {
                font-size: 0.625rem;
                padding: 0.25rem 0.5rem;
            }
        }
        /* Upcoming card modern layout */
        .upcoming-card {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: stretch;
            background: var(--card-light);
            border: 1px solid var(--border-light);
            border-radius: 14px;
            padding: 14px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
        }
        .upcoming-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            border-color: var(--primary);
        }
        .upcoming-thumb {
            position: relative;
            width: 100%;
            height: auto;
            aspect-ratio: 2 / 3;
            border-radius: 12px;
            overflow: hidden;
            background: #0f172a;
        }
        .upcoming-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .badge-overlay {
            position: absolute;
            top: 8px;
            left: 8px;
            z-index: 1;
        }
        .meta-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 6px;
        }
        .meta-chip {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(99,102,241,0.12);
            color: #334155;
        }
        .dark-theme .meta-chip {
            background: rgba(99,102,241,0.15);
            color: #e2e8f0;
        }
        .pill-imdb {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(234,179,8,0.12);
            color: #ca8a04;
            font-weight: 600;
        }
        .dark-theme .pill-imdb {
            background: rgba(234,179,8,0.18);
            color: #facc15;
        }
        .upcoming-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        .upcoming-footer .date {
            font-size: 0.75rem;
            color: var(--text-light-2);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>

    <script>
        // --- P2P Sync State ---
        let pushDebounceTimer = null;
        let peerPushDebounceTimer = null;
        let connectTimeoutTimer = null;
        // Data storage
        let seriesData = JSON.parse(localStorage.getItem('seriesData')) || [];
        let moviesData = JSON.parse(localStorage.getItem('moviesData')) || [];
        let categoriesData = JSON.parse(localStorage.getItem('categoriesData')) || [
            { id: 1, name: 'Aksiyon', color: '#ef4444' },
            { id: 2, name: 'Komedi', color: '#f59e0b' },
            { id: 3, name: 'Dram', color: '#10b981' },
            { id: 4, name: 'Bilim Kurgu', color: '#6366f1' },
            { id: 5, name: 'Fantastik', color: '#8b5cf6' }
        ];
        let tagsData = JSON.parse(localStorage.getItem('tagsData')) || [];
        let filteredSeriesData = [...seriesData];
        let filteredMoviesData = [...moviesData];
        let currentSeriesFilter = 'all';
        let currentMoviesFilter = 'all';
        let currentSeriesCategory = null;
        let currentMoviesCategory = null;
        let currentTrailersFilter = 'all';
        let currentTrailersSort = 'alphabetical';
        let trailersSearchQuery = '';
        let seriesView = '3';
        // GÃ¶rsel oranÄ±: Tailwind aspect-ratio class
        let posterAspect = localStorage.getItem('posterAspect') || 'aspect-[2/3]';
        // Kart yerleÅŸimi modu: 'grid' veya 'masonry'
        let layoutMode = localStorage.getItem('layoutMode') || 'masonry';
        let trailerPlayer = null;
        let trailerStartTimeout = null;
        let trailerHasStarted = false;
        let trailersPreviewPlayer = null;
        let trailersPreviewVideoId = null;
        let trailersPreviewStartTimer = null;

        // --- Sync helpers (P2P) ---

        function getAllDataPayload() {
            return {
                series: seriesData,
                movies: moviesData,
                categories: categoriesData,
                tags: tagsData,
                updatedAt: Date.now(),
                origin: window.location.origin
            };
        }

        // Bulut push kaldÄ±rÄ±ldÄ±

        function schedulePeerPush() {
            if (!rtcChannel || rtcChannel.readyState !== 'open') return;
            clearTimeout(peerPushDebounceTimer);
            peerPushDebounceTimer = setTimeout(() => {
                try {
                    const payload = getAllDataPayload();
                    rtcChannel.send(JSON.stringify({ type: 'syncData', payload }));
                    if (rtcStatusEl) rtcStatusEl.textContent = 'Durum: P2P gÃ¶nderildi (' + new Date(payload.updatedAt).toLocaleTimeString() + ')';
                } catch (_) {}
            }, 600);
        }

        // Bulut push kaldÄ±rÄ±ldÄ±

        function applyRemoteData(data) {
            if (!data) return;
            // P2P iÃ§in zaman kÄ±yasÄ±nÄ± basitÃ§e uygula
            seriesData = Array.isArray(data.series) ? data.series : seriesData;
            moviesData = Array.isArray(data.movies) ? data.movies : moviesData;
            categoriesData = Array.isArray(data.categories) ? data.categories : categoriesData;
            tagsData = Array.isArray(data.tags) ? data.tags : tagsData;
            localStorage.setItem('seriesData', JSON.stringify(seriesData));
            localStorage.setItem('moviesData', JSON.stringify(moviesData));
            localStorage.setItem('categoriesData', JSON.stringify(categoriesData));
            localStorage.setItem('tagsData', JSON.stringify(tagsData));
            filterSeries();
            filterMovies();
            renderCategoryFilters();
            updateTotalStats();
            updateSeriesTagCloud();
            updateMoviesTagCloud();
            if (rtcStatusEl) rtcStatusEl.textContent = 'Durum: P2P veri alÄ±ndÄ±';
        }

        // Bulut aboneliÄŸi kaldÄ±rÄ±ldÄ±

        // Patch localStorage.setItem to auto-push
        const __origSetItem = localStorage.setItem.bind(localStorage);
        localStorage.setItem = function(key, value) {
            __origSetItem(key, value);
            if (['seriesData','moviesData','categoriesData','tagsData'].includes(key)) {
                schedulePeerPush();
            }
        };
        let moviesView = '3';

        // Image loading error handling
        function handleImageError(img) {
            // YouTube thumbnail fallback strategy
            if (img.src && img.src.includes('i.ytimg.com/vi/') && !img.hasAttribute('data-fallback-tried')) {
                // If hqdefault fails (404), try mqdefault
                if (img.src.includes('hqdefault.jpg')) {
                    img.setAttribute('data-fallback-tried', 'true');
                    img.src = img.src.replace('hqdefault.jpg', 'mqdefault.jpg');
                    return;
                }
            }

            img.style.display = 'none';
            const placeholder = img.parentElement;
            if (placeholder) {
                placeholder.innerHTML = `
                    <div class="w-full h-48 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                        <i class="fas fa-image text-gray-400 text-4xl"></i>
                    </div>
                `;
            }
        }

        function setupImageErrorHandling() {
            // Setup error handling for all images
            document.querySelectorAll('img').forEach(img => {
                if (!img.hasAttribute('data-error-handled')) {
                    img.setAttribute('data-error-handled', 'true');
                    img.addEventListener('error', function() {
                        handleImageError(this);
                    });
                }
            });
        }

        // Check for saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-theme');
            document.querySelector('#themeToggle i').className = 'fas fa-sun text-white text-xl';
        }

        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', function () {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');

            const icon = this.querySelector('i');
            icon.className = isDark ? 'fas fa-sun text-white text-xl' : 'fas fa-moon text-white text-xl';
        });

        // DOM Elements
        const seriesTab = document.getElementById('seriesTab');
        const moviesTab = document.getElementById('moviesTab');
        const upcomingTab = document.getElementById('upcomingTab');
        const categoriesTab = document.getElementById('categoriesTab');
        const tagsTab = document.getElementById('tagsTab');
        const trailersTab = document.getElementById('trailersTab');
        const seriesContent = document.getElementById('seriesContent');
        const moviesContent = document.getElementById('moviesContent');
        const upcomingContent = document.getElementById('upcomingContent');
        const categoriesContent = document.getElementById('categoriesContent');
        const tagsContent = document.getElementById('tagsContent');
        const trailersContent = document.getElementById('trailersContent');
        const seriesList = document.getElementById('seriesList');
        const moviesList = document.getElementById('moviesList');
        const categoriesList = document.getElementById('categoriesList');
        const seriesEmpty = document.getElementById('seriesEmpty');
        const moviesEmpty = document.getElementById('moviesEmpty');
        const trailersList = document.getElementById('trailersList');
        const trailersEmpty = document.getElementById('trailersEmpty');
        const trailersCount = document.getElementById('trailersCount');
        const trailersPreviewInfo = document.getElementById('trailersPreviewInfo');
        const trailersSearch = document.getElementById('trailersSearch');
        const trailersFilterAll = document.getElementById('trailersFilterAll');
        const trailersFilterSeries = document.getElementById('trailersFilterSeries');
        const trailersFilterMovies = document.getElementById('trailersFilterMovies');
        const trailersSortSelect = document.getElementById('trailersSortSelect');
        const totalStats = document.getElementById('totalStats');
        
        // Upcoming releases DOM elements
        const upcomingList = document.getElementById('upcomingList');
        const upcomingCount = document.getElementById('upcomingCount');
        const upcomingEmpty = document.getElementById('upcomingEmpty');
        const upcomingFilterAll = document.getElementById('upcomingFilterAll');
        const upcomingFilterSeries = document.getElementById('upcomingFilterSeries');
        const upcomingFilterMovies = document.getElementById('upcomingFilterMovies');
        const thisWeekCount = document.getElementById('thisWeekCount');
        const thisMonthCount = document.getElementById('thisMonthCount');
        const futureCount = document.getElementById('futureCount');
        // Sync UI elements
        const openSyncModalBtn = document.getElementById('openSyncModal');
        const syncModalEl = document.getElementById('syncModal');
        const closeSyncModalBtn = document.getElementById('closeSyncModal');
        const syncKeyInput = document.getElementById('syncKeyInput');
        const firebaseConfigInput = document.getElementById('firebaseConfigInput');
        const connectSyncBtn = document.getElementById('connectSyncBtn');
        const syncNowBtn = document.getElementById('syncNowBtn');
        const disconnectSyncBtn = document.getElementById('disconnectSyncBtn');
        const syncStatusEl = document.getElementById('syncStatus');
        // BasitleÅŸtirilmiÅŸ WebRTC pairing elements
        const pairingCode = document.getElementById('pairingCode');
        const generateCodeBtn = document.getElementById('generateCodeBtn');
        const showQrBtn = document.getElementById('showQrBtn');
        const scanQrBtn = document.getElementById('scanQrBtn');
        const connectBtn = document.getElementById('connectBtn');
        const pairingStatus = document.getElementById('pairingStatus');
        const pairingInstructions = document.getElementById('pairingInstructions');
        const codeLabel = document.getElementById('codeLabel');
        const qrContainer = document.getElementById('qrContainer');
        const connectTimeoutInput = document.getElementById('connectTimeoutInput');
        const trailerTimeoutInput = document.getElementById('trailerTimeoutInput');
        const seriesStats = document.getElementById('seriesStats');
        const moviesStats = document.getElementById('moviesStats');
        const moviesStatusSummary = document.getElementById('moviesStatusSummary');
        const seriesStatusSummary = document.getElementById('seriesStatusSummary');
        const addSeriesBtn = document.getElementById('addSeriesBtn');
        const addSeriesBtnEmpty = document.getElementById('addSeriesBtnEmpty');
        const addMovieBtn = document.getElementById('addMovieBtn');
        const addMovieBtnEmpty = document.getElementById('addMovieBtnEmpty');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const seriesModal = document.getElementById('seriesModal');
        const movieModal = document.getElementById('movieModal');
        const searchSeries = document.getElementById('searchSeries');
        const searchMovies = document.getElementById('searchMovies');
        const seriesTagCloud = document.getElementById('seriesTagCloud');
        const moviesTagCloud = document.getElementById('moviesTagCloud');

        let connectTimeoutMs = parseInt(localStorage.getItem('connectTimeoutMs') || '12000', 10);
        if (connectTimeoutInput) {
            let seconds = Math.round(connectTimeoutMs / 1000);
            if (!Number.isFinite(seconds) || seconds <= 0) seconds = 12;
            if (seconds < 5) seconds = 5;
            if (seconds > 60) seconds = 60;
            connectTimeoutMs = seconds * 1000;
            connectTimeoutInput.value = seconds;
            connectTimeoutInput.addEventListener('change', function () {
                let value = parseInt(this.value, 10);
                if (!Number.isFinite(value) || value <= 0) value = 12;
                if (value < 5) value = 5;
                if (value > 60) value = 60;
                this.value = value;
                connectTimeoutMs = value * 1000;
                localStorage.setItem('connectTimeoutMs', String(connectTimeoutMs));
            });
        }

        let trailerStartTimeoutMs = parseInt(localStorage.getItem('trailerStartTimeoutMs') || '2000', 10);
        if (trailerTimeoutInput) {
            let seconds = Math.round(trailerStartTimeoutMs / 1000);
            if (!Number.isFinite(seconds) || seconds <= 0) seconds = 2;
            if (seconds < 1) seconds = 1;
            if (seconds > 30) seconds = 30;
            trailerStartTimeoutMs = seconds * 1000;
            trailerTimeoutInput.value = seconds;
            trailerTimeoutInput.addEventListener('change', function () {
                let value = parseInt(this.value, 10);
                if (!Number.isFinite(value) || value <= 0) value = 2;
                if (value < 1) value = 1;
                if (value > 30) value = 30;
                this.value = value;
                trailerStartTimeoutMs = value * 1000;
                localStorage.setItem('trailerStartTimeoutMs', String(trailerStartTimeoutMs));
            });
        }

        // Initialize the app
        function initApp() {
            updateTotalStats();
            renderSeriesList();
            renderMoviesList();
            renderCategoriesList();
            renderCategoryFilters();
            renderTagsList();
            updateSeriesCategorySelector();
            updateMovieCategorySelector();
            updateSeriesTagCloud();
            updateMoviesTagCloud();

            // VarsayÄ±lan sÄ±ralamayÄ± uygula
            const seriesSortSelect = document.getElementById('seriesSortSelect');
            const moviesSortSelect = document.getElementById('moviesSortSelect');
            if (seriesSortSelect) sortSeries(seriesSortSelect.value);
            if (moviesSortSelect) sortMovies(moviesSortSelect.value);

            // Initialize tag inputs
            initTagInput('seriesTagsInput', 'seriesTagsContainer');
            initTagInput('movieTagsInput', 'movieTagsContainer');

            // Event delegation for edit and delete buttons
            setupEventDelegation();
        }

        // Event delegation setup
        function setupEventDelegation() {
            // Series edit and delete buttons
            document.addEventListener('click', function(e) {
                // Series edit button
                if (e.target.closest('.edit-icon') && e.target.closest('.series-card')) {
                    const editBtn = e.target.closest('.edit-icon');
                    const name = editBtn.getAttribute('data-name');
                    const seriesInfo = seriesData.find(s => s.name === name);
                    if (seriesInfo) {
                        editSeries(seriesInfo.id);
                    }
                }
                
                // Series delete button
                if (e.target.closest('.delete-icon') && e.target.closest('.series-card')) {
                    const deleteBtn = e.target.closest('.delete-icon');
                    const name = deleteBtn.getAttribute('data-name');
                    if (confirm(`"${name}" dizisinin tÃ¼m sezonlarÄ±nÄ± silmek istediÄŸinize emin misiniz?`)) {
                        seriesData = seriesData.filter(s => s.name !== name);
                        localStorage.setItem('seriesData', JSON.stringify(seriesData));
                        filteredSeriesData = [...seriesData];
                        renderSeriesList();
                        renderCategoryFilters();
                        updateTotalStats();
                        updateSeriesTagCloud();
                    }
                }

                // Movie edit button
                if (e.target.closest('.edit-icon') && e.target.closest('.movie-card')) {
                    const editBtn = e.target.closest('.edit-icon');
                    const id = editBtn.getAttribute('data-id');
                    editMovie(id);
                }

                // Movie delete button
                if (e.target.closest('.delete-icon') && e.target.closest('.movie-card')) {
                    const deleteBtn = e.target.closest('.delete-icon');
                    const id = deleteBtn.getAttribute('data-id');
                    if (confirm('Bu filmi silmek istediÄŸinize emin misiniz?')) {
                        moviesData = moviesData.filter(m => m.id != id);
                        localStorage.setItem('moviesData', JSON.stringify(moviesData));
                        filteredMoviesData = [...moviesData];
                        renderMoviesList();
                        renderCategoryFilters();
                        updateTotalStats();
                        updateMoviesTagCloud();
                    }
                }
            });
        }

        // Render category chips with counts for series and movies
        function renderCategoryFilters() {
            const seriesContainer = document.getElementById('seriesCategoryFilters');
            const moviesContainer = document.getElementById('moviesCategoryFilters');
            if (!seriesContainer || !moviesContainer) return;

            seriesContainer.innerHTML = '';
            moviesContainer.innerHTML = '';

            categoriesData.forEach(cat => {
                const seriesCount = seriesData.filter(s => s.categories && s.categories.includes(cat.id)).length;
                const movieCount = moviesData.filter(m => m.categories && m.categories.includes(cat.id)).length;

                const sChip = document.createElement('button');
                sChip.className = 'category-option';
                sChip.style.backgroundColor = cat.color;
                sChip.style.color = 'white';
                sChip.setAttribute('data-id', cat.id);
                sChip.innerHTML = `${cat.name} <span>(${seriesCount})</span>`;
                sChip.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const id = parseInt(this.getAttribute('data-id'));
                    if (currentSeriesCategory === id) currentSeriesCategory = null; else currentSeriesCategory = id;
                    // visually mark selected
                    document.querySelectorAll('#seriesCategoryFilters .category-option').forEach(b => b.classList.remove('selected'));
                    if (currentSeriesCategory) {
                        const el = document.querySelector(`#seriesCategoryFilters .category-option[data-id=\"${currentSeriesCategory}\"]`);
                        if (el) el.classList.add('selected');
                    }
                    filterSeries();
                });

                const mChip = document.createElement('button');
                mChip.className = 'category-option';
                mChip.style.backgroundColor = cat.color;
                mChip.style.color = 'white';
                mChip.setAttribute('data-id', cat.id);
                mChip.innerHTML = `${cat.name} <span>(${movieCount})</span>`;
                mChip.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const id = parseInt(this.getAttribute('data-id'));
                    if (currentMoviesCategory === id) currentMoviesCategory = null; else currentMoviesCategory = id;
                    document.querySelectorAll('#moviesCategoryFilters .category-option').forEach(b => b.classList.remove('selected'));
                    if (currentMoviesCategory) {
                        const el = document.querySelector(`#moviesCategoryFilters .category-option[data-id=\"${currentMoviesCategory}\"]`);
                        if (el) el.classList.add('selected');
                    }
                    filterMovies();
                });

                seriesContainer.appendChild(sChip);
                moviesContainer.appendChild(mChip);
            });
        }

        // Update total stats
        function updateTotalStats() {
            const seriesCount = seriesData.length;
            const moviesCount = moviesData.length;
            const total = seriesCount + moviesCount;

            // Toplam iÃ§erik sayÄ±larÄ±
            seriesStats.textContent = seriesCount;
            moviesStats.textContent = moviesCount;
            totalStats.textContent = total;

            // Film istatistikleri: izlendi / izlenmedi (Ã¶zet satÄ±rÄ±)
            const watchedMovies = moviesData.filter(m => m.watched).length;
            const unwatchedMovies = moviesCount - watchedMovies;
            if (moviesStatusSummary) {
                moviesStatusSummary.textContent = `Ä°zlenen ${watchedMovies} / Ä°zlenmeyen ${unwatchedMovies}`;
            }

            // Dizi istatistikleri: tamamlanan / izleniyor / planlanan (Ã¶zet satÄ±rÄ±, dizi bazÄ±nda)
            const seriesNames = Array.from(new Set(seriesData.map(s => s.name)));
            let completed = 0, watching = 0, planning = 0;
            seriesNames.forEach(name => {
                const seasons = seriesData.filter(s => s.name === name);
                const totalEpisodes = seasons.reduce((sum, s) => sum + (s.totalEpisodes || 0), 0);
                const watchedEpisodes = seasons.reduce((sum, s) => sum + (s.watchedEpisodes || 0), 0);
                const status = totalEpisodes > 0 && watchedEpisodes === totalEpisodes
                    ? 'completed'
                    : watchedEpisodes > 0
                        ? 'watching'
                        : 'planning';
                if (status === 'completed') completed++;
                else if (status === 'watching') watching++;
                else planning++;
            });
            if (seriesStatusSummary) {
                seriesStatusSummary.textContent = `Tamamlanan ${completed} / Ä°zlenen ${watching} / Planlanan ${planning}`;
            }
        }

        // Render series list
        // Group series by name
        function groupSeriesByName(series) {
            const grouped = {};
            series.forEach(s => {
                if (!grouped[s.name]) {
                    grouped[s.name] = {
                        name: s.name,
                        platform: s.platform,
                        categories: s.categories,
                        tags: s.tags,
                        trailerUrl: s.trailerUrl,
                        imdbRating: s.imdbRating,
                        description: s.description,
                        imageUrl: s.imageUrl,
                        releaseDate: s.releaseDate,
                        seasons: []
                    };
                }
                grouped[s.name].seasons.push({
                    id: s.id,
                    season: s.season,
                    totalEpisodes: s.totalEpisodes,
                    watchedEpisodes: s.watchedEpisodes,
                    updatedAt: s.updatedAt
                });
                // Sort seasons
                grouped[s.name].seasons.sort((a, b) => a.season - b.season);
            });
            return Object.values(grouped);
        }

        // Upcoming releases functions
        let currentUpcomingFilter = 'all';

        function getUpcomingContent() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const upcomingItems = [];

            // Get upcoming series: choose nearest future release date across seasons
            const groupedSeries = groupSeriesByName(seriesData);
            groupedSeries.forEach(series => {
                const seriesSeasons = seriesData.filter(s => s.name === series.name);

                let bestDateStr = null;
                let bestDate = null;
                seriesSeasons.forEach(s => {
                    if (!s.releaseDate) return;
                    const d = new Date(s.releaseDate);
                    d.setHours(0, 0, 0, 0);
                    if (d >= today && (!bestDate || d < bestDate)) {
                        bestDate = d;
                        bestDateStr = s.releaseDate;
                    }
                });

                if (bestDateStr) {
                    upcomingItems.push({
                        ...series,
                        releaseDate: bestDateStr,
                        type: 'series',
                        daysUntil: getDaysUntilRelease(bestDateStr)
                    });
                }
            });

            // Get upcoming movies
            moviesData.forEach(movie => {
                if (movie.releaseDate) {
                    const releaseDate = new Date(movie.releaseDate);
                    releaseDate.setHours(0, 0, 0, 0);
                    if (releaseDate >= today) {
                        upcomingItems.push({
                            ...movie,
                            type: 'movie',
                            daysUntil: getDaysUntilRelease(movie.releaseDate)
                        });
                    }
                }
            });

            // Sort by release date
            upcomingItems.sort((a, b) => new Date(a.releaseDate) - new Date(b.releaseDate));

            return upcomingItems;
        }

        function filterUpcomingContent(filter) {
            currentUpcomingFilter = filter;
            const allUpcoming = getUpcomingContent();
            
            let filtered = allUpcoming;
            if (filter === 'series') {
                filtered = allUpcoming.filter(item => item.type === 'series');
            } else if (filter === 'movies') {
                filtered = allUpcoming.filter(item => item.type === 'movie');
            }
            
            return filtered;
        }

        function getUpcomingTimeline() {
            const allUpcoming = getUpcomingContent();
            
            const thisWeek = allUpcoming.filter(item => item.daysUntil <= 7).length;
            const thisMonth = allUpcoming.filter(item => item.daysUntil <= 30).length;
            const future = allUpcoming.filter(item => item.daysUntil > 30).length;
            
            return { thisWeek, thisMonth, future };
        }

        function renderUpcomingReleases() {
            const upcomingItems = filterUpcomingContent(currentUpcomingFilter);
            const timeline = getUpcomingTimeline();
            
            // Update counter
            if (upcomingCount) {
                upcomingCount.textContent = `${upcomingItems.length}`;
            }
            
            // Update timeline
            if (thisWeekCount) thisWeekCount.textContent = timeline.thisWeek;
            if (thisMonthCount) thisMonthCount.textContent = timeline.thisMonth;
            if (futureCount) futureCount.textContent = timeline.future;
            
            // Update filter buttons
            upcomingFilterAll.classList.toggle('active', currentUpcomingFilter === 'all');
            upcomingFilterSeries.classList.toggle('active', currentUpcomingFilter === 'series');
            upcomingFilterMovies.classList.toggle('active', currentUpcomingFilter === 'movies');
            
            if (upcomingItems.length === 0) {
                if (upcomingList) upcomingList.classList.add('hidden');
                if (upcomingEmpty) upcomingEmpty.classList.remove('hidden');
                return;
            }
            
            if (upcomingList) upcomingList.classList.remove('hidden');
            if (upcomingEmpty) upcomingEmpty.classList.add('hidden');
            
            upcomingList.innerHTML = upcomingItems.map(item => {
                const badgeInfo = getReleaseBadgeInfo(item.releaseDate);
                const categoryNames = item.categories ? item.categories.map(catId => {
                    const category = categoriesData.find(c => c.id === catId);
                    return category ? category.name : '';
                }).filter(name => name).join(', ') : '';

                const chips = categoryNames
                    ? categoryNames.split(', ').map(n => `<span class="meta-chip">${n}</span>`).join('')
                    : '';

                return `
                    <div class="upcoming-card">
                        <div class="upcoming-thumb">
                            ${item.imageUrl ? `<img src="${item.imageUrl}" alt="${item.name}">` : `<div class="w-full h-full flex items-center justify-center text-[11px] text-white/50">Poster yok</div>`}
                            ${badgeInfo ? `<span class="badge-overlay"><span class="release-badge ${badgeInfo.class}" title="${badgeInfo.fullText}"><i class="fas fa-calendar-alt"></i> ${badgeInfo.text}</span></span>` : ''}
                        </div>
                        <div class="min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white truncate">${item.name}</h3>
                                <span class="px-2 py-0.5 text-xs font-medium rounded-full ${item.type === 'series' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' : 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200'}">${item.type === 'series' ? 'Dizi' : 'Film'}</span>
                            </div>
                            ${item.platform ? `<div class="text-sm text-gray-600 dark:text-gray-400"><i class="fas fa-tv mr-1"></i>${item.platform}</div>` : ''}
                            ${chips ? `<div class="meta-row">${chips}</div>` : ''}
                            ${item.description ? `<p class="text-sm text-gray-700 dark:text-gray-300 mt-2 line-clamp-2">${item.description}</p>` : ''}
                        </div>
                        <div class="upcoming-footer">
                            <div class="date"><i class="fas fa-calendar-alt"></i> ${formatReleaseDate(item.releaseDate)}</div>
                            <div class="flex items-center gap-2">
                                ${item.imdbRating ? `<span class="pill-imdb"><i class="fas fa-star"></i>${item.imdbRating}</span>` : ''}
                                ${item.trailerUrl ? `<button class="trailer-btn btn btn-secondary btn-sm" data-trailer-url="${item.trailerUrl}" data-title="${item.name}" title="FragmanÄ± Ä°zle"><i class="fab fa-youtube mr-1"></i> Ä°zle</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getAllTrailerItems() {
            const items = [];

            const groupedSeries = groupSeriesByName(seriesData || []);
            groupedSeries.forEach(series => {
                const trailerUrl = series.trailerUrl;
                if (!trailerUrl) return;
                const videoId = extractYouTubeVideoId(trailerUrl);
                if (!videoId) return;
                items.push({
                    type: 'series',
                    name: series.name,
                    platform: series.platform,
                    imageUrl: series.imageUrl,
                    trailerUrl,
                    videoId
                });
            });

            (moviesData || []).forEach(movie => {
                const trailerUrl = movie.trailerUrl;
                if (!trailerUrl) return;
                const videoId = extractYouTubeVideoId(trailerUrl);
                if (!videoId) return;
                items.push({
                    type: 'movie',
                    name: movie.name,
                    platform: null,
                    imageUrl: movie.imageUrl,
                    trailerUrl,
                    videoId
                });
            });

            return items;
        }

        function renderTrailersTab() {
            if (!trailersList || !trailersEmpty) return;

            let items = getAllTrailerItems();

            if (currentTrailersFilter === 'series') {
                items = items.filter(i => i.type === 'series');
            } else if (currentTrailersFilter === 'movies') {
                items = items.filter(i => i.type === 'movie');
            }

            const q = (trailersSearchQuery || '').trim().toLowerCase();
            if (q) {
                items = items.filter(i => (i.name || '').toLowerCase().includes(q));
            }

            if (currentTrailersSort === 'alphabetical') {
                items.sort((a, b) => (a.name || '').localeCompare((b.name || ''), 'tr'));
            } else if (currentTrailersSort === 'alphabetical-desc') {
                items.sort((a, b) => (b.name || '').localeCompare((a.name || ''), 'tr'));
            } else if (currentTrailersSort === 'type-series-first') {
                items.sort((a, b) => {
                    const aKey = a.type === 'series' ? 0 : 1;
                    const bKey = b.type === 'series' ? 0 : 1;
                    if (aKey !== bKey) return aKey - bKey;
                    return (a.name || '').localeCompare((b.name || ''), 'tr');
                });
            } else if (currentTrailersSort === 'type-movies-first') {
                items.sort((a, b) => {
                    const aKey = a.type === 'movie' ? 0 : 1;
                    const bKey = b.type === 'movie' ? 0 : 1;
                    if (aKey !== bKey) return aKey - bKey;
                    return (a.name || '').localeCompare((b.name || ''), 'tr');
                });
            }

            if (trailersCount) trailersCount.textContent = String(items.length);

            if (trailersFilterAll && trailersFilterSeries && trailersFilterMovies) {
                trailersFilterAll.classList.toggle('active', currentTrailersFilter === 'all');
                trailersFilterSeries.classList.toggle('active', currentTrailersFilter === 'series');
                trailersFilterMovies.classList.toggle('active', currentTrailersFilter === 'movies');
            }

            if (items.length === 0) {
                trailersList.innerHTML = '';
                trailersEmpty.classList.remove('hidden');
                return;
            }

            trailersEmpty.classList.add('hidden');

            trailersList.innerHTML = items.map(item => {
                const typePill = item.type === 'series'
                    ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'
                    : 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200';
                const typeText = item.type === 'series' ? 'Dizi' : 'Film';
                const thumbUrl = `https://i.ytimg.com/vi/${item.videoId}/hqdefault.jpg`;

                return `
                    <div class="bg-white/10 hover:bg-white/20 transition rounded-xl p-3 flex gap-3 items-center cursor-pointer outline-none focus:ring-2 focus:ring-white/30 trailer-preview-item"
                         role="button"
                         tabindex="0"
                         data-trailer-url="${item.trailerUrl}"
                         data-title="${item.name}"
                         data-video-id="${item.videoId}">
                        <div class="w-20 h-12 rounded-lg overflow-hidden bg-black/20 flex-shrink-0">
                            <img src="${thumbUrl}" alt="${item.name}" class="w-full h-full object-cover" onerror="handleImageError(this)">
                        </div>
                        <div class="min-w-0 flex-1">
                            <div class="flex items-center gap-2">
                                <div class="font-semibold text-gray-900 dark:text-white truncate">${item.name}</div>
                                <span class="px-2 py-0.5 text-xs font-medium rounded-full ${typePill}">${typeText}</span>
                            </div>
                            ${item.platform ? `<div class="text-xs text-gray-600 dark:text-gray-400 truncate"><i class="fas fa-tv mr-1"></i>${item.platform}</div>` : ''}
                            <div class="text-xs text-gray-600 dark:text-gray-400 mt-1"><i class="fab fa-youtube mr-1"></i>ÃœstÃ¼ne gel: oynat â€¢ TÄ±kla: tam aÃ§</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function stopTrailersPreview(resetInfoText) {
            if (trailersPreviewStartTimer) {
                clearTimeout(trailersPreviewStartTimer);
                trailersPreviewStartTimer = null;
            }
            
            // Iframe'i temizle
            const container = document.getElementById('trailersPreviewPlayer');
            if (container) {
                container.innerHTML = '';
            }
            trailersPreviewPlayer = null;
            
            trailersPreviewVideoId = null;
            if (resetInfoText && trailersPreviewInfo) {
                trailersPreviewInfo.textContent = 'Liste Ã¼stÃ¼nde imleÃ§ (cursor) ile bir fragmanÄ±n Ã¼stÃ¼ne gelince Ã¶nizleme (preview) oynar. Ãœzerine tÄ±klayÄ±nca tam aÃ§Ä±lÄ±r.';
            }
        }

        function playTrailersPreview(videoId, title) {
            if (!videoId) return;
            if (trailersPreviewVideoId === videoId) return;
            trailersPreviewVideoId = videoId;
            
            const container = document.getElementById('trailersPreviewPlayer');
            if (!container) return;

            if (trailersPreviewInfo) {
                trailersPreviewInfo.textContent = `"${title}" Ã¶nizleme (preview) yÃ¼kleniyor...`;
            }

            // Iframe oluÅŸtur
            const iframe = document.createElement('iframe');
            iframe.width = "100%";
            iframe.height = "100%";
            
            // Embed URL (Preview iÃ§in)
            // autoplay=1: Otomatik baÅŸlat
            // mute=1: Sessiz (autoplay politikasÄ± iÃ§in)
            // controls=0: KontrolsÃ¼z
            const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&controls=0&rel=0&modestbranding=1&playsinline=1`;
            
            iframe.src = embedUrl;
            iframe.title = "YouTube video player";
            iframe.frameBorder = "0";
            iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
            iframe.referrerPolicy = "strict-origin-when-cross-origin";
            iframe.allowFullscreen = true;
            
            container.innerHTML = '';
            container.appendChild(iframe);
            trailersPreviewPlayer = iframe;

            if (trailersPreviewInfo) {
                trailersPreviewInfo.textContent = `"${title}" Ã¶nizleme (preview) oynuyor. Tam aÃ§mak iÃ§in tÄ±klayÄ±n.`;
            }
        }

        function scheduleTrailersPreview(videoId, title) {
            if (trailersPreviewStartTimer) {
                clearTimeout(trailersPreviewStartTimer);
                trailersPreviewStartTimer = null;
            }
            trailersPreviewStartTimer = setTimeout(() => {
                playTrailersPreview(videoId, title);
            }, 120);
        }

        function renderSeriesList() {
            if (filteredSeriesData.length === 0) {
                seriesList.innerHTML = '';
                seriesEmpty.classList.remove('hidden');
                return;
            }

            seriesEmpty.classList.add('hidden');

            // Group series by name
            const groupedSeries = groupSeriesByName(filteredSeriesData);

            // Update grid view
        seriesList.className = layoutMode === 'masonry'
            ? `masonry masonry-${seriesView}-col`
            : `grid gap-6 grid-${seriesView}-col`;

            seriesList.innerHTML = groupedSeries.map(series => {
                // Get overall status based on all seasons
                const allSeasons = series.seasons;
                const totalEpisodes = allSeasons.reduce((sum, s) => sum + s.totalEpisodes, 0);
                const watchedEpisodes = allSeasons.reduce((sum, s) => sum + s.watchedEpisodes, 0);
                const progress = totalEpisodes > 0 ? (watchedEpisodes / totalEpisodes) * 100 : 0;
                const status = totalEpisodes > 0 && watchedEpisodes === totalEpisodes ? 'completed'
                    : watchedEpisodes > 0 ? 'watching'
                        : 'planning';

                // Kategori badge'leri
                const categoryBadges = series.categories && series.categories.length > 0
                    ? series.categories.map(catId => {
                        const category = categoriesData.find(c => c.id === catId);
                        if (category) {
                            return `<span class="category-badge" style="background-color: ${category.color}">${category.name}</span>`;
                        }
                        return '';
                    }).join('')
                    : '';

                // Etiketler
                const tags = series.tags && series.tags.length > 0
                    ? series.tags.map(tag => `<span class="tag">${tag}</span>`).join('')
                    : '';

                // Sezonlar
                const seasonsHtml = series.seasons.map(season => {
                    const seasonProgress = season.totalEpisodes > 0 ? (season.watchedEpisodes / season.totalEpisodes) * 100 : 0;
                    const seasonStatus = season.totalEpisodes > 0 && season.watchedEpisodes === season.totalEpisodes ? 'completed'
                        : season.watchedEpisodes > 0 ? 'watching'
                            : 'planning';

                    return `
                        <div class="season-item p-4 mb-2 bg-gray-50 dark:bg-gray-800 rounded-lg">
                            <div class="flex justify-between items-center cursor-pointer season-header" data-season="${season.season}">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-chevron-down season-toggle"></i>
                                    <span class="font-medium">Sezon ${season.season}</span>
                                    <span class="status-badge ${seasonStatus}">${getStatusText(seasonStatus)}</span>
                                </div>
                                <span>${season.watchedEpisodes}/${season.totalEpisodes}</span>
                            </div>
                            <div class="season-content">
                                <div class="content-inner">
                                    <div class="mb-2">
                                        <div class="flex justify-between text-sm mb-1">
                                            <span>Ä°zlenen BÃ¶lÃ¼m</span>
                                            <span>${Math.round(seasonProgress)}%</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill bg-gradient-to-r from-blue-500 to-purple-500" 
                                                 style="width: ${seasonProgress}%"></div>
                                        </div>
                                    </div>
                                    <div class="flex justify-end space-x-2 mt-4">
                                        <button class="btn btn-secondary btn-sm decrease-episode" data-id="${season.id}">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                        <button class="btn btn-primary btn-sm increase-episode" data-id="${season.id}">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                return `
        <div class="series-card card p-6 relative masonry-item">
        ${series.imageUrl ? `<div class="mb-4 ${posterAspect} poster-wrapper">
                            <span class="poster-badge status-badge ${status}">${getStatusText(status)}</span>
                            <img src="${series.imageUrl}" alt="${series.name}" class="w-full h-full object-cover" onerror="handleImageError(this)">
                            <div class="poster-overlay"></div>
                            <div class="poster-info"><span class="title">${series.name}</span>${series.imdbRating ? `<span class="meta"><i class="fas fa-star text-yellow-400"></i> ${series.imdbRating}</span>` : ''}</div>
                        </div>` : `<div class="mb-4 ${posterAspect} poster-wrapper flex items-center justify-center bg-slate-200 dark:bg-slate-700"><i class="fa-solid fa-image text-slate-500 dark:text-slate-300 text-3xl"></i></div>`}
                        <div class="mb-4">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center space-x-2">
        <h3 class="text-xl card-title">${series.name}</h3>
                                    ${series.trailerUrl ? `<button class="trailer-btn text-sm" data-trailer-url="${series.trailerUrl}" data-title="${series.name}">
                                        <i class="fab fa-youtube"></i> Fragman
                                    </button>` : ''}
                                </div>
                                <div class="flex space-x-1 ml-2">
                                    <button class="edit-icon text-blue-500 hover:text-blue-700" data-name="${series.name}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-icon text-red-500 hover:text-red-700" data-name="${series.name}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="text-gray-600 dark:text-gray-300 mb-2">
                                <span class="status-badge ${status}">${getStatusText(status)}</span>
                                <span class="ml-2">${series.platform}</span>
                                ${series.imdbRating ? `<span class="ml-2 text-yellow-500"><i class="fas fa-star"></i> ${series.imdbRating}</span>` : ''}
                            </div>
                            ${series.description ? `<p class="text-sm text-gray-600 dark:text-gray-400 mb-2 description-text">${series.description}</p>` : ''}
                        </div>

                        ${categoryBadges ? `<div class="mb-3">${categoryBadges}</div>` : ''}
                        ${tags ? `<div class="mb-3">${tags}</div>` : ''}
                        
                        ${series.releaseDate ? (() => {
                            const badgeInfo = getReleaseBadgeInfo(series.releaseDate);
                            return `<div class="mb-3">
                                <div class="release-badge ${badgeInfo.class}" title="${badgeInfo.fullText}">
                                    <i class="fas fa-calendar-alt"></i>
                                    ${badgeInfo.text}
                                </div>
                            </div>`;
                        })() : ''}

                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span>Toplam BÃ¶lÃ¼m: ${watchedEpisodes}/${totalEpisodes}</span>
                                <span>${Math.round(progress)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill bg-gradient-to-r from-blue-500 to-purple-500" style="width: ${progress}%"></div>
                            </div>
                        </div>

                        <div class="seasons-container">
                            ${seasonsHtml}
                        </div>
                    </div>
                `;
            }).join('');

            // Add event listeners
            // Add click event for season headers to toggle content
            document.querySelectorAll('.season-header').forEach(header => {
                header.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const content = this.closest('.season-item').querySelector('.season-content');
                    const toggle = this.querySelector('.season-toggle');

                    // Toggle the content
                    if (content.classList.contains('show')) {
                        content.classList.remove('show');
                        toggle.classList.remove('rotate');
                    } else {
                        content.classList.add('show');
                        toggle.classList.add('rotate');
                    }
                });
            });

            // Edit series event listener - Event delegation kullanarak
            // Bu event listener'lar sadece bir kez eklenir ve dinamik iÃ§erik iÃ§in Ã§alÄ±ÅŸÄ±r

            // Delete icon event listener da event delegation ile eklenecek

            document.querySelectorAll('.increase-episode').forEach(btn => {
                btn.addEventListener('click', function (event) {
                    event.stopPropagation();
                    const id = this.getAttribute('data-id');
                    const seasonItemData = seriesData.find(s => s.id == id);
                    if (seasonItemData && seasonItemData.watchedEpisodes < seasonItemData.totalEpisodes) {
                        seasonItemData.watchedEpisodes++;
                        seasonItemData.updatedAt = new Date().toISOString();
                        localStorage.setItem('seriesData', JSON.stringify(seriesData));

                        // Update the DOM in-place so open sections/modal are not affected
                        const seasonItem = this.closest('.season-item');
                        if (seasonItem) {
                            // Update header count (the second direct span child of .season-header)
                            const headerCount = seasonItem.querySelector('.season-header > span');
                            if (headerCount) headerCount.textContent = `${seasonItemData.watchedEpisodes}/${seasonItemData.totalEpisodes}`;

                            // Update season percentage text inside content
                            const percentText = seasonItem.querySelector('.content-inner .flex.justify-between span:last-child');
                            const pct = seasonItemData.totalEpisodes > 0 ? Math.round((seasonItemData.watchedEpisodes / seasonItemData.totalEpisodes) * 100) : 0;
                            if (percentText) percentText.textContent = `${pct}%`;

                            // Update progress bar fill for this season
                            const progressFill = seasonItem.querySelector('.progress-fill');
                            if (progressFill) progressFill.style.width = `${pct}%`;

                            // Update season status badge
                            const seasonStatus = seasonItemData.totalEpisodes > 0 && seasonItemData.watchedEpisodes === seasonItemData.totalEpisodes ? 'completed'
                                : seasonItemData.watchedEpisodes > 0 ? 'watching'
                                    : 'planning';
                            const statusBadge = seasonItem.querySelector('.status-badge');
                            if (statusBadge) {
                                statusBadge.className = `status-badge ${seasonStatus}`;
                                statusBadge.textContent = getStatusText(seasonStatus);
                            }
                        }

                        // Update overall series card totals and progress without full re-render
                        const card = this.closest('.series-card');
                        if (card) {
                            const seriesNameEl = card.querySelector('h3');
                            const seriesName = seriesNameEl ? seriesNameEl.textContent : null;
                            if (seriesName) {
                                const allSeasons = seriesData.filter(s => s.name === seriesName);
                                const totalEpisodes = allSeasons.reduce((sum, s) => sum + s.totalEpisodes, 0);
                                const watchedEpisodes = allSeasons.reduce((sum, s) => sum + s.watchedEpisodes, 0);
                                const overallPct = totalEpisodes > 0 ? Math.round((watchedEpisodes / totalEpisodes) * 100) : 0;

                                const totalSpan = card.querySelector('.mb-4 .flex.justify-between span');
                                if (totalSpan) totalSpan.textContent = `Toplam BÃ¶lÃ¼m: ${watchedEpisodes}/${totalEpisodes}`;

                                const overallPctSpan = card.querySelector('.mb-4 .flex.justify-between span:last-child');
                                if (overallPctSpan) overallPctSpan.textContent = `${overallPct}%`;

                                const overallFill = card.querySelector('.progress-bar .progress-fill');
                                if (overallFill) overallFill.style.width = `${overallPct}%`;
                            }
                        }
                    }
                });
            });
            document.querySelectorAll('.decrease-episode').forEach(btn => {
                btn.addEventListener('click', function (event) {
                    event.stopPropagation();
                    const id = this.getAttribute('data-id');
                    const seasonItemData = seriesData.find(s => s.id == id);
                    if (seasonItemData && seasonItemData.watchedEpisodes > 0) {
                        seasonItemData.watchedEpisodes--;
                        seasonItemData.updatedAt = new Date().toISOString();
                        localStorage.setItem('seriesData', JSON.stringify(seriesData));

                        // Update DOM in-place
                        const seasonItem = this.closest('.season-item');
                        if (seasonItem) {
                            const headerCount = seasonItem.querySelector('.season-header > span');
                            if (headerCount) headerCount.textContent = `${seasonItemData.watchedEpisodes}/${seasonItemData.totalEpisodes}`;

                            const pct = seasonItemData.totalEpisodes > 0 ? Math.round((seasonItemData.watchedEpisodes / seasonItemData.totalEpisodes) * 100) : 0;
                            const percentText = seasonItem.querySelector('.content-inner .flex.justify-between span:last-child');
                            if (percentText) percentText.textContent = `${pct}%`;

                            const progressFill = seasonItem.querySelector('.progress-fill');
                            if (progressFill) progressFill.style.width = `${pct}%`;

                            // Update season status badge
                            const seasonStatus = seasonItemData.totalEpisodes > 0 && seasonItemData.watchedEpisodes === seasonItemData.totalEpisodes ? 'completed'
                                : seasonItemData.watchedEpisodes > 0 ? 'watching'
                                    : 'planning';
                            const statusBadge = seasonItem.querySelector('.status-badge');
                            if (statusBadge) {
                                statusBadge.className = `status-badge ${seasonStatus}`;
                                statusBadge.textContent = getStatusText(seasonStatus);
                            }
                        }

                        // Update overall series card totals and progress
                        const card = this.closest('.series-card');
                        if (card) {
                            const seriesNameEl = card.querySelector('h3');
                            const seriesName = seriesNameEl ? seriesNameEl.textContent : null;
                            if (seriesName) {
                                const allSeasons = seriesData.filter(s => s.name === seriesName);
                                const totalEpisodes = allSeasons.reduce((sum, s) => sum + s.totalEpisodes, 0);
                                const watchedEpisodes = allSeasons.reduce((sum, s) => sum + s.watchedEpisodes, 0);
                                const overallPct = totalEpisodes > 0 ? Math.round((watchedEpisodes / totalEpisodes) * 100) : 0;

                                const totalSpan = card.querySelector('.mb-4 .flex.justify-between span');
                                if (totalSpan) totalSpan.textContent = `Toplam BÃ¶lÃ¼m: ${watchedEpisodes}/${totalEpisodes}`;

                                const overallPctSpan = card.querySelector('.mb-4 .flex.justify-between span:last-child');
                                if (overallPctSpan) overallPctSpan.textContent = `${overallPct}%`;

                                const overallFill = card.querySelector('.progress-bar .progress-fill');
                                if (overallFill) overallFill.style.width = `${overallPct}%`;
                            }
                        }
                    }
                });
            });

            // Setup image error handling after DOM update
            setTimeout(setupImageErrorHandling, 100);
        }

        // Render movies list
        function renderMoviesList() {
            if (filteredMoviesData.length === 0) {
                moviesList.innerHTML = '';
                moviesEmpty.classList.remove('hidden');
                return;
            }

            moviesEmpty.classList.add('hidden');

            // Update grid view
        moviesList.className = layoutMode === 'masonry'
            ? `masonry masonry-${moviesView}-col`
            : `grid gap-6 grid-${moviesView}-col`;

            moviesList.innerHTML = filteredMoviesData.map(movie => {
                // Kategori badge'leri
                const categoryBadges = movie.categories && movie.categories.length > 0
                    ? movie.categories.map(catId => {
                        const category = categoriesData.find(c => c.id === catId);
                        if (category) {
                            return `<span class="category-badge" style="background-color: ${category.color}">${category.name}</span>`;
                        }
                        return '';
                    }).join('')
                    : '';

                // Etiketler
                const tags = movie.tags && movie.tags.length > 0
                    ? movie.tags.map(tag => `<span class="tag">${tag}</span>`).join('')
                    : '';

                return `
        <div class="movie-card card p-6 relative masonry-item">
        ${movie.imageUrl ? `<div class="mb-4 ${posterAspect} poster-wrapper">
                            <span class="poster-badge status-badge ${movie.watched ? 'completed' : 'planning'}">${movie.watched ? 'Ä°zlendi' : 'Ä°zlenecek'}</span>
                            <img src="${movie.imageUrl}" alt="${movie.name}" class="w-full h-full object-cover" onerror="handleImageError(this)">
                            <div class="poster-overlay"></div>
                            <div class="poster-info"><span class="title">${movie.name}</span>${movie.imdbRating ? `<span class="meta"><i class="fas fa-star text-yellow-400"></i> ${movie.imdbRating}</span>` : ''}</div>
                        </div>` : `<div class="mb-4 ${posterAspect} poster-wrapper flex items-center justify-center bg-slate-200 dark:bg-slate-700"><i class="fa-solid fa-image text-slate-500 dark:text-slate-300 text-3xl"></i></div>`}
                        <div class="mb-4">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center space-x-2">
        <h3 class="text-xl card-title">${movie.name}</h3>
                                    ${movie.trailerUrl ? `<button class="trailer-btn text-sm" data-trailer-url="${movie.trailerUrl}" data-title="${movie.name}">
                                        <i class="fab fa-youtube"></i> Fragman
                                    </button>` : ''}
                                </div>
                                <div class="flex space-x-1 ml-2">
                                    <button class="edit-icon text-blue-500 hover:text-blue-700" data-id="${movie.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-icon text-red-500 hover:text-red-700" data-id="${movie.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="text-gray-600 dark:text-gray-300 mb-2">
                                <span class="status-badge ${movie.watched ? 'completed' : 'planning'}">${movie.watched ? 'Ä°zlendi' : 'Ä°zlenecek'}</span>
                                ${movie.imdbRating ? `<span class="ml-2 text-yellow-500"><i class="fas fa-star"></i> ${movie.imdbRating}</span>` : ''}
                            </div>
                            ${movie.description ? `<p class="text-sm text-gray-600 dark:text-gray-400 mb-2 description-text">${movie.description}</p>` : ''}
                        </div>
                        
                        ${categoryBadges ? `<div class="mb-3">${categoryBadges}</div>` : ''}
                        ${tags ? `<div class="mb-3">${tags}</div>` : ''}
                        
                        ${movie.releaseDate ? (() => {
                            const badgeInfo = getReleaseBadgeInfo(movie.releaseDate);
                            return `<div class="mb-3">
                                <div class="release-badge ${badgeInfo.class}" title="${badgeInfo.fullText}">
                                    <i class="fas fa-calendar-alt"></i>
                                    ${badgeInfo.text}
                                </div>
                            </div>`;
                        })() : ''}
                        
                        <div class="flex items-center mb-4">
                            <span class="watched-indicator ${movie.watched ? 'watched' : 'unwatched'}"></span>
                            <span class="text-sm">${movie.watched ? 'Ä°zlendi' : 'HenÃ¼z izlenmedi'}</span>
                        </div>
                        
                        <div class="text-sm text-gray-600 dark:text-gray-300">
                            <i class="fas fa-clock mr-1"></i> ${formatDate(movie.updatedAt)}
                        </div>
                    </div>
                `;
            }).join('');

            // Event listeners artÄ±k event delegation ile yÃ¶netiliyor
            
            // Setup image error handling after DOM update
            setTimeout(setupImageErrorHandling, 100);
        }

        // Render categories list
        function renderCategoriesList() {
            categoriesList.innerHTML = categoriesData.map(category => `
                <div class="card p-4 flex items-center justify-between category-card" data-id="${category.id}">
                    <div class="flex items-center">
                        <span class="w-4 h-4 rounded-full mr-3" style="background-color: ${category.color}"></span>
                        <span class="font-medium">${category.name}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button class="text-blue-600 hover:text-blue-800 edit-category" data-id="${category.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-500 hover:text-red-700 delete-category" data-id="${category.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');

            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-category').forEach(btn => {
                btn.addEventListener('click', function () {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteCategory(id);
                });
            });

            // Add event listeners for edit buttons
            document.querySelectorAll('.edit-category').forEach(btn => {
                btn.addEventListener('click', function () {
                    const id = parseInt(this.getAttribute('data-id'));
                    startEditCategory(id);
                });
            });
        }

        // Render tags list
        function renderTagsList() {
            const tagsList = document.getElementById('tagsList');
            if (!tagsList) return;

            // BirleÅŸtirilmiÅŸ etiket kÃ¼mesi: global tagsData + iÃ§eriklerdeki etiketler
            const suggestionSet = new Set();

            if (Array.isArray(tagsData) && tagsData.length > 0) {
                tagsData.forEach(t => {
                    if (t && typeof t.name === 'string' && t.name.trim() !== '') {
                        suggestionSet.add(t.name.trim());
                    }
                });
            }
            if (Array.isArray(seriesData) && seriesData.length > 0) {
                seriesData.forEach(s => {
                    if (s && Array.isArray(s.tags)) {
                        s.tags.forEach(tag => {
                            if (typeof tag === 'string' && tag.trim() !== '') {
                                suggestionSet.add(tag.trim());
                            }
                        });
                    }
                });
            }
            if (Array.isArray(moviesData) && moviesData.length > 0) {
                moviesData.forEach(m => {
                    if (m && Array.isArray(m.tags)) {
                        m.tags.forEach(tag => {
                            if (typeof tag === 'string' && tag.trim() !== '') {
                                suggestionSet.add(tag.trim());
                            }
                        });
                    }
                });
            }

            tagsList.innerHTML = Array.from(suggestionSet)
                .sort((a, b) => a.localeCompare(b, 'tr'))
                .map(name => {
                    const tagObj = tagsData.find(t => t && t.name === name);
                    const idAttr = tagObj ? `data-id="${tagObj.id}"` : '';
                    const deleteBtn = tagObj ? `
                        <button class="text-red-500 hover:text-red-700 delete-tag" data-id="${tagObj.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    ` : '';
                    return `
                        <div class="card p-4 flex items-center justify-between">
                            <span class="font-medium">${name}</span>
                            <div class="flex items-center gap-3">
                                <button class="text-blue-600 hover:text-blue-800 edit-tag" ${idAttr} data-name="${name}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                ${deleteBtn}
                            </div>
                        </div>
                    `;
                }).join('');

            // Edit ve delete eventleri
            document.querySelectorAll('.edit-tag').forEach(btn => {
                btn.addEventListener('click', function () {
                    const oldName = this.getAttribute('data-name');
                    const idVal = this.getAttribute('data-id');
                    const newName = prompt('Yeni etiket adÄ±:', oldName);
                    if (newName === null) return;
                    const trimmed = newName.trim();
                    if (!trimmed) { alert('Etiket adÄ± boÅŸ olamaz.'); return; }
                    if (trimmed === oldName) return;

                    if (idVal) {
                        editTag(parseInt(idVal, 10), oldName, trimmed);
                    } else {
                        editTagByName(oldName, trimmed);
                    }
                });
            });

            document.querySelectorAll('.delete-tag').forEach(btn => {
                btn.addEventListener('click', function () {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteTag(id);
                });
            });
        }

        // Etiket dÃ¼zenle (ID ile)
        function editTag(id, oldName, newName) {
            const idx = tagsData.findIndex(t => t.id === id);
            if (idx === -1) return;

            const duplicate = tagsData.find(t => t.name === newName && t.id !== id);
            if (duplicate) {
                const proceed = confirm('AynÄ± isimde baÅŸka bir etiket var. BirleÅŸtirilsin mi?');
                if (!proceed) return;
                // Eski kayÄ±t silinir, yeni isim zaten mevcut
                tagsData.splice(idx, 1);
            } else {
                tagsData[idx].name = newName;
            }

            renameTagInCollections(oldName, newName);

            localStorage.setItem('tagsData', JSON.stringify(tagsData));
            localStorage.setItem('seriesData', JSON.stringify(seriesData));
            localStorage.setItem('moviesData', JSON.stringify(moviesData));

            renderTagsList();
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');
            updateSeriesTagCloud();
            updateMoviesTagCloud();
            filterSeries();
            filterMovies();
        }

        // Etiket dÃ¼zenle (sadece isim ile - global liste yoksa)
        function editTagByName(oldName, newName) {
            const found = tagsData.find(t => t.name === oldName);
            const duplicate = tagsData.find(t => t.name === newName);

            if (found) {
                if (!duplicate || duplicate.id === found.id) {
                    found.name = newName;
                } else {
                    // Duplicate mevcutsa, eskiyi kaldÄ±r
                    tagsData = tagsData.filter(t => t.id !== found.id);
                }
            } else {
                if (!duplicate) {
                    const newId = tagsData.length > 0 ? Math.max(...tagsData.map(t => t.id)) + 1 : 1;
                    tagsData.push({ id: newId, name: newName });
                }
            }

            renameTagInCollections(oldName, newName);

            localStorage.setItem('tagsData', JSON.stringify(tagsData));
            localStorage.setItem('seriesData', JSON.stringify(seriesData));
            localStorage.setItem('moviesData', JSON.stringify(moviesData));

            renderTagsList();
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');
            updateSeriesTagCloud();
            updateMoviesTagCloud();
            filterSeries();
            filterMovies();
        }

        // Koleksiyonlarda etiket adÄ±nÄ± deÄŸiÅŸtir
        function renameTagInCollections(oldName, newName) {
            seriesData.forEach(s => {
                if (Array.isArray(s.tags)) {
                    s.tags = s.tags.map(tag => tag === oldName ? newName : tag);
                    s.tags = Array.from(new Set(s.tags));
                }
            });
            moviesData.forEach(m => {
                if (Array.isArray(m.tags)) {
                    m.tags = m.tags.map(tag => tag === oldName ? newName : tag);
                    m.tags = Array.from(new Set(m.tags));
                }
            });
        }

        // TÃ¼m mevcut etiketleri global etiketlere dÃ¶nÃ¼ÅŸtÃ¼r
        function promoteAllTags() {
            const namesSet = new Set();
            // Global tags
            if (Array.isArray(tagsData)) {
                tagsData.forEach(t => {
                    if (t && typeof t.name === 'string') {
                        const n = t.name.trim();
                        if (n) namesSet.add(n);
                    }
                });
            }
            // Series tags
            if (Array.isArray(seriesData)) {
                seriesData.forEach(s => {
                    if (Array.isArray(s.tags)) {
                        s.tags.forEach(tag => {
                            if (typeof tag === 'string') {
                                const n = tag.trim();
                                if (n) namesSet.add(n);
                            }
                        });
                    }
                });
            }
            // Movies tags
            if (Array.isArray(moviesData)) {
                moviesData.forEach(m => {
                    if (Array.isArray(m.tags)) {
                        m.tags.forEach(tag => {
                            if (typeof tag === 'string') {
                                const n = tag.trim();
                                if (n) namesSet.add(n);
                            }
                        });
                    }
                });
            }

            const existingNames = new Set(Array.isArray(tagsData) ? tagsData.map(t => t.name) : []);
            let maxId = (Array.isArray(tagsData) && tagsData.length > 0) ? Math.max(...tagsData.map(t => t.id)) : 0;
            let addedCount = 0;

            Array.from(namesSet).sort((a, b) => a.localeCompare(b, 'tr')).forEach(name => {
                if (!existingNames.has(name)) {
                    maxId += 1;
                    tagsData.push({ id: maxId, name });
                    addedCount++;
                }
            });

            localStorage.setItem('tagsData', JSON.stringify(tagsData));

            renderTagsList();
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');
            updateSeriesTagCloud();
            updateMoviesTagCloud();
            filterSeries();
            filterMovies();

            alert(addedCount > 0 ? ('TÃ¼m etiketler global hale getirildi (' + addedCount + ' yeni).') : 'TÃ¼m etiketler zaten global.');
        }

        // Update series category selector
        function updateSeriesCategorySelector() {
            const selector = document.getElementById('seriesCategorySelector');
            selector.innerHTML = categoriesData.map(category => `
                <div class="category-option" data-id="${category.id}" style="background-color: ${category.color}; color: white;">
                    ${category.name}
                </div>
            `).join('');

            // Add event listeners
            document.querySelectorAll('#seriesCategorySelector .category-option').forEach(option => {
                option.addEventListener('click', function () {
                    this.classList.toggle('selected');
                });
            });
        }

        // Update movie category selector
        function updateMovieCategorySelector() {
            const selector = document.getElementById('movieCategorySelector');
            selector.innerHTML = categoriesData.map(category => `
                <div class="category-option" data-id="${category.id}" style="background-color: ${category.color}; color: white;">
                    ${category.name}
                </div>
            `).join('');

            // Add event listeners
            document.querySelectorAll('#movieCategorySelector .category-option').forEach(option => {
                option.addEventListener('click', function () {
                    this.classList.toggle('selected');
                });
            });
        }

        // Update series tag cloud
        function updateSeriesTagCloud() {
            const allTags = new Set();
            seriesData.forEach(series => {
                if (series.tags && series.tags.length > 0) {
                    series.tags.forEach(tag => allTags.add(tag));
                }
            });

            if (allTags.size > 0) {
                seriesTagCloud.classList.remove('hidden'); // Ensure visibility
                seriesTagCloud.style.display = 'flex'; // Explicitly set display
                seriesTagCloud.innerHTML = Array.from(allTags).map(tag =>
                    `<span class="tag" data-tag="${tag}">${tag}</span>`
                ).join('');

                // Add event listeners
                document.querySelectorAll('#seriesTagCloud .tag').forEach(tagEl => {
                    tagEl.addEventListener('click', function () {
                        const tag = this.getAttribute('data-tag');
                        searchSeries.value = tag;
                        filterSeries();
                    });
                });
            } else {
                seriesTagCloud.classList.add('hidden');
                seriesTagCloud.style.display = 'none'; // Ensure hidden state
            }
        }

        // Update movies tag cloud
        function updateMoviesTagCloud() {
            const allTags = new Set();
            moviesData.forEach(movie => {
                if (movie.tags && movie.tags.length > 0) {
                    movie.tags.forEach(tag => allTags.add(tag));
                }
            });

            if (allTags.size > 0) {
                moviesTagCloud.classList.remove('hidden'); // Ensure visibility
                moviesTagCloud.style.display = 'flex'; // Explicitly set display
                moviesTagCloud.innerHTML = Array.from(allTags).map(tag =>
                    `<span class="tag" data-tag="${tag}">${tag}</span>`
                ).join('');

                // Add event listeners
                document.querySelectorAll('#moviesTagCloud .tag').forEach(tagEl => {
                    tagEl.addEventListener('click', function () {
                        const tag = this.getAttribute('data-tag');
                        searchMovies.value = tag;
                        filterMovies();
                    });
                });
            } else {
                moviesTagCloud.classList.add('hidden');
                moviesTagCloud.style.display = 'none'; // Ensure hidden state
            }
        }

        // Get series status
        function getSeriesStatus(series) {
            if (series.totalEpisodes > 0 && series.watchedEpisodes === series.totalEpisodes) {
                return 'completed';
            } else if (series.watchedEpisodes > 0) {
                return 'watching';
            } else {
                return 'planning';
            }
        }

        // Get status text
        function getStatusText(status) {
            switch (status) {
                case 'completed': return 'TamamlandÄ±';
                case 'watching': return 'Ä°zleniyor';
                case 'planning': return 'PlanlanÄ±yor';
                case 'paused': return 'DuraklatÄ±ldÄ±';
                default: return '';
            }
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // Release date utility functions
        function formatReleaseDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const months = [
                'Ocak', 'Åžubat', 'Mart', 'Nisan', 'MayÄ±s', 'Haziran',
                'Temmuz', 'AÄŸustos', 'EylÃ¼l', 'Ekim', 'KasÄ±m', 'AralÄ±k'
            ];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
        }

        function getDaysUntilRelease(dateString) {
            if (!dateString) return null;
            const releaseDate = new Date(dateString);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            releaseDate.setHours(0, 0, 0, 0);
            const diffTime = releaseDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        function getReleaseBadgeInfo(releaseDate) {
            if (!releaseDate) return null;
            
            const daysUntil = getDaysUntilRelease(releaseDate);
            const formattedDate = formatReleaseDate(releaseDate);
            
            if (daysUntil < 0) {
                return {
                    text: 'YayÄ±nda',
                    class: 'release-badge-live',
                    fullText: formattedDate
                };
            } else if (daysUntil === 0) {
                return {
                    text: 'BugÃ¼n Ã‡Ä±kÄ±yor',
                    class: 'release-badge-today',
                    fullText: formattedDate
                };
            } else if (daysUntil === 1) {
                return {
                    text: '1 gÃ¼n kaldÄ±',
                    class: 'release-badge-soon',
                    fullText: formattedDate
                };
            } else if (daysUntil <= 7) {
                return {
                    text: `${daysUntil} gÃ¼n kaldÄ±`,
                    class: 'release-badge-soon',
                    fullText: formattedDate
                };
            } else if (daysUntil <= 30) {
                return {
                    text: `${daysUntil} gÃ¼n kaldÄ±`,
                    class: 'release-badge-upcoming',
                    fullText: formattedDate
                };
            } else {
                return {
                    text: formattedDate,
                    class: 'release-badge-far',
                    fullText: `${daysUntil} gÃ¼n kaldÄ±`
                };
            }
        }

        

        // YouTube URL'den video ID'sini Ã§Ä±kar (tek tanÄ±m)
        function extractYouTubeVideoId(url) {
            if (!url || typeof url !== 'string') return null;
            url = url.trim();
            if (url.length === 11 && /^[a-zA-Z0-9_-]+$/.test(url)) {
                return url;
            }
            const patterns = [
                /(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})/,
                /(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?.*[&?]v=([a-zA-Z0-9_-]{11})/,
                /(?:https?:\/\/)?(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]{11})/,
                /(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,
                /(?:https?:\/\/)?(?:www\.)?youtube\.com\/v\/([a-zA-Z0-9_-]{11})/,
                /(?:https?:\/\/)?(?:www\.)?youtube-nocookie\.com\/embed\/([a-zA-Z0-9_-]{11})/
            ];
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) {
                    return match[1];
                }
            }
            return null;
        }

        function openYouTubeInNewTab(url) {
            if (!url) return;
            try {
                window.open(url, '_blank', 'noopener');
            } catch (_) {}
        }

        function getYouTubePlayerErrorText(code) {
            const c = Number(code);
            if (!Number.isFinite(c)) return 'YouTube oynatÄ±cÄ± hata verdi.';
            if (c === 2) return `GeÃ§ersiz video kimliÄŸi (invalid video id). (Hata ${c})`;
            if (c === 5) return `HTML5 oynatÄ±cÄ± hatasÄ± (HTML5 player error). (Hata ${c})`;
            if (c === 100) return `Video bulunamadÄ± veya gizli (not found / private). (Hata ${c})`;
            if (c === 101 || c === 150 || c === 153) return `Bu video gÃ¶mÃ¼lÃ¼ oynatmaya izin vermiyor (embedding disabled). (Hata ${c})`;
            return `YouTube oynatÄ±cÄ± hatasÄ±. (Hata ${c})`;
        }

        function resetTrailerPlayerState() {
            trailerHasStarted = false;
            if (trailerStartTimeout) {
                clearTimeout(trailerStartTimeout);
                trailerStartTimeout = null;
            }
            
            // Iframe'i temizle
            const playerContainer = document.getElementById('trailerPlayer');
            if (playerContainer) {
                playerContainer.innerHTML = '';
            }
            trailerPlayer = null;
        }

        // YouTube fragman modal'Ä±nÄ± gÃ¶ster
        function showTrailerModal(videoUrl, title) {
            const videoId = extractYouTubeVideoId(videoUrl);
            if (!videoId) {
                alert('GeÃ§erli bir YouTube URL\'si veya video ID\'si giriniz.');
                return;
            }

            resetTrailerPlayerState();

            const isFileProtocol = window.location.protocol === 'file:';
            const watchUrl = 'https://www.youtube.com/embed/' + videoId;
            const iframeMarkup = `
                <iframe width="560" height="315" src="${watchUrl}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
            `;

            const modal = document.createElement('div');
            modal.className = 'modal trailer-modal active';
            modal.style.display = 'flex';

            const initialInfoText = isFileProtocol
                ? 'Bu sayfa tarayÄ±cÄ±da dosya (file://) olarak aÃ§Ä±lÄ±yor. BazÄ± tarayÄ±cÄ±larda YouTube oynatÄ±cÄ± burada Ã§alÄ±ÅŸmayabilir. Video baÅŸlamazsa veya hata alÄ±rsanÄ±z aÅŸaÄŸÄ±daki buton ile fragmanÄ± YouTube\'da aÃ§abilirsiniz.'
                : 'Video birkaÃ§ saniye iÃ§inde baÅŸlamazsa aÅŸaÄŸÄ±daki buton ile fragmanÄ± YouTube\'da aÃ§abilirsiniz.';

            modal.innerHTML = `
                <div class="trailer-modal-content">
                    <div class="modal-header">
                        <h3>${title} - Fragman</h3>
                        <div class="flex items-center gap-2">
                            <a href="${watchUrl}" target="_blank" rel="noopener" class="trailer-btn" style="text-decoration: none;">
                                <i class="fab fa-youtube mr-1"></i> YouTube'da aÃ§
                            </a>
                            <button class="close-trailer-btn">&times;</button>
                        </div>
                    </div>
                    <div class="trailer-container">
                        <div id="trailerPlayer"></div>
                    </div>
                    <div class="trailer-info">${initialInfoText}</div>
                </div>
            `;

            document.body.appendChild(modal);

            const infoEl = modal.querySelector('.trailer-info');

            const closeBtn = modal.querySelector('.close-trailer-btn');
            closeBtn.addEventListener('click', () => {
                resetTrailerPlayerState();
                document.body.removeChild(modal);
            });
            
            modal.addEventListener('click', e => {
                if (e.target === modal) {
                    resetTrailerPlayerState();
                    document.body.removeChild(modal);
                }
            });

            const playerContainer = modal.querySelector('#trailerPlayer');
            if (!playerContainer) {
                return;
            }

            // Iframe oluÅŸtur
            const iframe = document.createElement('iframe');
            iframe.width = "100%";
            iframe.height = "100%";
            
            // Embed URL (Modal iÃ§in)
            // autoplay=1: Otomatik baÅŸlat
            // mute=0: Sesli (Modal olduÄŸu iÃ§in kullanÄ±cÄ± sesi bekler)
            // controls=1: KontrollÃ¼
            const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0&controls=1&rel=0&modestbranding=1&playsinline=1`;

            iframe.src = embedUrl;
            iframe.title = "YouTube video player";
            iframe.frameBorder = "0";
            iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
            iframe.referrerPolicy = "strict-origin-when-cross-origin";
            iframe.allowFullscreen = true;
            
            playerContainer.appendChild(iframe);
            trailerPlayer = iframe;

            // Info text update (iframe yÃ¼klendi varsayÄ±mÄ± ile)
            if (infoEl && !isFileProtocol) {
                setTimeout(() => {
                    infoEl.textContent = '';
                }, 3000);
            }
        }

        // Filter series
        function filterSeries() {
            const searchTerm = searchSeries.value.toLowerCase();

            filteredSeriesData = seriesData.filter(series => {
                // Arama terimi ile filtreleme
                const matchesSearch = series.name.toLowerCase().includes(searchTerm) ||
                    (series.tags && series.tags.some(tag => tag.toLowerCase().includes(searchTerm)));

                // Durum ile filtreleme
                let matchesFilter = true;
                if (currentSeriesFilter !== 'all') {
                    const status = getSeriesStatus(series);
                    matchesFilter = status === currentSeriesFilter;
                }
                // Category filter
                if (currentSeriesCategory) {
                    matchesFilter = matchesFilter && (series.categories && series.categories.includes(currentSeriesCategory));
                }

                return matchesSearch && matchesFilter;
            });

            // Mevcut seÃ§ime gÃ¶re sÄ±ralamayÄ± uygula
            const seriesSortSelect = document.getElementById('seriesSortSelect');
            if (seriesSortSelect) {
                sortSeries(seriesSortSelect.value);
            } else {
                renderSeriesList();
            }
        }

        // Filter movies
        function filterMovies() {
            const searchTerm = searchMovies.value.toLowerCase();

            filteredMoviesData = moviesData.filter(movie => {
                // Arama terimi ile filtreleme
                const matchesSearch = movie.name.toLowerCase().includes(searchTerm) ||
                    (movie.tags && movie.tags.some(tag => tag.toLowerCase().includes(searchTerm)));

                // Durum ile filtreleme
                let matchesFilter = true;
                if (currentMoviesFilter !== 'all') {
                    if (currentMoviesFilter === 'watched') {
                        matchesFilter = movie.watched;
                    } else if (currentMoviesFilter === 'not-watched') {
                        matchesFilter = !movie.watched;
                    }
                }
                // Category filter for movies
                if (currentMoviesCategory) {
                    matchesFilter = matchesFilter && (movie.categories && movie.categories.includes(currentMoviesCategory));
                }

                return matchesSearch && matchesFilter;
            });

            // Mevcut seÃ§ime gÃ¶re sÄ±ralamayÄ± uygula
            const moviesSortSelect = document.getElementById('moviesSortSelect');
            if (moviesSortSelect) {
                sortMovies(moviesSortSelect.value);
            } else {
                renderMoviesList();
            }
        }

        // Add new series
        function addSeries() {
            document.getElementById('seriesModalTitle').textContent = 'Dizi Ekle';
            document.getElementById('seriesId').value = '';
            document.getElementById('seriesName').value = '';
            document.getElementById('seriesPlatform').value = 'Netflix';

            // Reset kategori seÃ§imi
            document.querySelectorAll('#seriesCategorySelector .category-option').forEach(option => {
                option.classList.remove('selected');
            });

            // Reset etiketler
            document.getElementById('seriesTagsContainer').innerHTML = '<input type="text" id="seriesTagsInput" class="tag-input" placeholder="Etiket ekle ve Enter\'a bas">';
            initTagInput('seriesTagsInput', 'seriesTagsContainer');
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');

            // Sezon formunu temizle ve ilk sezonu ekle
            document.getElementById('seasonsContainer').innerHTML = '';
            seasonCounter = 0;
            addSeasonForm();

            seriesModal.classList.add('active');
        }

        // Edit series
        function editSeries(id) {
            const series = seriesData.find(s => s.id == id);
            if (!series) return;

            // AynÄ± isimli tÃ¼m sezonlarÄ± bul
            const allSeasons = seriesData.filter(s => s.name === series.name);

            document.getElementById('seriesModalTitle').textContent = 'Diziyi DÃ¼zenle';
            document.getElementById('seriesId').value = series.id;
            document.getElementById('seriesName').value = series.name;
            document.getElementById('seriesPlatform').value = series.platform;
            document.getElementById('seriesTrailerUrl').value = series.trailerUrl || '';
            document.getElementById('seriesImdbRating').value = series.imdbRating || '';
            document.getElementById('seriesDescription').value = series.description || '';
            document.getElementById('seriesImageUrl').value = series.imageUrl || '';
            document.getElementById('seriesReleaseDate').value = series.releaseDate || '';

            // Kategori seÃ§imini ayarla
            document.querySelectorAll('#seriesCategorySelector .category-option').forEach(option => {
                const catId = parseInt(option.getAttribute('data-id'));
                if (series.categories && series.categories.includes(catId)) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });

            // Etiketleri ayarla
            const tagsContainer = document.getElementById('seriesTagsContainer');
            tagsContainer.innerHTML = '';
            if (series.tags && series.tags.length > 0) {
                series.tags.forEach(tag => {
                    const tagEl = createTagElement(tag, tagsContainer, false);
                    tagsContainer.appendChild(tagEl);
                });
            }
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'seriesTagsInput';
            input.className = 'tag-input';
            input.placeholder = 'Etiket ekle ve Enter\'a bas';
            tagsContainer.appendChild(input);
            initTagInput('seriesTagsInput', 'seriesTagsContainer');
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');

            // Sezon seÃ§icisini doldur
            loadSeasonsToSelector(allSeasons, series.id);

            seriesModal.classList.add('active');
        }

        // Delete series
        function deleteSeries(id) {
            if (confirm('Bu diziyi silmek istediÄŸinize emin misiniz?')) {
                seriesData = seriesData.filter(s => s.id != id);
                localStorage.setItem('seriesData', JSON.stringify(seriesData));
                filterSeries();
                renderCategoryFilters();
                updateTotalStats();
                updateSeriesTagCloud();
            }
        }

        // Increase episode
        function increaseEpisode(id) {
            const series = seriesData.find(s => s.id == id);
            if (series && series.watchedEpisodes < series.totalEpisodes) {
                series.watchedEpisodes++;
                series.updatedAt = new Date().toISOString();
                localStorage.setItem('seriesData', JSON.stringify(seriesData));
                filterSeries();
            }
        }

        // Decrease episode
        function decreaseEpisode(id) {
            const series = seriesData.find(s => s.id == id);
            if (series && series.watchedEpisodes > 0) {
                series.watchedEpisodes--;
                series.updatedAt = new Date().toISOString();
                localStorage.setItem('seriesData', JSON.stringify(seriesData));
                filterSeries();
            }
        }

        // Add new movie
        function addMovie() {
            document.getElementById('movieModalTitle').textContent = 'Film Ekle';
            document.getElementById('movieId').value = '';
            document.getElementById('movieName').value = '';
            document.getElementById('movieWatched').checked = false;

            // Reset kategori seÃ§imi
            document.querySelectorAll('#movieCategorySelector .category-option').forEach(option => {
                option.classList.remove('selected');
            });

            // Reset etiketler
            document.getElementById('movieTagsContainer').innerHTML = '<input type="text" id="movieTagsInput" class="tag-input" placeholder="Etiket ekle ve Enter\'a bas">';
            initTagInput('movieTagsInput', 'movieTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');

            movieModal.classList.add('active');
        }

        // Edit movie
        function editMovie(id) {
            const movie = moviesData.find(m => m.id == id);
            if (!movie) return;

            document.getElementById('movieModalTitle').textContent = 'Filmi DÃ¼zenle';
            document.getElementById('movieId').value = movie.id;
            document.getElementById('movieName').value = movie.name;
            document.getElementById('movieWatched').checked = movie.watched;
            document.getElementById('movieTrailerUrl').value = movie.trailerUrl || '';
            document.getElementById('movieImdbRating').value = movie.imdbRating || '';
            document.getElementById('movieDescription').value = movie.description || '';
            document.getElementById('movieImageUrl').value = movie.imageUrl || '';
            document.getElementById('movieReleaseDate').value = movie.releaseDate || '';

            // Kategori seÃ§imini ayarla
            document.querySelectorAll('#movieCategorySelector .category-option').forEach(option => {
                const catId = parseInt(option.getAttribute('data-id'));
                if (movie.categories && movie.categories.includes(catId)) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });

            // Etiketleri ayarla
            const tagsContainer = document.getElementById('movieTagsContainer');
            tagsContainer.innerHTML = '';
            if (movie.tags && movie.tags.length > 0) {
                movie.tags.forEach(tag => {
                    const tagEl = createTagElement(tag, tagsContainer, false);
                    tagsContainer.appendChild(tagEl);
                });
            }
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'movieTagsInput';
            input.className = 'tag-input';
            input.placeholder = 'Etiket ekle ve Enter\'a bas';
            tagsContainer.appendChild(input);
            initTagInput('movieTagsInput', 'movieTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');

            movieModal.classList.add('active');
        }

        // Delete movie
        function deleteMovie(id) {
            if (confirm('Bu filmi silmek istediÄŸinize emin misiniz?')) {
                moviesData = moviesData.filter(m => m.id != id);
                localStorage.setItem('moviesData', JSON.stringify(moviesData));
                filterMovies();
                renderCategoryFilters();
                updateTotalStats();
                updateMoviesTagCloud();
            }
        }

        // Add new category
        function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            const color = document.getElementById('newCategoryColor').value;

            if (!name) {
                alert('LÃ¼tfen bir kategori adÄ± girin.');
                return;
            }

            const newId = categoriesData.length > 0 ? Math.max(...categoriesData.map(c => c.id)) + 1 : 1;
            categoriesData.push({
                id: newId,
                name: name,
                color: color
            });

            localStorage.setItem('categoriesData', JSON.stringify(categoriesData));

            // Reset form
            document.getElementById('newCategoryName').value = '';
            document.getElementById('newCategoryColor').value = '#6366f1';

            // Update UI
            renderCategoriesList();
            updateSeriesCategorySelector();
            updateMovieCategorySelector();
            renderCategoryFilters();
        }

        // Edit category (name and color)
        function editCategory(id) {
            const category = categoriesData.find(c => c.id === id);
            if (!category) {
                alert('Kategori bulunamadÄ±.');
                return;
            }

            const newName = prompt('Yeni kategori adÄ±nÄ± girin:', category.name);
            if (newName === null) return; // KullanÄ±cÄ± iptal etti
            const trimmedName = newName.trim();
            if (!trimmedName) {
                alert('Kategori adÄ± boÅŸ olamaz.');
                return;
            }

            const newColor = prompt('Yeni kategori rengini girin (#RRGGBB):', category.color);
            if (newColor === null) return; // KullanÄ±cÄ± iptal etti
            const colorTrimmed = newColor.trim();
            const hexRegex = /^#([0-9A-Fa-f]{6})$/;
            if (!hexRegex.test(colorTrimmed)) {
                alert('LÃ¼tfen #RRGGBB formatÄ±nda geÃ§erli bir renk girin.');
                return;
            }

            category.name = trimmedName;
            category.color = colorTrimmed;

            localStorage.setItem('categoriesData', JSON.stringify(categoriesData));

            // UI ve baÄŸlÄ± bileÅŸenleri gÃ¼ncelle
            renderCategoriesList();
            updateSeriesCategorySelector();
            updateMovieCategorySelector();
            renderCategoryFilters();
            // Ä°Ã§erik kartlarÄ±ndaki rozetleri gÃ¼ncellemek iÃ§in listeleri yeniden Ã§iz
            if (typeof renderSeriesList === 'function') renderSeriesList();
            if (typeof renderMoviesList === 'function') renderMoviesList();
        }

        // Inline edit: start and save functions
        function startEditCategory(id) {
            const category = categoriesData.find(c => c.id === id);
            const card = document.querySelector(`#categoriesList .category-card[data-id="${id}"]`);
            if (!category || !card) return;

            card.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full">
                    <div class="form-group">
                        <label for="editCategoryName_${id}">Kategori AdÄ±</label>
                        <input type="text" id="editCategoryName_${id}" class="form-control" value="${category.name}" placeholder="Kategori adÄ±">
                    </div>
                    <div class="form-group">
                        <label for="editCategoryColor_${id}">Renk</label>
                        <input type="color" id="editCategoryColor_${id}" class="form-control color-picker" value="${category.color}">
                    </div>
                    <div class="form-group flex items-end gap-2">
                        <button class="btn btn-primary save-category" data-id="${id}">
                            <i class="fas fa-save mr-2"></i> Kaydet
                        </button>
                        <button class="btn btn-secondary cancel-category" data-id="${id}">Ä°ptal</button>
                    </div>
                </div>
            `;

            const saveBtn = card.querySelector('.save-category');
            const cancelBtn = card.querySelector('.cancel-category');
            if (saveBtn) {
                saveBtn.addEventListener('click', function () {
                    const id = parseInt(this.getAttribute('data-id'));
                    saveCategoryEdit(id);
                });
            }
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function () {
                    renderCategoriesList();
                });
            }
        }

        function saveCategoryEdit(id) {
            const nameInput = document.getElementById(`editCategoryName_${id}`);
            const colorInput = document.getElementById(`editCategoryColor_${id}`);
            const name = nameInput ? nameInput.value.trim() : '';
            const color = colorInput ? colorInput.value : '';

            if (!name) {
                alert('Kategori adÄ± boÅŸ olamaz.');
                return;
            }

            const hexRegex = /^#([0-9A-Fa-f]{6})$/;
            if (!hexRegex.test(color)) {
                alert('LÃ¼tfen #RRGGBB formatÄ±nda geÃ§erli bir renk girin.');
                return;
            }

            const category = categoriesData.find(c => c.id === id);
            if (!category) {
                alert('Kategori bulunamadÄ±.');
                return;
            }

            category.name = name;
            category.color = color;

            localStorage.setItem('categoriesData', JSON.stringify(categoriesData));

            // UI gÃ¼ncellemeleri
            renderCategoriesList();
            updateSeriesCategorySelector();
            updateMovieCategorySelector();
            renderCategoryFilters();
            if (typeof renderSeriesList === 'function') renderSeriesList();
            if (typeof renderMoviesList === 'function') renderMoviesList();
        }

        // Delete category
        function deleteCategory(id) {
            if (confirm('Bu kategoriyi silmek istediÄŸinize emin misiniz? Bu kategoriye sahip tÃ¼m iÃ§eriklerden bu kategori kaldÄ±rÄ±lacak.')) {
                // Kategoriyi iÃ§eriklerden kaldÄ±r
                seriesData.forEach(series => {
                    if (series.categories) {
                        series.categories = series.categories.filter(catId => catId !== id);
                    }
                });

                moviesData.forEach(movie => {
                    if (movie.categories) {
                        movie.categories = movie.categories.filter(catId => catId !== id);
                    }
                });

                // Kategoriyi sil
                categoriesData = categoriesData.filter(c => c.id !== id);

                // LocalStorage'Ä± gÃ¼ncelle
                localStorage.setItem('seriesData', JSON.stringify(seriesData));
                localStorage.setItem('moviesData', JSON.stringify(moviesData));
                localStorage.setItem('categoriesData', JSON.stringify(categoriesData));

                // UI'Ä± gÃ¼ncelle
                renderSeriesList();
                renderMoviesList();
                renderCategoriesList();
                updateSeriesCategorySelector();
                updateMovieCategorySelector();
                renderCategoryFilters();
            }
        }

        // Add new tag
        function addTag() {
            const name = document.getElementById('newTagName').value.trim();

            if (!name) {
                alert('LÃ¼tfen bir etiket adÄ± girin.');
                return;
            }

            const newId = tagsData.length > 0 ? Math.max(...tagsData.map(t => t.id)) + 1 : 1;
            tagsData.push({
                id: newId,
                name: name
            });

            localStorage.setItem('tagsData', JSON.stringify(tagsData));

            // Reset form
            document.getElementById('newTagName').value = '';

            // Update UI
            renderTagsList();
            // Refresh suggestion chips in modals
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');
        }

        // Delete tag (remove from global and all series/movies)
        function deleteTag(id) {
            const tagObj = tagsData.find(t => t.id === id);
            const tagName = tagObj ? tagObj.name : null;
            if (!tagName) {
                if (!confirm('Global listede bulunamadÄ±. Yine de tÃ¼m iÃ§erikten silinsin mi?')) return;
            } else {
                if (!confirm('Bu etiket global listeden ve tÃ¼m dizi/film iÃ§eriklerinden silinecek. Emin misiniz?')) return;
            }

            // Remove from global list
            tagsData = tagsData.filter(t => t.id !== id);

            // Remove from series and movies
            if (tagName) {
                if (Array.isArray(seriesData)) {
                    seriesData.forEach(s => {
                        if (Array.isArray(s.tags)) {
                            s.tags = s.tags.filter(tag => tag !== tagName);
                        }
                    });
                }
                if (Array.isArray(moviesData)) {
                    moviesData.forEach(m => {
                        if (Array.isArray(m.tags)) {
                            m.tags = m.tags.filter(tag => tag !== tagName);
                        }
                    });
                }
            }

            // Persist
            localStorage.setItem('tagsData', JSON.stringify(tagsData));
            localStorage.setItem('seriesData', JSON.stringify(seriesData));
            localStorage.setItem('moviesData', JSON.stringify(moviesData));

            // Refresh UI
            renderTagsList();
            renderTagOptions('seriesTagOptions', 'seriesTagsContainer');
            renderTagOptions('movieTagOptions', 'movieTagsContainer');
            updateSeriesTagCloud();
            updateMoviesTagCloud();
            filterSeries();
            filterMovies();
        }

        // Initialize tag input
        function initTagInput(inputId, containerId) {
            const input = document.getElementById(inputId);
            const container = document.getElementById(containerId);

            input.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' && this.value.trim() !== '') {
                    e.preventDefault();

                    const tag = this.value.trim();
                    const tagEl = createTagElement(tag, container, false);
                    container.insertBefore(tagEl, this);
                    this.value = '';
                }
            });

            // Existing tags don't need delete buttons automatically added

            // If there are global tags, render suggestion chips (for series/movie modals)
            const suggestionsId = inputId === 'seriesTagsInput' ? 'seriesTagOptions' : (inputId === 'movieTagsInput' ? 'movieTagOptions' : null);
            if (suggestionsId) renderTagOptions(suggestionsId, containerId);
        }

        // Render selectable tag options under modal inputs
        function renderTagOptions(optionsContainerId, targetContainerId) {
            const optionsEl = document.getElementById(optionsContainerId);
            if (!optionsEl) return;

            // Clear existing
            optionsEl.innerHTML = '';

            // Build unified suggestion set from global tags and existing series/movies
            const suggestionSet = new Set();
            // Global tags defined in Tags tab
            if (Array.isArray(tagsData) && tagsData.length > 0) {
                tagsData.forEach(t => {
                    if (t && typeof t.name === 'string' && t.name.trim() !== '') {
                        suggestionSet.add(t.name.trim());
                    }
                });
            }
            // Tags from existing series
            if (Array.isArray(seriesData) && seriesData.length > 0) {
                seriesData.forEach(s => {
                    if (s && Array.isArray(s.tags)) {
                        s.tags.forEach(tag => {
                            if (typeof tag === 'string' && tag.trim() !== '') {
                                suggestionSet.add(tag.trim());
                            }
                        });
                    }
                });
            }
            // Tags from existing movies
            if (Array.isArray(moviesData) && moviesData.length > 0) {
                moviesData.forEach(m => {
                    if (m && Array.isArray(m.tags)) {
                        m.tags.forEach(tag => {
                            if (typeof tag === 'string' && tag.trim() !== '') {
                                suggestionSet.add(tag.trim());
                            }
                        });
                    }
                });
            }

            // Render suggestion chips (sorted for consistency)
            Array.from(suggestionSet).sort((a, b) => a.localeCompare(b, 'tr')).forEach(tagName => {
                const chip = document.createElement('span');
                chip.className = 'tag';
                chip.textContent = tagName;
                chip.setAttribute('data-tag', tagName);

                chip.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const container = document.getElementById(targetContainerId);
                    // If already selected (there's a .tag with same text), remove it
                    const exists = Array.from(container.querySelectorAll('.tag')).some(t => t.firstChild && t.firstChild.textContent === tagName);
                    if (exists) {
                        // remove first matching tag element (ignore delete button text)
                        const toRemove = Array.from(container.querySelectorAll('.tag')).find(t => t.firstChild && t.firstChild.textContent === tagName);
                        if (toRemove) container.removeChild(toRemove);
                    } else {
                        const tagEl = createTagElement(tagName, container, false);
                        // Insert before input if present
                        const input = container.querySelector('.tag-input');
                        if (input) container.insertBefore(tagEl, input);
                        else container.appendChild(tagEl);
                    }
                });

                optionsEl.appendChild(chip);
            });
        }

        // Create tag element with optional delete functionality
        function createTagElement(tag, container, showDeleteButton = true) {
            const tagEl = document.createElement('span');
            tagEl.className = 'tag';
            tagEl.textContent = tag;

            if (showDeleteButton) {
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-tag';
                deleteBtn.innerHTML = '&times;';
                deleteBtn.addEventListener('click', function () {
                    container.removeChild(tagEl);
                });
                tagEl.appendChild(deleteBtn);
            }

            return tagEl;
        }

        // Sezon yÃ¶netim fonksiyonlarÄ±
        let seasonCounter = 0;

        function addSeasonForm() {
            seasonCounter++;
            const container = document.getElementById('seasonsContainer');

            const seasonDiv = document.createElement('div');
            seasonDiv.className = 'season-form-item';
            seasonDiv.setAttribute('data-season-id', seasonCounter);

            seasonDiv.innerHTML = `
                <div class="season-form-header">
                    <span class="season-form-title">Sezon ${seasonCounter}</span>
                    <button type="button" class="remove-season-btn" onclick="removeSeasonForm(${seasonCounter})">
                        <i class="fas fa-times"></i> KaldÄ±r
                    </button>
                </div>
                <div class="season-form-fields">
                    <div class="form-group">
                        <label>Sezon NumarasÄ±</label>
                        <input type="number" class="form-control season-number" min="1" value="${seasonCounter}" required>
                    </div>
                    <div class="form-group">
                        <label>Toplam BÃ¶lÃ¼m</label>
                        <input type="number" class="form-control season-total-episodes" min="1" required>
                    </div>
                    <div class="form-group">
                        <label>Ä°zlenen BÃ¶lÃ¼m</label>
                        <input type="number" class="form-control season-watched-episodes" min="0" value="0">
                    </div>
                </div>
            `;

            container.appendChild(seasonDiv);
        }

        function removeSeasonForm(seasonId) {
            const seasonDiv = document.querySelector(`[data-season-id="${seasonId}"]`);
            if (seasonDiv) {
                seasonDiv.remove();
            }
        }

        function getSeasonsFromForm() {
            const seasons = [];
            document.querySelectorAll('.season-form-item').forEach(item => {
                const seasonNumberEl = item.querySelector('.season-number');
                const totalEpisodesEl = item.querySelector('.season-total-episodes');
                const watchedEpisodesEl = item.querySelector('.season-watched-episodes');

                if (!seasonNumberEl || !totalEpisodesEl || !watchedEpisodesEl) return;

                const seasonNumber = parseInt(seasonNumberEl.value) || 0;
                const totalEpisodes = parseInt(totalEpisodesEl.value) || 0;
                const watchedEpisodes = parseInt(watchedEpisodesEl.value) || 0;

                seasons.push({
                    season: seasonNumber,
                    totalEpisodes: totalEpisodes,
                    watchedEpisodes: watchedEpisodes,
                    updatedAt: new Date().toISOString()
                });
            });
            return seasons;
        }

        function loadSeasonsToSelector(seasons, selectedSeasonId) {
            const selector = document.getElementById('seasonSelector');
            selector.innerHTML = '<option value="">Sezon seÃ§in...</option>';

            if (seasons && seasons.length > 0) {
                seasons.forEach(season => {
                    const option = document.createElement('option');
                    option.value = season.id;
                    option.textContent = `Sezon ${season.season} (${season.watchedEpisodes}/${season.totalEpisodes} bÃ¶lÃ¼m)`;
                    if (season.id == selectedSeasonId) {
                        option.selected = true;
                    }
                    selector.appendChild(option);
                });
            }

            // SeÃ§ili sezon varsa bilgilerini gÃ¶ster
            if (selectedSeasonId) {
                loadSelectedSeasonInfo(selectedSeasonId);
            }
        }

        function loadSelectedSeasonInfo(seasonId) {
            const season = seriesData.find(s => s.id == seasonId);
            if (!season) return;

            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

            if (seasonNumberInput) seasonNumberInput.value = season.season;
            if (totalEpisodesInput) totalEpisodesInput.value = season.totalEpisodes;
            if (watchedEpisodesInput) watchedEpisodesInput.value = season.watchedEpisodes;

            document.getElementById('selectedSeasonInfo').style.display = 'block';
            document.getElementById('deleteSeasonBtn').style.display = 'inline-block';
        }

        function clearSelectedSeasonInfo() {
            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

            if (seasonNumberInput) seasonNumberInput.value = '';
            if (totalEpisodesInput) totalEpisodesInput.value = '';
            if (watchedEpisodesInput) watchedEpisodesInput.value = '';

            document.getElementById('selectedSeasonInfo').style.display = 'none';
            document.getElementById('deleteSeasonBtn').style.display = 'none';
        }

        function showNewSeasonForm() {
            const seriesName = document.getElementById('seriesName').value;
            if (!seriesName) {
                alert('Ã–nce dizi adÄ±nÄ± girin.');
                return;
            }

            // Mevcut sezonlarÄ± kontrol et
            const existingSeasons = seriesData.filter(s => s.name === seriesName);
            const nextSeasonNumber = existingSeasons.length > 0 ? Math.max(...existingSeasons.map(s => s.season)) + 1 : 1;

            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

            if (seasonNumberInput) seasonNumberInput.value = nextSeasonNumber;
            if (totalEpisodesInput) totalEpisodesInput.value = '';
            if (watchedEpisodesInput) watchedEpisodesInput.value = 0;

            document.getElementById('selectedSeasonInfo').style.display = 'block';
            document.getElementById('deleteSeasonBtn').style.display = 'none';

            // Selector'Ä± temizle ve yeni sezon modunu iÅŸaretle
            document.getElementById('seasonSelector').value = '';
            document.getElementById('seasonSelector').setAttribute('data-new-season', 'true');

            // ButonlarÄ± gÃ¼ncelle
            document.querySelector('#seriesForm button[type="submit"]').style.display = 'none';
            document.getElementById('saveNewSeasonBtn').style.display = 'block';
        }

        // Get selected categories from selector
        function getSelectedCategories(selectorId) {
            const selected = [];
            document.querySelectorAll(`#${selectorId} .category-option.selected`).forEach(option => {
                selected.push(parseInt(option.getAttribute('data-id')));
            });
            return selected;
        }

        // Get tags from container
        function getTagsFromContainer(containerId) {
            const tags = [];
            document.querySelectorAll(`#${containerId} .tag`).forEach(tagEl => {
                tags.push(tagEl.textContent);
            });
            return tags;
        }

        // Export data
        document.getElementById('exportData').addEventListener('click', function () {
            const data = {
                series: seriesData,
                movies: moviesData,
                categories: categoriesData,
                tags: tagsData
            };

            const dataStr = JSON.stringify(data);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);

            const exportFileDefaultName = 'izleme-takip-yedek.json';

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        });

        // Import data
        document.getElementById('importData').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);

                    if (data.series) seriesData = data.series;
                    if (data.movies) moviesData = data.movies;
                    if (data.categories) categoriesData = data.categories;
                    if (data.tags) tagsData = data.tags;

                    localStorage.setItem('seriesData', JSON.stringify(seriesData));
                    localStorage.setItem('moviesData', JSON.stringify(moviesData));
                    localStorage.setItem('categoriesData', JSON.stringify(categoriesData));
                    localStorage.setItem('tagsData', JSON.stringify(tagsData));

                    initApp();
                    alert('Veriler baÅŸarÄ±yla yÃ¼klendi!');
                } catch (err) {
                    alert('Dosya yÃ¼klenirken bir hata oluÅŸtu: ' + err.message);
                }
            };
            reader.readAsText(file);

            // Reset input
            this.value = '';
        });

        // Event listeners
        seriesTab.addEventListener('click', function () {
            seriesTab.classList.add('active');
            moviesTab.classList.remove('active');
            upcomingTab.classList.remove('active');
            categoriesTab.classList.remove('active');
            tagsTab.classList.remove('active');
            trailersTab.classList.remove('active');
            seriesContent.classList.remove('hidden');
            moviesContent.classList.add('hidden');
            upcomingContent.classList.add('hidden');
            categoriesContent.classList.add('hidden');
            tagsContent.classList.add('hidden');
            trailersContent.classList.add('hidden');
            stopTrailersPreview(true);
        });

        moviesTab.addEventListener('click', function () {
            moviesTab.classList.add('active');
            seriesTab.classList.remove('active');
            upcomingTab.classList.remove('active');
            categoriesTab.classList.remove('active');
            tagsTab.classList.remove('active');
            trailersTab.classList.remove('active');
            moviesContent.classList.remove('hidden');
            seriesContent.classList.add('hidden');
            upcomingContent.classList.add('hidden');
            categoriesContent.classList.add('hidden');
            tagsContent.classList.add('hidden');
            trailersContent.classList.add('hidden');
            stopTrailersPreview(true);
        });

        upcomingTab.addEventListener('click', function () {
            upcomingTab.classList.add('active');
            seriesTab.classList.remove('active');
            moviesTab.classList.remove('active');
            categoriesTab.classList.remove('active');
            tagsTab.classList.remove('active');
            trailersTab.classList.remove('active');
            upcomingContent.classList.remove('hidden');
            seriesContent.classList.add('hidden');
            moviesContent.classList.add('hidden');
            categoriesContent.classList.add('hidden');
            tagsContent.classList.add('hidden');
            trailersContent.classList.add('hidden');
            renderUpcomingReleases();
            stopTrailersPreview(true);
        });

        // Upcoming releases filter event listeners
        upcomingFilterAll.addEventListener('click', function () {
            filterUpcomingContent('all');
            renderUpcomingReleases();
        });

        upcomingFilterSeries.addEventListener('click', function () {
            filterUpcomingContent('series');
            renderUpcomingReleases();
        });

        upcomingFilterMovies.addEventListener('click', function () {
            filterUpcomingContent('movies');
            renderUpcomingReleases();
        });

        categoriesTab.addEventListener('click', function () {
            categoriesTab.classList.add('active');
            seriesTab.classList.remove('active');
            moviesTab.classList.remove('active');
            upcomingTab.classList.remove('active');
            tagsTab.classList.remove('active');
            trailersTab.classList.remove('active');
            categoriesContent.classList.remove('hidden');
            seriesContent.classList.add('hidden');
            moviesContent.classList.add('hidden');
            upcomingContent.classList.add('hidden');
            tagsContent.classList.add('hidden');
            trailersContent.classList.add('hidden');
            stopTrailersPreview(true);
        });

        tagsTab.addEventListener('click', function () {
            tagsTab.classList.add('active');
            seriesTab.classList.remove('active');
            moviesTab.classList.remove('active');
            upcomingTab.classList.remove('active');
            categoriesTab.classList.remove('active');
            trailersTab.classList.remove('active');
            tagsContent.classList.remove('hidden');
            seriesContent.classList.add('hidden');
            moviesContent.classList.add('hidden');
            upcomingContent.classList.add('hidden');
            categoriesContent.classList.add('hidden');
            trailersContent.classList.add('hidden');
            stopTrailersPreview(true);
        });

        trailersTab.addEventListener('click', function () {
            trailersTab.classList.add('active');
            seriesTab.classList.remove('active');
            moviesTab.classList.remove('active');
            upcomingTab.classList.remove('active');
            categoriesTab.classList.remove('active');
            tagsTab.classList.remove('active');
            trailersContent.classList.remove('hidden');
            seriesContent.classList.add('hidden');
            moviesContent.classList.add('hidden');
            upcomingContent.classList.add('hidden');
            categoriesContent.classList.add('hidden');
            tagsContent.classList.add('hidden');
            stopTrailersPreview(true);
            renderTrailersTab();
        });

        if (trailersList) {
            trailersList.addEventListener('mouseover', function (e) {
                const item = e.target.closest('.trailer-preview-item');
                if (!item) return;
                scheduleTrailersPreview(item.getAttribute('data-video-id'), item.getAttribute('data-title') || '');
            }, { passive: true });

            trailersList.addEventListener('focusin', function (e) {
                const item = e.target.closest('.trailer-preview-item');
                if (!item) return;
                scheduleTrailersPreview(item.getAttribute('data-video-id'), item.getAttribute('data-title') || '');
            }, { passive: true });

            trailersList.addEventListener('mouseleave', function () {
                stopTrailersPreview(false);
            });

            trailersList.addEventListener('click', function (e) {
                const item = e.target.closest('.trailer-preview-item');
                if (!item) return;
                showTrailerModal(item.getAttribute('data-trailer-url'), item.getAttribute('data-title') || '');
            });

            trailersList.addEventListener('keydown', function (e) {
                const item = e.target.closest('.trailer-preview-item');
                if (!item) return;
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    showTrailerModal(item.getAttribute('data-trailer-url'), item.getAttribute('data-title') || '');
                }
            });
        }

        if (trailersSearch) {
            trailersSearch.addEventListener('input', function () {
                trailersSearchQuery = (this.value || '');
                renderTrailersTab();
            });
        }

        if (trailersSortSelect) {
            trailersSortSelect.addEventListener('change', function () {
                currentTrailersSort = this.value || 'alphabetical';
                renderTrailersTab();
            });
        }

        function setTrailersFilter(filter) {
            currentTrailersFilter = filter;
            renderTrailersTab();
        }

        if (trailersFilterAll) {
            trailersFilterAll.addEventListener('click', function () { setTrailersFilter('all'); });
        }
        if (trailersFilterSeries) {
            trailersFilterSeries.addEventListener('click', function () { setTrailersFilter('series'); });
        }
        if (trailersFilterMovies) {
            trailersFilterMovies.addEventListener('click', function () { setTrailersFilter('movies'); });
        }

        addSeriesBtn.addEventListener('click', addSeries);
        addSeriesBtnEmpty.addEventListener('click', addSeries);
        addMovieBtn.addEventListener('click', addMovie);
        addMovieBtnEmpty.addEventListener('click', addMovie);
        addCategoryBtn.addEventListener('click', addCategory);
        document.getElementById('addTagBtn').addEventListener('click', addTag);
        document.getElementById('promoteAllTagsBtn').addEventListener('click', promoteAllTags);
        
        // Fragman butonlarÄ± iÃ§in event listener (event delegation kullanarak)
        document.addEventListener('click', function(e) {
            if (e.target.closest('.trailer-btn')) {
                const btn = e.target.closest('.trailer-btn');
                const trailerUrl = btn.getAttribute('data-trailer-url');
                const title = btn.getAttribute('data-title');
                showTrailerModal(trailerUrl, title);
            }
        });

        // Sync Modal events (WebRTC-only)
        openSyncModalBtn.addEventListener('click', () => { syncModalEl.classList.add('active'); });
        closeSyncModalBtn.addEventListener('click', () => { syncModalEl.classList.remove('active'); });

        // --- WebRTC Pairing logic ---
        const RTC_CONFIG = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
        let rtcPeer = null;
        let rtcChannel = null;
        let rtcInitiator = false;

        function encodeSignal(obj) { try { return btoa(unescape(encodeURIComponent(JSON.stringify(obj)))); } catch (e) { return ''; } }
        function decodeSignal(str) { try { return JSON.parse(decodeURIComponent(escape(atob((str || '').trim())))); } catch (e) { alert('GeÃ§ersiz kod'); return null; } }

        // BasitleÅŸtirilmiÅŸ WebRTC eÅŸleÅŸtirme sistemi
        let pairingState = 'waiting'; // 'waiting', 'offer-generated', 'answer-received', 'connected'
        let isInitiator = false;

        function setupRtcChannel() {
            if (!rtcChannel) return;
            rtcChannel.onopen = () => {
                updatePairingStatus('BaÄŸlandÄ±! Cihazlar senkronize edildi.', 'success');
                if (connectTimeoutTimer) { try { clearTimeout(connectTimeoutTimer); } catch(_) {} connectTimeoutTimer = null; }
                updateInstructions('connected');
                pairingState = 'connected';
                try { rtcChannel.send(JSON.stringify({ type: 'syncData', payload: getAllDataPayload() })); } catch (_) {}
            };
            rtcChannel.onmessage = (ev) => {
                try {
                    const msg = JSON.parse(ev.data);
                    if (msg && msg.type === 'syncData' && msg.payload) { applyRemoteData(msg.payload); }
                } catch (_) {}
            };
            rtcChannel.onclose = () => { 
                updatePairingStatus('BaÄŸlantÄ± kapandÄ±', 'error');
                pairingState = 'waiting';
            };
        }

        function initRtcPeer(initiator) {
            rtcInitiator = !!initiator;
            isInitiator = initiator;
            rtcPeer = new RTCPeerConnection(RTC_CONFIG);
            rtcPeer.ondatachannel = (ev) => { rtcChannel = ev.channel; setupRtcChannel(); };
            rtcPeer.onicecandidate = () => { /* manual signaling: SDP yeterli */ };
            if (rtcInitiator) { rtcChannel = rtcPeer.createDataChannel('sync'); setupRtcChannel(); }
        }

        // ICE adaylarÄ± tamamen toplanana kadar bekle
        function waitForIceGatheringComplete(pc) {
            return new Promise(resolve => {
                if (!pc) return resolve();
                if (pc.iceGatheringState === 'complete') return resolve();
                const check = () => {
                    if (pc.iceGatheringState === 'complete') {
                        pc.removeEventListener('icegatheringstatechange', check);
                        resolve();
                    }
                };
                pc.addEventListener('icegatheringstatechange', check);
                // GÃ¼venlik iÃ§in maksimum bekleme (10 sn), bazÄ± ortamlarda state olayÄ± gelmeyebilir
                setTimeout(() => { 
                    pc.removeEventListener('icegatheringstatechange', check);
                    resolve();
                }, 10000);
            });
        }

        function updatePairingStatus(message, type = 'info') {
            if (pairingStatus) {
                pairingStatus.textContent = `Durum: ${message}`;
                pairingStatus.className = `text-gray-300 mb-2 ${type === 'success' ? 'text-green-400' : type === 'error' ? 'text-red-400' : ''}`;
            }
        }

        function updateInstructions(step) {
            if (!pairingInstructions) return;
            
            const instructions = {
                'waiting': `
                    <p><strong>AdÄ±m 1:</strong> "Kod Ãœret" butonuna basÄ±n</p>
                    <p><strong>AdÄ±m 2:</strong> Kodu diÄŸer cihaza paylaÅŸÄ±n (QR ile veya kopyala-yapÄ±ÅŸtÄ±r)</p>
                    <p><strong>AdÄ±m 3:</strong> DiÄŸer cihazdan gelen cevap kodunu buraya yapÄ±ÅŸtÄ±rÄ±n</p>
                    <p><strong>AdÄ±m 4:</strong> "BaÄŸlan" butonuna basÄ±n</p>
                `,
                'offer-generated': `
                    <p><strong>âœ“ AdÄ±m 1 tamamlandÄ±:</strong> Kod Ã¼retildi</p>
                    <p><strong>â†’ AdÄ±m 2:</strong> Kodu diÄŸer cihaza paylaÅŸÄ±n (QR ile veya kopyala-yapÄ±ÅŸtÄ±r)</p>
                    <p><strong>AdÄ±m 3:</strong> DiÄŸer cihazdan gelen cevap kodunu buraya yapÄ±ÅŸtÄ±rÄ±n</p>
                    <p><strong>AdÄ±m 4:</strong> "BaÄŸlan" butonuna basÄ±n</p>
                `,
                'answer-received': `
                    <p><strong>âœ“ AdÄ±m 1-3 tamamlandÄ±:</strong> Cevap kodu alÄ±ndÄ±</p>
                    <p><strong>â†’ AdÄ±m 4:</strong> "BaÄŸlan" butonuna basÄ±n</p>
                `,
                'connecting': `
                    <p><strong>BaÄŸlantÄ± kuruluyor...</strong> LÃ¼tfen bekleyin.</p>
                `,
                'connected': `
                    <p><strong>âœ“ TÃ¼m adÄ±mlar tamamlandÄ±!</strong> Cihazlar baÅŸarÄ±yla eÅŸleÅŸtirildi.</p>
                    <p>ArtÄ±k verileriniz otomatik olarak senkronize edilecek.</p>
                `
            };
            
            pairingInstructions.innerHTML = instructions[step] || instructions['waiting'];
        }

        async function generateCode() {
            try {
                initRtcPeer(true);
                const offer = await rtcPeer.createOffer();
                await rtcPeer.setLocalDescription(offer);
                updatePairingStatus('Kod hazÄ±rlanÄ±yor - AÄŸ bilgileri toplanÄ±yor...');
                await waitForIceGatheringComplete(rtcPeer);
                pairingCode.value = encodeSignal(rtcPeer.localDescription);
                
                updatePairingStatus('Kod Ã¼retildi - DiÄŸer cihaza paylaÅŸÄ±n');
                updateInstructions('offer-generated');
                pairingState = 'offer-generated';
                
                // Label'Ä± gÃ¼ncelle
                if (codeLabel) codeLabel.textContent = 'Ãœretilen Kod (DiÄŸer cihaza paylaÅŸÄ±n)';
                
            } catch (e) { 
                updatePairingStatus('Kod Ã¼retilemedi: ' + e.message, 'error');
            }
        }

        function resetPairingState() {
            pairingState = 'waiting';
            isInitiator = false;
            if (rtcPeer) {
                rtcPeer.close();
                rtcPeer = null;
            }
            if (rtcChannel) {
                rtcChannel.close();
                rtcChannel = null;
            }
            if (pairingCode) pairingCode.value = '';
            if (codeLabel) codeLabel.textContent = 'EÅŸleÅŸtirme Kodu';
            updatePairingStatus('HazÄ±r - Yeni eÅŸleÅŸtirme baÅŸlatabilirsiniz');
            updateInstructions('waiting');
        }

        async function connectToPeer() {
            const codeValue = pairingCode.value.trim();
            if (!codeValue) {
                alert('LÃ¼tfen bir kod girin veya Ã¼retin!');
                return;
            }

            try {
                if (pairingState === 'waiting') {
                    // Bu cihaz baÄŸlanan taraf - offer kodunu iÅŸle
                    const remote = decodeSignal(codeValue);
                    if (!remote) {
                        alert('GeÃ§ersiz kod formatÄ±!');
                        return;
                    }
                    
                    initRtcPeer(false);
                    await rtcPeer.setRemoteDescription(remote);
                    const answer = await rtcPeer.createAnswer();
                    await rtcPeer.setLocalDescription(answer);
                    updatePairingStatus('Cevap hazÄ±rlanÄ±yor - AÄŸ bilgileri toplanÄ±yor...');
                    await waitForIceGatheringComplete(rtcPeer);
                    
                    // Answer kodunu gÃ¶ster
                    pairingCode.value = encodeSignal(rtcPeer.localDescription);
                    updatePairingStatus('Cevap kodu Ã¼retildi - Ä°lk cihaza verin');
                    updateInstructions('answer-received');
                    pairingState = 'answer-received';
                    
                    if (codeLabel) codeLabel.textContent = 'Cevap Kodu (Ä°lk cihaza verin)';
                    
                } else if (pairingState === 'offer-generated') {
                    // Bu cihaz baÅŸlatan taraf - answer kodunu iÅŸle
                    const ans = decodeSignal(codeValue);
                    if (!ans) {
                        alert('GeÃ§ersiz cevap kodu formatÄ±!');
                        return;
                    }
                    
                    await rtcPeer.setRemoteDescription(ans);
                    updatePairingStatus('BaÄŸlantÄ± kuruluyor...');
                    updateInstructions('connecting');
                    if (connectTimeoutTimer) { try { clearTimeout(connectTimeoutTimer); } catch(_) {} }
                    connectTimeoutTimer = setTimeout(() => {
                        if (pairingState !== 'connected' || !rtcChannel || rtcChannel.readyState !== 'open') {
                            updatePairingStatus('BaÄŸlantÄ± kurulamadÄ±. AÄŸ veya WebRTC engeli olabilir.', 'error');
                            updateInstructions('answer-received');
                        }
                    }, connectTimeoutMs);
                    
                } else if (pairingState === 'answer-received') {
                    // Cevap kodu zaten Ã¼retildi, tekrar baÄŸlanmaya Ã§alÄ±ÅŸÄ±yor
                    updatePairingStatus('Cevap kodu zaten Ã¼retildi. Ä°lk cihaza verin ve orada "BaÄŸlan" butonuna basÄ±n.', 'error');
                    
                } else if (pairingState === 'connected') {
                    // Zaten baÄŸlÄ±, yeni eÅŸleÅŸtirme baÅŸlatmak istiyor
                    const restart = confirm('Zaten baÄŸlÄ±sÄ±nÄ±z. Yeni bir eÅŸleÅŸtirme baÅŸlatmak istiyor musunuz?');
                    if (restart) {
                        resetPairingState();
                        updatePairingStatus('Durum sÄ±fÄ±rlandÄ±. Yeni eÅŸleÅŸtirme baÅŸlatabilirsiniz.');
                    }
                    
                } else {
                    // Bilinmeyen durum - gÃ¼venli sÄ±fÄ±rlama
                    console.warn('Bilinmeyen pairingState:', pairingState);
                    resetPairingState();
                    updatePairingStatus('Durum sÄ±fÄ±rlandÄ±. LÃ¼tfen tekrar deneyin.');
                }
                
            } catch (e) { 
                updatePairingStatus('BaÄŸlantÄ± hatasÄ±: ' + e.message, 'error');
                console.error('WebRTC baÄŸlantÄ± hatasÄ±:', e);
            }
        }

        function showQrCode() {
            const code = pairingCode.value.trim();
            if (!code) {
                alert('Ã–nce bir kod Ã¼retin!');
                return;
            }
            
            if (qrContainer) {
                qrContainer.innerHTML = '';
                const qr = new QRCode(qrContainer, {
                    text: code,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff"
                });
            }
        }

        // Event listeners
        if (generateCodeBtn) generateCodeBtn.addEventListener('click', generateCode);
        if (connectBtn) connectBtn.addEventListener('click', connectToPeer);
        if (showQrBtn) showQrBtn.addEventListener('click', showQrCode);
        
        // Reset pairing button
        const resetPairingBtn = document.getElementById('resetPairingBtn');
        if (resetPairingBtn) resetPairingBtn.addEventListener('click', function() {
            resetPairingState();
            updatePairingStatus('Durum sÄ±fÄ±rlandÄ±. Yeni eÅŸleÅŸtirme baÅŸlatabilirsiniz.');
        });
        // Sezon seÃ§imi event listener'larÄ±
        document.getElementById('seasonSelector').addEventListener('change', function () {
            const selectedSeasonId = this.value;
            // Yeni sezon modunu temizle
            this.removeAttribute('data-new-season');

            // ButonlarÄ± eski haline getir
            document.querySelector('#seriesForm button[type="submit"]').style.display = 'block';
            document.getElementById('saveNewSeasonBtn').style.display = 'none';

            if (selectedSeasonId) {
                loadSelectedSeasonInfo(selectedSeasonId);
            } else {
                clearSelectedSeasonInfo();
            }
        });

        document.getElementById('addNewSeasonBtn').addEventListener('click', showNewSeasonForm);

        document.getElementById('saveNewSeasonBtn').addEventListener('click', function () {
            const seriesName = document.getElementById('seriesName').value;
            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

            const seasonNumber = parseInt(seasonNumberInput?.value);
            const totalEpisodes = parseInt(totalEpisodesInput?.value);
            const watchedEpisodes = parseInt(watchedEpisodesInput?.value) || 0;
            const platform = document.getElementById('seriesPlatform').value;
            const categories = getSelectedCategories('seriesCategorySelector');
            const tags = getTagsFromContainer('seriesTagsContainer');

            if (!seriesName || !seasonNumber || !totalEpisodes) {
                alert('Dizi adÄ±, sezon numarasÄ± ve toplam bÃ¶lÃ¼m sayÄ±sÄ± gereklidir!');
                return;
            }

            // Yeni sezon ekle
            const newSeason = {
                id: Date.now(),
                name: seriesName,
                season: seasonNumber,
                totalEpisodes: totalEpisodes,
                platform,
                watchedEpisodes: watchedEpisodes,
                categories,
                tags,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            seriesData.push(newSeason);
            localStorage.setItem('seriesData', JSON.stringify(seriesData));

            // Sezon selector'Ä±nÄ± gÃ¼ncelle ve yeni sezonu seÃ§
            const allSeasons = seriesData.filter(s => s.name === seriesName);
            loadSeasonsToSelector(allSeasons, newSeason.id);
            loadSelectedSeasonInfo(newSeason.id);

            // ButonlarÄ± eski haline getir
            document.querySelector('#seriesForm button[type="submit"]').style.display = 'block';
            document.getElementById('saveNewSeasonBtn').style.display = 'none';
            document.getElementById('seasonSelector').removeAttribute('data-new-season');

            // Listeyi gÃ¼ncelle
            filterSeries();
            updateTotalStats();
            updateSeriesTagCloud();
        });

        document.getElementById('deleteSeasonBtn').addEventListener('click', function () {
            const seasonId = document.getElementById('seasonSelector').value;
            if (seasonId && confirm('Bu sezonu silmek istediÄŸinize emin misiniz?')) {
                // Sezonu sil
                seriesData = seriesData.filter(s => s.id != seasonId);
                localStorage.setItem('seriesData', JSON.stringify(seriesData));

                // Selector'Ä± gÃ¼ncelle
                const seriesName = document.getElementById('seriesName').value;
                const remainingSeasons = seriesData.filter(s => s.name === seriesName);
                loadSeasonsToSelector(remainingSeasons, null);
                clearSelectedSeasonInfo();

                // Listeyi gÃ¼ncelle
                renderSeriesList();
                updateTotalStats();
            }
        });

        document.getElementById('cancelSeries').addEventListener('click', function () {
            seriesModal.classList.remove('active');
        });

        document.getElementById('cancelMovie').addEventListener('click', function () {
            movieModal.classList.remove('active');
        });

        // Series form submit
        document.getElementById('seriesForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const id = document.getElementById('seriesId').value;
            const name = document.getElementById('seriesName').value;
            const platform = document.getElementById('seriesPlatform').value;
            const categories = getSelectedCategories('seriesCategorySelector');
            const tags = getTagsFromContainer('seriesTagsContainer');
            const trailerUrl = document.getElementById('seriesTrailerUrl').value;
            const imdbRating = document.getElementById('seriesImdbRating').value;
            const description = document.getElementById('seriesDescription').value;
            const imageUrl = document.getElementById('seriesImageUrl').value;
            const releaseDate = document.getElementById('seriesReleaseDate').value;

            if (id) {
                // DÃ¼zenleme modu
                const selectedSeasonId = document.getElementById('seasonSelector').value;
                const isNewSeason = document.getElementById('seasonSelector').getAttribute('data-new-season') === 'true';

                if (!selectedSeasonId) {
                    // Sezon seÃ§ilmemiÅŸ - Dizinin genel Ã¶zelliklerini gÃ¼ncelle
                    const seriesSeasons = seriesData.filter(s => s.name === name);
                    seriesSeasons.forEach(season => {
                        const seasonIndex = seriesData.findIndex(s => s.id === season.id);
                        if (seasonIndex !== -1) {
                            seriesData[seasonIndex] = {
                            ...seriesData[seasonIndex],
                            name,
                            platform,
                            categories,
                            tags,
                            trailerUrl,
                            imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                            description,
                            imageUrl,
                            releaseDate: releaseDate || null,
                            updatedAt: new Date().toISOString()
                        };
                        }
                    });
                } else {
                    // Sezon seÃ§ilmiÅŸ - Sezon bilgilerini kontrol et
                    const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
                    const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
                    const watchedEpisodesInput = document.querySelector('input[name="watchedEpisodes"]');

                    const seasonNumber = parseInt(seasonNumberInput?.value);
                    const totalEpisodes = parseInt(totalEpisodesInput?.value);
                    const watchedEpisodes = parseInt(watchedEpisodesInput?.value) || 0;

                    if (!seasonNumber || !totalEpisodes) {
                        alert('Sezon numarasÄ± ve toplam bÃ¶lÃ¼m sayÄ±sÄ± gereklidir!');
                        return;
                    }

                    if (isNewSeason) {
                        // Yeni sezon ekle
                        const newSeasonId = seriesData.length > 0 ? Math.max(...seriesData.map(s => s.id)) + 1 : 1;
                        seriesData.push({
                            id: newSeasonId,
                            name,
                            platform,
                            season: seasonNumber,
                            totalEpisodes,
                            watchedEpisodes,
                            categories,
                            tags,
                            trailerUrl,
                            imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                            description,
                            imageUrl,
                            releaseDate: releaseDate || null,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        });
                    } else {
                        // Mevcut sezonu gÃ¼ncelle
                        const seasonIndex = seriesData.findIndex(s => s.id == selectedSeasonId);
                        if (seasonIndex !== -1) {
                            seriesData[seasonIndex] = {
                                ...seriesData[seasonIndex],
                                name,
                                platform,
                                season: seasonNumber,
                                totalEpisodes,
                                watchedEpisodes,
                                categories,
                                tags,
                                trailerUrl,
                                imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                                description,
                                imageUrl,
                                releaseDate: releaseDate || null,
                                updatedAt: new Date().toISOString()
                            };
                        }
                    }
                }
            } else {
                // Yeni dizi ekleme modu
                const seasons = getSeasonsFromForm();

                // Sezon kontrolÃ¼
                if (seasons.length === 0) {
                    alert('En az bir sezon eklemelisiniz!');
                    return;
                }

                // Yeni dizi ekle - her sezon iÃ§in ayrÄ± kayÄ±t
                seasons.forEach(seasonData => {
                    const newId = seriesData.length > 0 ? Math.max(...seriesData.map(s => s.id)) + 1 : 1;
                    seriesData.push({
                        id: newId,
                        name,
                        season: seasonData.season,
                        totalEpisodes: seasonData.totalEpisodes,
                        platform,
                        watchedEpisodes: seasonData.watchedEpisodes,
                        categories,
                        tags,
                        trailerUrl,
                        imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                        description,
                        imageUrl,
                        releaseDate: releaseDate || null,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    });
                });
            }

            localStorage.setItem('seriesData', JSON.stringify(seriesData));
            seriesModal.classList.remove('active');
            filterSeries();
            updateTotalStats();
            updateSeriesTagCloud();
        });

        // Movie form submit
        document.getElementById('movieForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const id = document.getElementById('movieId').value;
            const name = document.getElementById('movieName').value;
            const watched = document.getElementById('movieWatched').checked;
            const categories = getSelectedCategories('movieCategorySelector');
            const tags = getTagsFromContainer('movieTagsContainer');
            const trailerUrl = document.getElementById('movieTrailerUrl').value;
            const imdbRating = document.getElementById('movieImdbRating').value;
            const description = document.getElementById('movieDescription').value;
            const imageUrl = document.getElementById('movieImageUrl').value;
            const releaseDate = document.getElementById('movieReleaseDate').value;

            if (id) {
                // Edit existing movie
                const index = moviesData.findIndex(m => m.id == id);
                if (index !== -1) {
                    moviesData[index] = {
                        ...moviesData[index],
                        name,
                        watched,
                        categories,
                        tags,
                        trailerUrl,
                        imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                        description,
                        imageUrl,
                        releaseDate: releaseDate || null,
                        updatedAt: new Date().toISOString()
                    };
                }
            } else {
                // Add new movie
                const newId = moviesData.length > 0 ? Math.max(...moviesData.map(m => m.id)) + 1 : 1;
                moviesData.push({
                    id: newId,
                    name,
                    watched,
                    categories,
                    tags,
                    trailerUrl,
                    imdbRating: imdbRating ? parseFloat(imdbRating) : null,
                    description,
                    imageUrl,
                    releaseDate: releaseDate || null,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
            }

            localStorage.setItem('moviesData', JSON.stringify(moviesData));
            movieModal.classList.remove('active');
            filterMovies();
            updateTotalStats();
            updateMoviesTagCloud();
        });

        // Search and filter events
        searchSeries.addEventListener('input', filterSeries);
        searchMovies.addEventListener('input', filterMovies);

        // Filter buttons
        document.querySelectorAll('.filter-button').forEach(btn => {
            btn.addEventListener('click', function () {
                const filter = this.getAttribute('data-filter');

                if (this.closest('#seriesContent')) {
                    currentSeriesFilter = filter;
                    document.querySelectorAll('#seriesContent .filter-button').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    filterSeries();
                } else {
                    currentMoviesFilter = filter;
                    document.querySelectorAll('#moviesContent .filter-button').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    filterMovies();
                }
            });
        });

        // View options
        document.querySelectorAll('.view-button').forEach(btn => {
            btn.addEventListener('click', function () {
                const view = this.getAttribute('data-view');

                if (this.closest('#seriesContent')) {
                    seriesView = view;
                    document.querySelectorAll('#seriesContent .view-button').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    renderSeriesList();
                } else {
                    moviesView = view;
                    document.querySelectorAll('#moviesContent .view-button').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    renderMoviesList();
                }
            });
        });

        // Poster aspect ratio selectors
        const posterAspectSelectSeries = document.getElementById('posterAspectSelectSeries');
        const posterAspectSelectMovies = document.getElementById('posterAspectSelectMovies');
        const layoutModeSelectSeries = document.getElementById('layoutModeSelectSeries');
        const layoutModeSelectMovies = document.getElementById('layoutModeSelectMovies');

        function syncPosterAspectSelects(value) {
            if (posterAspectSelectSeries) posterAspectSelectSeries.value = value;
            if (posterAspectSelectMovies) posterAspectSelectMovies.value = value;
        }

        function syncLayoutModeSelects(value) {
            if (layoutModeSelectSeries) layoutModeSelectSeries.value = value;
            if (layoutModeSelectMovies) layoutModeSelectMovies.value = value;
        }

        // Initialize selects with current value
        syncPosterAspectSelects(posterAspect);
        syncLayoutModeSelects(layoutMode);

        function handleLayoutModeChange(value) {
            layoutMode = value;
            localStorage.setItem('layoutMode', layoutMode);
            syncLayoutModeSelects(layoutMode);
            syncLayoutToggleActive(layoutMode);
            renderSeriesList();
            renderMoviesList();
        }

        function handlePosterAspectChange(value, context) {
            posterAspect = value;
            localStorage.setItem('posterAspect', posterAspect);
            // Re-render lists; prefer current visible tab if context known
            if (context === 'series') {
                renderSeriesList();
            } else if (context === 'movies') {
                renderMoviesList();
            } else {
                // Fallback: render both
                renderSeriesList();
                renderMoviesList();
            }
            // Keep both selects in sync
            syncPosterAspectSelects(posterAspect);
        }

        if (posterAspectSelectSeries) {
            posterAspectSelectSeries.addEventListener('change', function () {
                handlePosterAspectChange(this.value, 'series');
            });
        }

        if (posterAspectSelectMovies) {
            posterAspectSelectMovies.addEventListener('change', function () {
                handlePosterAspectChange(this.value, 'movies');
            });
        }

        if (layoutModeSelectSeries) {
            layoutModeSelectSeries.addEventListener('change', function () {
                handleLayoutModeChange(this.value);
            });
        }

        if (layoutModeSelectMovies) {
            layoutModeSelectMovies.addEventListener('change', function () {
                handleLayoutModeChange(this.value);
            });
        }

        // YerleÅŸim toggle butonlarÄ±
        const layoutToggleGridSeries = document.getElementById('layoutToggleGridSeries');
        const layoutToggleMasonrySeries = document.getElementById('layoutToggleMasonrySeries');
        const layoutToggleGridMovies = document.getElementById('layoutToggleGridMovies');
        const layoutToggleMasonryMovies = document.getElementById('layoutToggleMasonryMovies');

        function syncLayoutToggleActive(value) {
            const setActive = (gridBtn, masonryBtn) => {
                if (!gridBtn || !masonryBtn) return;
                gridBtn.classList.toggle('active', value === 'grid');
                masonryBtn.classList.toggle('active', value === 'masonry');
            };
            setActive(layoutToggleGridSeries, layoutToggleMasonrySeries);
            setActive(layoutToggleGridMovies, layoutToggleMasonryMovies);
        }

        // Ä°lk aktif durumu ayarla
        syncLayoutToggleActive(layoutMode);

        // Toggle click olaylarÄ±
        if (layoutToggleGridSeries) layoutToggleGridSeries.addEventListener('click', () => handleLayoutModeChange('grid'));
        if (layoutToggleMasonrySeries) layoutToggleMasonrySeries.addEventListener('click', () => handleLayoutModeChange('masonry'));
        if (layoutToggleGridMovies) layoutToggleGridMovies.addEventListener('click', () => handleLayoutModeChange('grid'));
        if (layoutToggleMasonryMovies) layoutToggleMasonryMovies.addEventListener('click', () => handleLayoutModeChange('masonry'));

        // Sorting functions
        function sortSeries(sortType) {
            switch (sortType) {
                case 'newest':
                    filteredSeriesData.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
                    break;
                case 'oldest':
                    filteredSeriesData.sort((a, b) => new Date(a.createdAt || 0) - new Date(b.createdAt || 0));
                    break;
                case 'alphabetical':
                    filteredSeriesData.sort((a, b) => a.name.localeCompare(b.name, 'tr'));
                    break;
                case 'alphabetical-desc':
                    filteredSeriesData.sort((a, b) => b.name.localeCompare(a.name, 'tr'));
                    break;
                case 'rating-desc':
                    filteredSeriesData.sort((a, b) => (b.imdbRating || 0) - (a.imdbRating || 0));
                    break;
                case 'rating-asc':
                    filteredSeriesData.sort((a, b) => (a.imdbRating || 0) - (b.imdbRating || 0));
                    break;
            }
            renderSeriesList();
        }

        function sortMovies(sortType) {
            switch (sortType) {
                case 'newest':
                    filteredMoviesData.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
                    break;
                case 'oldest':
                    filteredMoviesData.sort((a, b) => new Date(a.createdAt || 0) - new Date(b.createdAt || 0));
                    break;
                case 'alphabetical':
                    filteredMoviesData.sort((a, b) => a.name.localeCompare(b.name, 'tr'));
                    break;
                case 'alphabetical-desc':
                    filteredMoviesData.sort((a, b) => b.name.localeCompare(a.name, 'tr'));
                    break;
                case 'rating-desc':
                    filteredMoviesData.sort((a, b) => (b.imdbRating || 0) - (a.imdbRating || 0));
                    break;
                case 'rating-asc':
                    filteredMoviesData.sort((a, b) => (a.imdbRating || 0) - (b.imdbRating || 0));
                    break;
            }
            renderMoviesList();
        }

        // Sort event listeners
        document.getElementById('seriesSortSelect').addEventListener('change', function() {
            sortSeries(this.value );
        });

        document.getElementById('moviesSortSelect').addEventListener('change', function() {
            sortMovies(this.value);
        });

        // Sezon ekleme butonuna basÄ±nca required ekle
        document.getElementById("addNewSeasonBtn").addEventListener("click", () => {
            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            
            if (seasonNumberInput) seasonNumberInput.setAttribute("required", "true");
            if (totalEpisodesInput) totalEpisodesInput.setAttribute("required", "true");
        });

        // Modal kapatÄ±lÄ±nca required kaldÄ±r
        document.getElementById("cancelSeries").addEventListener("click", () => {
            const seasonNumberInput = document.querySelector('input[name="seasonNumber"]');
            const totalEpisodesInput = document.querySelector('input[name="totalEpisodes"]');
            
            if (seasonNumberInput) seasonNumberInput.removeAttribute("required");
            if (totalEpisodesInput) totalEpisodesInput.removeAttribute("required");
        });


        // Initialize the app
        initApp();
    </script>
</body>

</html>
            if (totalEpisodesInput) totalEpisodesInput.removeAttribute("required");
        });


        // Initialize the app
        initApp();
    </script>
</body>

</html>
